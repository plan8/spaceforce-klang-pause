var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__pow=Math.pow,__defNormalProp=(e,t,n)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues=(e,t)=>{for(var n in t||(t={}))__hasOwnProp.call(t,n)&&__defNormalProp(e,n,t[n]);if(__getOwnPropSymbols)for(var n of __getOwnPropSymbols(t))__propIsEnum.call(t,n)&&__defNormalProp(e,n,t[n]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__objRest=(e,t)=>{var n={};for(var s in e)__hasOwnProp.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&__getOwnPropSymbols)for(var s of __getOwnPropSymbols(e))t.indexOf(s)<0&&__propIsEnum.call(e,s)&&(n[s]=e[s]);return n},__publicField=(e,t,n)=>(__defNormalProp(e,"symbol"!=typeof t?t+"":t,n),n),__async=(e,t,n)=>new Promise(((s,i)=>{var a=e=>{try{o(n.next(e))}catch(t){i(t)}},r=e=>{try{o(n.throw(e))}catch(t){i(t)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(a,r);o((n=n.apply(e,t)).next())}));!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Klang=t()}(this,(function(){"use strict";"undefined"!=typeof window&&(window.TONE_SILENCE_LOGGING=!0);const e=(e,t,n)=>({endTime:t,insertTime:n,type:"exponentialRampToValue",value:e}),t=(e,t,n)=>({endTime:t,insertTime:n,type:"linearRampToValue",value:e}),n=(e,t)=>({startTime:t,type:"setValue",value:e}),s=(e,t,n)=>({duration:n,startTime:t,type:"setValueCurve",values:e}),i=(e,t,{startTime:n,target:s,timeConstant:i})=>s+(t-s)*Math.exp((n-e)/i),a=e=>"exponentialRampToValue"===e.type,r=e=>"linearRampToValue"===e.type,o=e=>a(e)||r(e),l=e=>"setValue"===e.type,c=e=>"setValueCurve"===e.type,u=(e,t,n,s)=>{const a=e[t];return void 0===a?s:o(a)||l(a)?a.value:c(a)?a.values[a.values.length-1]:i(n,u(e,t-1,a.startTime,s),a)},h=(e,t,n,s,i)=>void 0===n?[s.insertTime,i]:o(n)?[n.endTime,n.value]:l(n)?[n.startTime,n.value]:c(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,u(e,t-1,n.startTime,i)],d=e=>"cancelAndHold"===e.type,p=e=>"cancelScheduledValues"===e.type,m=e=>d(e)||p(e)?e.cancelTime:a(e)||r(e)?e.endTime:e.startTime,f=(e,t,n,{endTime:s,value:i})=>n===i?i:0<n&&0<i||n<0&&i<0?n*__pow(i/n,(e-t)/(s-t)):0,g=(e,t,n,{endTime:s,value:i})=>n+(e-t)/(s-t)*(i-n),_=(e,{duration:t,startTime:n,values:s})=>((e,t)=>{const n=Math.floor(t),s=Math.ceil(t);return n===s?e[n]:(1-(t-n))*e[n]+(1-(s-t))*e[s]})(s,(e-n)/t*(s.length-1)),y=e=>"setTarget"===e.type;class v{constructor(e){this._automationEvents=[],this._currenTime=0,this._defaultValue=e}[Symbol.iterator](){return this._automationEvents[Symbol.iterator]()}add(i){const l=m(i);if(d(i)||p(i)){const r=this._automationEvents.findIndex((e=>p(i)&&c(e)?e.startTime+e.duration>=l:m(e)>=l)),u=this._automationEvents[r];if(-1!==r&&(this._automationEvents=this._automationEvents.slice(0,r)),d(i)){const i=this._automationEvents[this._automationEvents.length-1];if(void 0!==u&&o(u)){if(void 0!==i&&y(i))throw new Error("The internal list is malformed.");const n=void 0===i?u.insertTime:c(i)?i.startTime+i.duration:m(i),s=void 0===i?this._defaultValue:c(i)?i.values[i.values.length-1]:i.value,r=a(u)?f(l,n,s,u):g(l,n,s,u),o=a(u)?e(r,l,this._currenTime):t(r,l,this._currenTime);this._automationEvents.push(o)}if(void 0!==i&&y(i)&&this._automationEvents.push(n(this.getValue(l),l)),void 0!==i&&c(i)&&i.startTime+i.duration>l){const e=l-i.startTime,t=(i.values.length-1)/i.duration,n=Math.max(2,1+Math.ceil(e*t)),a=e/(n-1)*t,r=i.values.slice(0,n);if(a<1)for(let s=1;s<n;s+=1){const e=a*s%1;r[s]=i.values[s-1]*(1-e)+i.values[s]*e}this._automationEvents[this._automationEvents.length-1]=s(r,i.startTime,e)}}}else{const n=this._automationEvents.findIndex((e=>m(e)>l)),s=-1===n?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[n-1];if(void 0!==s&&c(s)&&m(s)+s.duration>l)return!1;const o=a(i)?e(i.value,i.endTime,this._currenTime):r(i)?t(i.value,l,this._currenTime):i;if(-1===n)this._automationEvents.push(o);else{if(c(i)&&l+i.duration>m(this._automationEvents[n]))return!1;this._automationEvents.splice(n,0,o)}}return!0}flush(e){const t=this._automationEvents.findIndex((t=>m(t)>e));if(t>1){const e=this._automationEvents.slice(t-1),s=e[0];y(s)&&e.unshift(n(u(this._automationEvents,t-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=e}}getValue(e){if(0===this._automationEvents.length)return this._defaultValue;const t=this._automationEvents.findIndex((t=>m(t)>e)),n=this._automationEvents[t],s=(-1===t?this._automationEvents.length:t)-1,d=this._automationEvents[s];if(void 0!==d&&y(d)&&(void 0===n||!o(n)||n.insertTime>e))return i(e,u(this._automationEvents,s-1,d.startTime,this._defaultValue),d);if(void 0!==d&&l(d)&&(void 0===n||!o(n)))return d.value;if(void 0!==d&&c(d)&&(void 0===n||!o(n)||d.startTime+d.duration>e))return e<d.startTime+d.duration?_(e,d):d.values[d.values.length-1];if(void 0!==d&&o(d)&&(void 0===n||!o(n)))return d.value;if(void 0!==n&&a(n)){const[t,i]=h(this._automationEvents,s,d,n,this._defaultValue);return f(e,t,i,n)}if(void 0!==n&&r(n)){const[t,i]=h(this._automationEvents,s,d,n,this._defaultValue);return g(e,t,i,n)}return this._defaultValue}}const b=new WeakSet,w=new WeakMap,T=new WeakMap,x=new WeakMap,S=new WeakMap,E=new WeakMap,M=new WeakMap,A=new WeakMap,C=new WeakMap,I=new WeakMap,k={construct:()=>k},O=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,P=(e,t)=>{const n=[];let s=e.replace(/^[\s]+/,""),i=s.match(O);for(;null!==i;){const e=i[1].slice(1,-1),a=i[0].replace(/([\s]+)?;?$/,"").replace(e,new URL(e,t).toString());n.push(a),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(O)}return[n.join(";"),s]},N=e=>{if(void 0!==e&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},R=e=>{if(!(e=>{try{new new Proxy(e,k)}catch(t){return!1}return!0})(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===e.prototype||"object"!=typeof e.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},D=(e,t)=>{const n=e.get(t);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},V=(e,t)=>{const n=Array.from(e).filter(t);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return e.delete(s),s},L=(e,t,n,s)=>{const i=D(e,t),a=V(i,(e=>e[0]===n&&e[1]===s));return 0===i.size&&e.delete(t),a},B=e=>D(M,e),F=e=>{if(b.has(e))throw new Error("The AudioNode is already stored.");b.add(e),B(e).forEach((e=>e(!0)))},q=e=>"port"in e,G=e=>{if(!b.has(e))throw new Error("The AudioNode is not stored.");b.delete(e),B(e).forEach((e=>e(!1)))},U=(e,t)=>{!q(e)&&t.every((e=>0===e.size))&&G(e)},j={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},H=(e,t)=>e.context===t,z=e=>{try{e.copyToChannel(new Float32Array(1),0,-1)}catch(t){return!1}return!0},W=()=>new DOMException("","IndexSizeError"),$=e=>{e.getChannelData=(t=>n=>{try{return t.call(e,n)}catch(s){if(12===s.code)throw W();throw s}})(e.getChannelData)},Y={numberOfChannels:1},Q=-34028234663852886e22,X=-Q,Z=e=>b.has(e),K={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},J=e=>D(w,e),ee=e=>D(x,e),te=(e,t)=>{const{activeInputs:n}=J(e);n.forEach((n=>n.forEach((([n])=>{t.includes(e)||te(n,[...t,e])}))));const s=(e=>"playbackRate"in e)(e)?[e.playbackRate]:q(e)?Array.from(e.parameters.values()):(e=>"frequency"in e&&"gain"in e)(e)?[e.Q,e.detune,e.frequency,e.gain]:(e=>"offset"in e)(e)?[e.offset]:(e=>!("frequency"in e)&&"gain"in e)(e)?[e.gain]:(e=>"detune"in e&&"frequency"in e&&!("gain"in e))(e)?[e.detune,e.frequency]:(e=>"pan"in e)(e)?[e.pan]:[];for(const i of s){const e=ee(i);void 0!==e&&e.activeInputs.forEach((([e])=>te(e,t)))}Z(e)&&G(e)},ne=e=>{te(e.destination,[])},se=e=>"context"in e,ie=e=>se(e[0]),ae=(e,t,n,s)=>{for(const i of e)if(n(i)){if(s)return!1;throw Error("The set contains at least one similar element.")}return e.add(t),!0},re=(e,t,[n,s],i)=>{ae(e,[t,n,s],(e=>e[0]===t&&e[1]===n),i)},oe=(e,[t,n,s],i)=>{const a=e.get(t);void 0===a?e.set(t,new Set([[n,s]])):ae(a,[n,s],(e=>e[0]===n),i)},le=e=>"inputs"in e,ce=(e,t,n,s)=>{if(le(t)){const i=t.inputs[s];return e.connect(i,n,0),[i,n,0]}return e.connect(t,n,s),[t,n,s]},ue=(e,t,n)=>{for(const s of e)if(s[0]===t&&s[1]===n)return e.delete(s),s;return null},he=(e,t)=>{if(!B(e).delete(t))throw new Error("Missing the expected event listener.")},de=(e,t,n)=>{const s=D(e,t),i=V(s,(e=>e[0]===n));return 0===s.size&&e.delete(t),i},pe=(e,t,n,s)=>{le(t)?e.disconnect(t.inputs[s],n,0):e.disconnect(t,n,s)},me=e=>D(T,e),fe=e=>D(S,e),ge=e=>A.has(e),_e=e=>!b.has(e),ye=(e,t)=>new Promise((n=>{if(null!==t)n(!0);else{const t=e.createScriptProcessor(256,1,1),s=e.createGain(),i=e.createBuffer(1,2,44100),a=i.getChannelData(0);a[0]=1,a[1]=1;const r=e.createBufferSource();r.buffer=i,r.loop=!0,r.connect(t).connect(e.destination),r.connect(s),r.disconnect(s),t.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(e=>1===e))?n(!0):n(!1),r.stop(),t.onaudioprocess=null,r.disconnect(t),t.disconnect(e.destination)},r.start()}})),ve=(e,t)=>{const n=new Map;for(const s of e)for(const e of s){const t=n.get(e);n.set(e,void 0===t?1:t+1)}n.forEach(((e,n)=>t(n,e)))},be=e=>"context"in e,we=(e,t,n,s)=>{const{activeInputs:i,passiveInputs:a}=ee(t),{outputs:r}=J(e),o=B(e),l=r=>{const o=me(e),l=fe(t);if(r){const t=de(a,e,n);re(i,e,t,!1),s||ge(e)||o.connect(l,n)}else{const t=((e,t,n)=>V(e,(e=>e[0]===t&&e[1]===n)))(i,e,n);oe(a,t,!1),s||ge(e)||o.disconnect(l,n)}};return!!ae(r,[t,n],(e=>e[0]===t&&e[1]===n),!0)&&(o.add(l),Z(e)?re(i,e,[n,l],!0):oe(a,[e,n,l],!0),!0)},Te=(e,t,n,s,i)=>{const[a,r]=((e,t,n,s)=>{const{activeInputs:i,passiveInputs:a}=J(t),r=ue(i[s],e,n);if(null===r)return[L(a,e,n,s)[2],!1];return[r[2],!0]})(e,n,s,i);if(null!==a&&(he(e,a),!r||t||ge(e)||pe(me(e),me(n),s,i)),Z(n)){const{activeInputs:e}=J(n);U(n,e)}},xe=(e,t,n,s)=>{const[i,a]=((e,t,n)=>{const{activeInputs:s,passiveInputs:i}=ee(t),a=ue(s,e,n);if(null===a)return[de(i,e,n)[1],!1];return[a[2],!0]})(e,n,s);null!==i&&(he(e,i),!a||t||ge(e)||me(e).disconnect(fe(n),s))};class Se{constructor(e){this._map=new Map(e)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(e,t=null){return this._map.forEach(((n,s)=>e.call(t,n,s,this)))}get(e){return this._map.get(e)}has(e){return this._map.has(e)}keys(){return this._map.keys()}values(){return this._map.values()}}const Ee={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function Me(e,t,n,s,i){if("function"==typeof e.copyFromChannel)0===t[n].byteLength&&(t[n]=new Float32Array(128)),e.copyFromChannel(t[n],s,i);else{const a=e.getChannelData(s);if(0===t[n].byteLength)t[n]=a.slice(i,i+128);else{const e=new Float32Array(a.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);t[n].set(e)}}}const Ae=(e,t,n,s,i)=>{"function"==typeof e.copyToChannel?0!==t[n].byteLength&&e.copyToChannel(t[n],s,i):0!==t[n].byteLength&&e.getChannelData(s).set(t[n],i)},Ce=(e,t)=>{const n=[];for(let s=0;s<e;s+=1){const e=[],i="number"==typeof t?t:t[s];for(let t=0;t<i;t+=1)e.push(new Float32Array(128));n.push(e)}return n},Ie=(e,t,n,s,i,a,r)=>__async(this,null,(function*(){const o=null===t?128*Math.ceil(e.context.length/128):t.length,l=s.channelCount*s.numberOfInputs,c=i.reduce(((e,t)=>e+t),0),u=0===c?null:n.createBuffer(c,o,n.sampleRate);if(void 0===a)throw new Error("Missing the processor constructor.");const h=J(e),d=yield((e,t)=>{const n=D(I,e),s=me(t);return D(n,s)})(n,e),p=Ce(s.numberOfInputs,s.channelCount),m=Ce(s.numberOfOutputs,i),f=Array.from(e.parameters.keys()).reduce(((e,t)=>__spreadProps(__spreadValues({},e),{[t]:new Float32Array(128)})),{});for(let _=0;_<o;_+=128){if(s.numberOfInputs>0&&null!==t)for(let e=0;e<s.numberOfInputs;e+=1)for(let n=0;n<s.channelCount;n+=1)Me(t,p[e],n,n,_);void 0!==a.parameterDescriptors&&null!==t&&a.parameterDescriptors.forEach((({name:e},n)=>{Me(t,f,e,l+n,_)}));for(let e=0;e<s.numberOfInputs;e+=1)for(let t=0;t<i[e];t+=1)0===m[e][t].byteLength&&(m[e][t]=new Float32Array(128));try{const e=p.map(((e,t)=>0===h.activeInputs[t].size?[]:e)),t=r(_/n.sampleRate,n.sampleRate,(()=>d.process(e,m,f)));if(null!==u)for(let n=0,a=0;n<s.numberOfOutputs;n+=1){for(let e=0;e<i[n];e+=1)Ae(u,m[n],e,a+e,_);a+=i[n]}if(!t)break}catch(g){e.dispatchEvent(new ErrorEvent("processorerror",{colno:g.colno,filename:g.filename,lineno:g.lineno,message:g.message}));break}}return u})),ke={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},Oe={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},Pe={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},Ne={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},Re={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},De=e=>{const{port1:t,port2:n}=new MessageChannel;return new Promise((s=>{const i=()=>{n.onmessage=null,t.close(),n.close(),s()};n.onmessage=()=>i();try{t.postMessage(e,[e])}catch(a){}finally{i()}}))},Ve={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},Le=(e,t,n)=>{const s=t[n];if(void 0===s)throw e();return s},Be={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},Fe={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},qe=()=>new DOMException("","InvalidStateError"),Ge=()=>new DOMException("","InvalidAccessError"),Ue={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},je=(e,t,n,s,i,a,r,o,l,c,u)=>{const h=c.length;let d=o;for(let p=0;p<h;p+=1){let o=n[0]*c[p];for(let t=1;t<i;t+=1){const s=d-t&l-1;o+=n[t]*a[s],o-=e[t]*r[s]}for(let e=i;e<s;e+=1)o+=n[e]*a[d-e&l-1];for(let n=i;n<t;n+=1)o-=e[n]*r[d-n&l-1];a[d]=c[p],r[d]=o,d=d+1&l-1,u[p]=o}return d},He={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},ze=e=>{const t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=e.decodeAudioData(t.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch(n){}return!1},We=(e,t,n)=>{const s=t[n];void 0!==s&&s!==e[n]&&(e[n]=s)},$e=(e,t)=>{We(e,t,"channelCount"),We(e,t,"channelCountMode"),We(e,t,"channelInterpretation")},Ye=e=>"function"==typeof e.getFloatTimeDomainData,Qe=(e,t,n)=>{const s=t[n];void 0!==s&&s!==e[n].value&&(e[n].value=s)},Xe=e=>{e.start=(t=>(n=0,s=0,i)=>{if("number"==typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");t.call(e,n,s,i)})(e.start)},Ze=e=>{e.stop=(t=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");t.call(e,n)})(e.stop)},Ke=(e,t)=>null===e?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*t))))),Je=(e,t)=>__async(this,null,(function*(){const n=yield(e=>new Promise(((t,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:e})=>{s.close(),i.close(),t(e)},s.onmessageerror=({data:e})=>{s.close(),i.close(),n(e)},i.postMessage(e)})))(t);return new e(n)})),et=(e,t)=>{const n=e.createBiquadFilter();return $e(n,t),Qe(n,t,"Q"),Qe(n,t,"detune"),Qe(n,t,"frequency"),Qe(n,t,"gain"),We(n,t,"type"),n},tt=(e,t)=>{const n=e.createChannelSplitter(t.numberOfOutputs);return $e(n,t),(e=>{const t=e.numberOfOutputs;Object.defineProperty(e,"channelCount",{get:()=>t,set:e=>{if(e!==t)throw qe()}}),Object.defineProperty(e,"channelCountMode",{get:()=>"explicit",set:e=>{if("explicit"!==e)throw qe()}}),Object.defineProperty(e,"channelInterpretation",{get:()=>"discrete",set:e=>{if("discrete"!==e)throw qe()}})})(n),n},nt=(e,t)=>(e.connect=t.connect.bind(t),e.disconnect=t.disconnect.bind(t),e),st=(e,t)=>{const n=e.createDelay(t.maxDelayTime);return $e(n,t),Qe(n,t,"delayTime"),n},it=(e,t)=>{const n=e.createGain();return $e(n,t),Qe(n,t,"gain"),n};function at(e,t){const n=t[0]*t[0]+t[1]*t[1];return[(e[0]*t[0]+e[1]*t[1])/n,(e[1]*t[0]-e[0]*t[1])/n]}function rt(e,t){let n=[0,0];for(let a=e.length-1;a>=0;a-=1)i=t,n=[(s=n)[0]*i[0]-s[1]*i[1],s[0]*i[1]+s[1]*i[0]],n[0]+=e[a];var s,i;return n}const ot=(e,t,n,s)=>e.createScriptProcessor(t,n,s),lt=()=>new DOMException("","NotSupportedError"),ct={numberOfChannels:1},ut={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},ht={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},dt={disableNormalization:!1},pt={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},mt={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},ft=(e,t,n)=>void 0===e.copyFromChannel?e.getChannelData(n)[0]:(e.copyFromChannel(t,n),t[0]),gt=e=>{if(null===e)return!1;const t=e.length;return t%2!=0?0!==e[Math.floor(t/2)]:e[t/2-1]+e[t/2]!==0},_t=(e,t,n,s)=>{let i=e;for(;!i.hasOwnProperty(t);)i=Object.getPrototypeOf(i);const{get:a,set:r}=Object.getOwnPropertyDescriptor(i,t);Object.defineProperty(e,t,{get:n(a),set:s(r)})},yt=(e,t,n)=>{try{e.setValueAtTime(t,n)}catch(s){if(9!==s.code)throw s;yt(e,t,n+1e-7)}},vt=e=>{const t=e.createOscillator();try{t.start(-1)}catch(n){return n instanceof RangeError}return!1},bt=e=>{const t=e.createBuffer(1,1,44100),n=e.createBufferSource();n.buffer=t,n.start(),n.stop();try{return n.stop(),!0}catch(s){return!1}},wt=e=>{const t=e.createOscillator();try{t.stop(-1)}catch(n){return n instanceof RangeError}return!1},Tt=(e,t)=>{const n=t.createGain();e.connect(n);const s=(t=>()=>{t.call(e,n),e.removeEventListener("ended",s)})(e.disconnect);e.addEventListener("ended",s),nt(e,n),e.stop=(t=>{let s=!1;return(i=0)=>{if(s)try{t.call(e,i)}catch(a){n.gain.setValueAtTime(0,i)}else t.call(e,i),s=!0}})(e.stop)},xt=(e,t)=>n=>{const s={value:e};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"==typeof t?t.call(e,n):t.handleEvent.call(e,n)},St=(Et=ae,(e,t,[n,s,i],a)=>{Et(e[s],[t,n,i],(e=>e[0]===t&&e[1]===n),a)});var Et;const Mt=(e=>(t,n,[s,i,a],r)=>{const o=t.get(s);void 0===o?t.set(s,new Set([[i,n,a]])):e(o,[i,n,a],(e=>e[0]===i&&e[1]===n),r)})(ae),At=(Ct=V,(e,t,n,s)=>Ct(e[s],(e=>e[0]===t&&e[1]===n)));var Ct;const It=new WeakMap,kt=(Ot=It,e=>{var t;return null!==(t=Ot.get(e))&&void 0!==t?t:0});var Ot;const Pt=(Nt=new Map,Rt=new WeakMap,(e,t)=>{const n=Rt.get(e);if(void 0!==n)return n;const s=Nt.get(e);if(void 0!==s)return s;try{const n=t();return n instanceof Promise?(Nt.set(e,n),n.catch((()=>!1)).then((t=>(Nt.delete(e),Rt.set(e,t),t)))):(Rt.set(e,n),n)}catch(i){return Rt.set(e,!1),!1}});var Nt,Rt;const Dt="undefined"==typeof window?null:window,Vt=(Lt=Pt,Bt=W,(e,t)=>{const n=e.createAnalyser();if($e(n,t),!(t.maxDecibels>t.minDecibels))throw Bt();return We(n,t,"fftSize"),We(n,t,"maxDecibels"),We(n,t,"minDecibels"),We(n,t,"smoothingTimeConstant"),Lt(Ye,(()=>Ye(n)))||(e=>{e.getFloatTimeDomainData=t=>{const n=new Uint8Array(t.length);e.getByteTimeDomainData(n);const s=Math.max(n.length,e.fftSize);for(let e=0;e<s;e+=1)t[e]=.0078125*(n[e]-128);return t}})(n),n});var Lt,Bt;const Ft=(qt=J,e=>{const t=qt(e);if(null===t.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return t.renderer});var qt;const Gt=((e,t,n)=>(s,i,a)=>__async(this,null,(function*(){const r=e(s);yield Promise.all(r.activeInputs.map(((e,r)=>Array.from(e).map((e=>__async(this,[e],(function*([e,o]){const l=t(e),c=yield l.render(e,i),u=s.context.destination;n(e)||s===u&&n(s)||c.connect(a,o,r)})))))).reduce(((e,t)=>[...e,...t]),[]))})))(J,Ft,ge),Ut=((e,t,n)=>()=>{const s=new WeakMap,i=(i,a)=>__async(this,null,(function*(){let r=t(i);if(!H(r,a)){const t={channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,fftSize:r.fftSize,maxDecibels:r.maxDecibels,minDecibels:r.minDecibels,smoothingTimeConstant:r.smoothingTimeConstant};r=e(a,t)}return s.set(a,r),yield n(i,a,r),r}));return{render(e,t){const n=s.get(t);return void 0!==n?Promise.resolve(n):i(e,t)}}})(Vt,me,Gt),jt=(Ht=E,e=>{const t=Ht.get(e);if(void 0===t)throw qe();return t});var Ht;const zt=null===(Wt=Dt)?null:Wt.hasOwnProperty("OfflineAudioContext")?Wt.OfflineAudioContext:Wt.hasOwnProperty("webkitOfflineAudioContext")?Wt.webkitOfflineAudioContext:null;var Wt;const $t=(Yt=zt,e=>null!==Yt&&e instanceof Yt);var Yt;const Qt=new WeakMap,Xt=(Zt=xt,class{constructor(e){this._nativeEventTarget=e,this._listeners=new WeakMap}addEventListener(e,t,n){if(null!==t){let s=this._listeners.get(t);void 0===s&&(s=Zt(this,t),"function"==typeof t&&this._listeners.set(t,s)),this._nativeEventTarget.addEventListener(e,s,n)}}dispatchEvent(e){return this._nativeEventTarget.dispatchEvent(e)}removeEventListener(e,t,n){const s=null===t?void 0:this._listeners.get(t);this._nativeEventTarget.removeEventListener(e,void 0===s?null:s,n)}});var Zt;const Kt=(e=>null===e?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null)(Dt),Jt=(en=Kt,e=>null!==en&&e instanceof en);var en;const tn=(e=>t=>null!==e&&"function"==typeof e.AudioNode&&t instanceof e.AudioNode)(Dt),nn=(e=>t=>null!==e&&"function"==typeof e.AudioParam&&t instanceof e.AudioParam)(Dt),sn=(e=>null===e?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null)(Dt),an=((e,t,n,s,i,a,r,o,l,c,u,h,d,p,m,f)=>class extends c{constructor(t,s,i,a){super(i),this._context=t,this._nativeAudioNode=i;const r=u(t);h(r)&&!0!==n(ye,(()=>ye(r,f)))&&(e=>{const t=new Map;e.connect=(e=>(n,s=0,i=0)=>{const a=be(n)?e(n,s,i):e(n,s),r=t.get(n);return void 0===r?t.set(n,[{input:i,output:s}]):r.every((e=>e.input!==i||e.output!==s))&&r.push({input:i,output:s}),a})(e.connect.bind(e)),e.disconnect=(n=>(s,i,a)=>{if(n.apply(e),void 0===s)t.clear();else if("number"==typeof s)for(const[e,n]of t){const i=n.filter((e=>e.output!==s));0===i.length?t.delete(e):t.set(e,i)}else if(t.has(s))if(void 0===i)t.delete(s);else{const e=t.get(s);if(void 0!==e){const n=e.filter((e=>e.output!==i&&(e.input!==a||void 0===a)));0===n.length?t.delete(s):t.set(s,n)}}for(const[n,r]of t)r.forEach((t=>{be(n)?e.connect(n,t.output,t.input):e.connect(n,t.output)}))})(e.disconnect)})(i),T.set(this,i),M.set(this,new Set),"closed"!==t.state&&s&&F(this),e(this,a,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(e){this._nativeAudioNode.channelCount=e}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(e){this._nativeAudioNode.channelCountMode=e}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(e){this._nativeAudioNode.channelInterpretation=e}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(e,n=0,o=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const c=u(this._context),h=m(c);if(d(e)||p(e))throw a();if(se(e)){const i=me(e);try{const t=ce(this._nativeAudioNode,i,n,o),s=_e(this);(h||s)&&this._nativeAudioNode.disconnect(...t),"closed"!==this.context.state&&!s&&_e(e)&&F(e)}catch(g){if(12===g.code)throw a();throw g}if(t(this,e,n,o,h)){const t=l([this],e);ve(t,s(h))}return e}const f=fe(e);if("playbackRate"===f.name&&1024===f.maxValue)throw r();try{this._nativeAudioNode.connect(f,n),(h||_e(this))&&this._nativeAudioNode.disconnect(f,n)}catch(g){if(12===g.code)throw a();throw g}if(we(this,e,n,h)){const t=l([this],e);ve(t,s(h))}}disconnect(e,t,n){let s;const r=u(this._context),c=m(r);if(void 0===e)s=((e,t)=>{const n=J(e),s=[];for(const i of n.outputs)ie(i)?Te(e,t,...i):xe(e,t,...i),s.push(i[0]);return n.outputs.clear(),s})(this,c);else if("number"==typeof e){if(e<0||e>=this.numberOfOutputs)throw i();s=((e,t,n)=>{const s=J(e),i=[];for(const a of s.outputs)a[1]===n&&(ie(a)?Te(e,t,...a):xe(e,t,...a),i.push(a[0]),s.outputs.delete(a));return i})(this,c,e)}else{if(void 0!==t&&(t<0||t>=this.numberOfOutputs))throw i();if(se(e)&&void 0!==n&&(n<0||n>=e.numberOfInputs))throw i();if(s=((e,t,n,s,i)=>{const a=J(e);return Array.from(a.outputs).filter((e=>!(e[0]!==n||void 0!==s&&e[1]!==s||void 0!==i&&e[2]!==i))).map((n=>(ie(n)?Te(e,t,...n):xe(e,t,...n),a.outputs.delete(n),n[0])))})(this,c,e,t,n),0===s.length)throw a()}for(const i of s){const e=l([this],i);ve(e,o)}}})((rn=w,(e,t,n)=>{const s=[];for(let i=0;i<n.numberOfInputs;i+=1)s.push(new Set);rn.set(e,{activeInputs:s,outputs:new Set,passiveInputs:new WeakMap,renderer:t})}),((e,t,n,s,i,a,r,o,l,c,u,h,d)=>{const p=new WeakMap;return(m,f,g,_,y)=>{const{activeInputs:v,passiveInputs:b}=a(f),{outputs:w}=a(m),T=o(m),x=a=>{const o=l(f),c=l(m);if(a){const t=L(b,m,g,_);e(v,m,t,!1),y||h(m)||n(c,o,g,_),d(f)&&F(f)}else{const e=s(v,m,g,_);t(b,_,e,!1),y||h(m)||i(c,o,g,_);const n=r(f);if(0===n)u(f)&&U(f,v);else{const e=p.get(f);void 0!==e&&clearTimeout(e),p.set(f,setTimeout((()=>{u(f)&&U(f,v)}),1e3*n))}}};return!!c(w,[f,g,_],(e=>e[0]===f&&e[1]===g&&e[2]===_),!0)&&(T.add(x),u(m)?e(v,m,[g,_,x],!0):t(b,_,[m,g,x],!0),!0)}})(St,Mt,ce,At,pe,J,kt,B,me,ae,Z,ge,_e),Pt,((e,t,n,s,i,a)=>r=>(o,l)=>{const c=e.get(o);if(void 0===c){if(!r&&a(o)){const e=s(o),{outputs:a}=n(o);for(const n of a)if(ie(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.disconnect(t,n[1])}}e.set(o,l)}else e.set(o,c+l)})(A,pe,J,me,fe,Z),W,Ge,lt,((e,t,n,s,i,a,r,o)=>(l,c)=>{const u=t.get(l);if(void 0===u)throw new Error("Missing the expected cycle count.");const h=a(l.context),d=o(h);if(u===c){if(t.delete(l),!d&&r(l)){const t=s(l),{outputs:a}=n(l);for(const n of a)if(ie(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.connect(e,n[1])}}}else t.set(l,u-c)})(ce,A,J,me,fe,jt,Z,$t),((e,t,n)=>function s(i,a){const r=se(a)?a:n(e,a);if((e=>"delayTime"in e)(r))return[];if(i[0]===r)return[i];if(i.includes(r))return[];const{outputs:o}=t(r);return Array.from(o).map((e=>s([...i,r],e[0]))).reduce(((e,t)=>e.concat(t)),[])})(Qt,J,D),Xt,jt,Jt,tn,nn,$t,sn);var rn;const on=((e,t,n,s,i,a)=>class extends e{constructor(e,n){const r=i(e),o=__spreadValues(__spreadValues({},j),n),l=s(r,o);super(e,!1,l,a(r)?t():null),this._nativeAnalyserNode=l}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(e){this._nativeAnalyserNode.fftSize=e}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(e){const t=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=e,!(e>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=t,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(e){const t=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=e,!(this._nativeAnalyserNode.maxDecibels>e))throw this._nativeAnalyserNode.minDecibels=t,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(e){this._nativeAnalyserNode.smoothingTimeConstant=e}getByteFrequencyData(e){this._nativeAnalyserNode.getByteFrequencyData(e)}getByteTimeDomainData(e){this._nativeAnalyserNode.getByteTimeDomainData(e)}getFloatFrequencyData(e){this._nativeAnalyserNode.getFloatFrequencyData(e)}getFloatTimeDomainData(e){this._nativeAnalyserNode.getFloatTimeDomainData(e)}})(an,Ut,W,Vt,jt,$t),ln=new WeakSet,cn=(e=>null===e?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null)(Dt),un=(hn=new Uint32Array(1),e=>(hn[0]=e,hn[0]));var hn;const dn=((e,t)=>n=>{n.copyFromChannel=(s,i,a=0)=>{const r=e(a),o=e(i);if(o>=n.numberOfChannels)throw t();const l=n.length,c=n.getChannelData(o),u=s.length;for(let e=r<0?-r:0;e+r<l&&e<u;e+=1)s[e]=c[e+r]},n.copyToChannel=(s,i,a=0)=>{const r=e(a),o=e(i);if(o>=n.numberOfChannels)throw t();const l=n.length,c=n.getChannelData(o),u=s.length;for(let e=r<0?-r:0;e+r<l&&e<u;e+=1)c[e+r]=s[e]}})(un,W),pn=(mn=un,e=>{e.copyFromChannel=(t=>(n,s,i=0)=>{const a=mn(i),r=mn(s);if(a<e.length)return t.call(e,n,r,a)})(e.copyFromChannel),e.copyToChannel=(t=>(n,s,i=0)=>{const a=mn(i),r=mn(s);if(a<e.length)return t.call(e,n,r,a)})(e.copyToChannel)});var mn;const fn=((e,t,n,s,i,a,r,o)=>{let l=null;return class c{constructor(c){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:u,numberOfChannels:h,sampleRate:d}=__spreadValues(__spreadValues({},Y),c);null===l&&(l=new i(1,1,44100));const p=null!==s&&t(a,a)?new s({length:u,numberOfChannels:h,sampleRate:d}):l.createBuffer(h,u,d);if(0===p.numberOfChannels)throw n();return"function"!=typeof p.copyFromChannel?(r(p),$(p)):t(z,(()=>z(p)))||o(p),e.add(p),p}static[Symbol.hasInstance](t){return null!==t&&"object"==typeof t&&Object.getPrototypeOf(t)===c.prototype||e.has(t)}}})(ln,Pt,lt,cn,zt,(gn=cn,()=>{if(null===gn)return!1;try{new gn({length:1,sampleRate:44100})}catch(e){return!1}return!0}),dn,pn);var gn;const _n=(yn=it,(e,t)=>{const n=yn(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(n).connect(e.destination);const s=()=>{t.removeEventListener("ended",s),t.disconnect(n),n.disconnect()};t.addEventListener("ended",s)});var yn;const vn=((e,t,n)=>(s,i,a)=>__async(this,null,(function*(){const r=t(s);yield Promise.all(Array.from(r.activeInputs).map((t=>__async(this,[t],(function*([t,s]){const r=e(t),o=yield r.render(t,i);n(t)||o.connect(a,s)})))))})))(Ft,ee,ge),bn=(wn=vn,(e,t,n)=>wn(t,e,n));var wn;const Tn=((e,t,n,s,i,a,r,o,l,c,u)=>(h,d)=>{const p=h.createBufferSource();return $e(p,d),Qe(p,d,"playbackRate"),We(p,d,"buffer"),We(p,d,"loop"),We(p,d,"loopEnd"),We(p,d,"loopStart"),t(n,(()=>n(h)))||(e=>{e.start=(t=>{let n=!1;return(s=0,i=0,a)=>{if(n)throw qe();t.call(e,s,i,a),n=!0}})(e.start)})(p),t(s,(()=>s(h)))||l(p),t(i,(()=>i(h)))||c(p,h),t(a,(()=>a(h)))||Xe(p),t(r,(()=>r(h)))||u(p,h),t(o,(()=>o(h)))||Ze(p),e(h,p),p})(_n,Pt,(e=>{const t=e.createBufferSource();t.start();try{t.start()}catch(n){return!0}return!1}),(e=>{const t=e.createBufferSource(),n=e.createBuffer(1,1,44100);t.buffer=n;try{t.start(0,1)}catch(s){return!1}return!0}),(e=>{const t=e.createBufferSource();t.start();try{t.stop()}catch(n){return!1}return!0}),vt,bt,wt,(e=>{e.start=(t=>(n=0,s=0,i)=>{const a=e.buffer,r=null===a?s:Math.min(a.duration,s);null!==a&&r>a.duration-.5/e.context.sampleRate?t.call(e,n,0,0):t.call(e,n,r,i)})(e.start)}),(xn=_t,(e,t)=>{const n=t.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=n),xn(e,"buffer",(t=>()=>{const s=t.call(e);return s===n?null:s}),(t=>s=>t.call(e,null===s?n:s)))}),Tt);var xn;const Sn=((e,t)=>(n,s,i)=>(e(s).replay(i),t(s,n,i)))((En=ee,e=>{const t=En(e);if(null===t.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return t.renderer}),vn);var En;const Mn=((e,t,n,s,i)=>()=>{const a=new WeakMap;let r=null,o=null;const l=(l,c)=>__async(this,null,(function*(){let u=n(l);const h=H(u,c);if(!h){const e={buffer:u.buffer,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,loop:u.loop,loopEnd:u.loopEnd,loopStart:u.loopStart,playbackRate:u.playbackRate.value};u=t(c,e),null!==r&&u.start(...r),null!==o&&u.stop(o)}return a.set(c,u),h?yield e(c,l.playbackRate,u.playbackRate):yield s(c,l.playbackRate,u.playbackRate),yield i(l,c,u),u}));return{set start(e){r=e},set stop(e){o=e},render(e,t){const n=a.get(t);return void 0!==n?Promise.resolve(n):l(e,t)}}})(bn,Tn,me,Sn,Gt),An=((e,t,n,s,i,a,r,o,l,c,u,h,d)=>(p,m,f,g=null,_=null)=>{const y=f.value,b=new v(y),w=m?s(b):null,T={get defaultValue(){return y},get maxValue(){return null===g?f.maxValue:g},get minValue(){return null===_?f.minValue:_},get value(){return f.value},set value(e){f.value=e,T.setValueAtTime(e,p.context.currentTime)},cancelAndHoldAtTime(e){if("function"==typeof f.cancelAndHoldAtTime)null===w&&b.flush(p.context.currentTime),b.add(i(e)),f.cancelAndHoldAtTime(e);else{const t=Array.from(b).pop();null===w&&b.flush(p.context.currentTime),b.add(i(e));const n=Array.from(b).pop();f.cancelScheduledValues(e),t!==n&&void 0!==n&&("exponentialRampToValue"===n.type?f.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?f.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?f.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&f.setValueCurveAtTime(n.values,n.startTime,n.duration))}return T},cancelScheduledValues:e=>(null===w&&b.flush(p.context.currentTime),b.add(a(e)),f.cancelScheduledValues(e),T),exponentialRampToValueAtTime(e,t){if(0===e)throw new RangeError;if(!Number.isFinite(t)||t<0)throw new RangeError;const n=p.context.currentTime;return null===w&&b.flush(n),0===Array.from(b).length&&(b.add(c(y,n)),f.setValueAtTime(y,n)),b.add(r(e,t)),f.exponentialRampToValueAtTime(e,t),T},linearRampToValueAtTime(e,t){const n=p.context.currentTime;return null===w&&b.flush(n),0===Array.from(b).length&&(b.add(c(y,n)),f.setValueAtTime(y,n)),b.add(o(e,t)),f.linearRampToValueAtTime(e,t),T},setTargetAtTime:(e,t,n)=>(null===w&&b.flush(p.context.currentTime),b.add(l(e,t,n)),f.setTargetAtTime(e,t,n),T),setValueAtTime:(e,t)=>(null===w&&b.flush(p.context.currentTime),b.add(c(e,t)),f.setValueAtTime(e,t),T),setValueCurveAtTime(e,t,n){const s=e instanceof Float32Array?e:new Float32Array(e);if(null!==h&&"webkitAudioContext"===h.name){const e=t+n,i=p.context.sampleRate,a=Math.ceil(t*i),r=Math.floor(e*i),o=r-a,l=new Float32Array(o);for(let u=0;u<o;u+=1){const e=(s.length-1)/n*((a+u)/i-t),r=Math.floor(e),o=Math.ceil(e);l[u]=r===o?s[r]:(1-(e-r))*s[r]+(1-(o-e))*s[o]}null===w&&b.flush(p.context.currentTime),b.add(u(l,t,n)),f.setValueCurveAtTime(l,t,n);const c=r/i;c<e&&d(T,l[l.length-1],c),d(T,s[s.length-1],e)}else null===w&&b.flush(p.context.currentTime),b.add(u(s,t,n)),f.setValueCurveAtTime(s,t,n);return T}};return n.set(T,f),t.set(T,p),e(T,w),T})((Cn=x,(e,t)=>{Cn.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})}),Qt,S,(e=>({replay(t){for(const n of e)if("exponentialRampToValue"===n.type){const{endTime:e,value:s}=n;t.exponentialRampToValueAtTime(s,e)}else if("linearRampToValue"===n.type){const{endTime:e,value:s}=n;t.linearRampToValueAtTime(s,e)}else if("setTarget"===n.type){const{startTime:e,target:s,timeConstant:i}=n;t.setTargetAtTime(s,e,i)}else if("setValue"===n.type){const{startTime:e,value:s}=n;t.setValueAtTime(s,e)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:e,startTime:s,values:i}=n;t.setValueCurveAtTime(i,s,e)}}}})),(e=>({cancelTime:e,type:"cancelAndHold"})),(e=>({cancelTime:e,type:"cancelScheduledValues"})),((e,t)=>({endTime:t,type:"exponentialRampToValue",value:e})),((e,t)=>({endTime:t,type:"linearRampToValue",value:e})),((e,t,n)=>({startTime:t,target:e,timeConstant:n,type:"setTarget"})),n,s,Kt,yt);var Cn;const In=((e,t,n,s,i,a,r,o)=>class extends e{constructor(e,s){const o=a(e),l=__spreadValues(__spreadValues({},K),s),c=i(o,l),u=r(o),h=u?t():null;super(e,!1,c,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==l.buffer,this._nativeAudioBufferSourceNode=c,this._onended=null,this._playbackRate=n(this,u,c.playbackRate,X,Q)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(e){if(this._nativeAudioBufferSourceNode.buffer=e,null!==e){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(e){this._nativeAudioBufferSourceNode.loop=e}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(e){this._nativeAudioBufferSourceNode.loopEnd=e}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(e){this._nativeAudioBufferSourceNode.loopStart=e}get onended(){return this._onended}set onended(e){const t="function"==typeof e?o(this,e):null;this._nativeAudioBufferSourceNode.onended=t;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===t?e:n}get playbackRate(){return this._playbackRate}start(e=0,t=0,n){if(this._nativeAudioBufferSourceNode.start(e,t,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[e,t]:[e,t,n]),"closed"!==this.context.state){F(this);const e=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",e),Z(this)&&G(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",e)}}stop(e=0){this._nativeAudioBufferSourceNode.stop(e),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=e)}})(an,Mn,An,qe,Tn,jt,$t,xt),kn=((e,t,n,s,i,a,r,o)=>class extends e{constructor(e,n){const s=a(e),l=r(s),c=i(s,n,l);super(e,!1,c,l?t(o):null),this._isNodeOfNativeOfflineAudioContext=l,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(e){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(e>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=e}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(e){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=e}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}})(an,(e=>{const t=new WeakMap,n=(n,s)=>__async(this,null,(function*(){const i=s.destination;return t.set(s,i),yield e(n,s,i),i}));return{render(e,s){const i=t.get(s);return void 0!==i?Promise.resolve(i):n(e,s)}}}),W,qe,((e,t)=>(n,s,i)=>{const a=n.destination;if(a.channelCount!==s)try{a.channelCount=s}catch(o){}i&&"explicit"!==a.channelCountMode&&(a.channelCountMode="explicit"),0===a.maxChannelCount&&Object.defineProperty(a,"maxChannelCount",{value:s});const r=e(n,{channelCount:s,channelCountMode:a.channelCountMode,channelInterpretation:a.channelInterpretation,gain:1});return t(r,"channelCount",(e=>()=>e.call(r)),(e=>t=>{e.call(r,t);try{a.channelCount=t}catch(n){if(t>a.maxChannelCount)throw n}})),t(r,"channelCountMode",(e=>()=>e.call(r)),(e=>t=>{e.call(r,t),a.channelCountMode=t})),t(r,"channelInterpretation",(e=>()=>e.call(r)),(e=>t=>{e.call(r,t),a.channelInterpretation=t})),Object.defineProperty(r,"maxChannelCount",{get:()=>a.maxChannelCount}),r.connect(a),r})(it,_t),jt,$t,Gt),On=((e,t,n,s,i)=>()=>{const a=new WeakMap,r=(r,o)=>__async(this,null,(function*(){let l=n(r);const c=H(l,o);if(!c){const e={Q:l.Q.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,detune:l.detune.value,frequency:l.frequency.value,gain:l.gain.value,type:l.type};l=t(o,e)}return a.set(o,l),c?(yield e(o,r.Q,l.Q),yield e(o,r.detune,l.detune),yield e(o,r.frequency,l.frequency),yield e(o,r.gain,l.gain)):(yield s(o,r.Q,l.Q),yield s(o,r.detune,l.detune),yield s(o,r.frequency,l.frequency),yield s(o,r.gain,l.gain)),yield i(r,o,l),l}));return{render(e,t){const n=a.get(t);return void 0!==n?Promise.resolve(n):r(e,t)}}})(bn,et,me,Sn,Gt),Pn=(e=>(t,n)=>e.set(t,n))(It),Nn=(Rn=an,Dn=An,Vn=On,Ln=Ge,Bn=et,Fn=jt,qn=$t,Gn=Pn,class extends Rn{constructor(e,t){const n=Fn(e),s=__spreadValues(__spreadValues({},ke),t),i=Bn(n,s),a=qn(n);super(e,!1,i,a?Vn():null),this._Q=Dn(this,a,i.Q,X,Q),this._detune=Dn(this,a,i.detune,1200*Math.log2(X),-1200*Math.log2(X)),this._frequency=Dn(this,a,i.frequency,e.sampleRate/2,0),this._gain=Dn(this,a,i.gain,40*Math.log10(X),Q),this._nativeBiquadFilterNode=i,Gn(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(e){this._nativeBiquadFilterNode.type=e}getFrequencyResponse(e,t,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(e,t,n)}catch(s){if(11===s.code)throw Ln();throw s}if(e.length!==t.length||t.length!==n.length)throw Ln()}});var Rn,Dn,Vn,Ln,Bn,Fn,qn,Gn;const Un=((e,t)=>(n,s,i)=>{const a=new Set;return n.connect=(i=>(r,o=0,l=0)=>{const c=0===a.size;if(t(r))return i.call(n,r,o,l),e(a,[r,o,l],(e=>e[0]===r&&e[1]===o&&e[2]===l),!0),c&&s(),r;i.call(n,r,o),e(a,[r,o],(e=>e[0]===r&&e[1]===o),!0),c&&s()})(n.connect),n.disconnect=(e=>(s,r,o)=>{const l=a.size>0;if(void 0===s)e.apply(n),a.clear();else if("number"==typeof s){e.call(n,s);for(const e of a)e[1]===s&&a.delete(e)}else{t(s)?e.call(n,s,r,o):e.call(n,s,r);for(const e of a)e[0]!==s||void 0!==r&&e[1]!==r||void 0!==o&&e[2]!==o||a.delete(e)}const c=0===a.size;l&&c&&i()})(n.disconnect),n})(ae,tn);var jn,Hn;const zn=((e,t)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==e&&"webkitAudioContext"===e.name&&t(n,i),$e(i,s),i})(Kt,(jn=qe,Hn=Un,(e,t)=>{t.channelCount=1,t.channelCountMode="explicit",Object.defineProperty(t,"channelCount",{get:()=>1,set:()=>{throw jn()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:()=>{throw jn()}});const n=e.createBufferSource();Hn(t,(()=>{const e=t.numberOfInputs;for(let s=0;s<e;s+=1)n.connect(t,0,s)}),(()=>n.disconnect(t)))})),Wn=((e,t,n,s,i)=>class extends e{constructor(e,a){const r=s(e),o=__spreadValues(__spreadValues({},Oe),a);super(e,!1,n(r,o),i(r)?t():null)}})(an,((e,t,n)=>()=>{const s=new WeakMap,i=(i,a)=>__async(this,null,(function*(){let r=t(i);if(!H(r,a)){const t={channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,numberOfInputs:r.numberOfInputs};r=e(a,t)}return s.set(a,r),yield n(i,a,r),r}));return{render(e,t){const n=s.get(t);return void 0!==n?Promise.resolve(n):i(e,t)}}})(zn,me,Gt),zn,jt,$t),$n=((e,t,n,s,i,a)=>class extends e{constructor(e,r){const o=s(e),l=a(__spreadValues(__spreadValues({},Pe),r));super(e,!1,n(o,l),i(o)?t():null)}})(an,((e,t,n)=>()=>{const s=new WeakMap,i=(i,a)=>__async(this,null,(function*(){let r=t(i);if(!H(r,a)){const t={channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,numberOfOutputs:r.numberOfOutputs};r=e(a,t)}return s.set(a,r),yield n(i,a,r),r}));return{render(e,t){const n=s.get(t);return void 0!==n?Promise.resolve(n):i(e,t)}}})(tt,me,Gt),tt,jt,$t,(e=>__spreadProps(__spreadValues({},e),{channelCount:e.numberOfOutputs}))),Yn=((e,t,n,s)=>(i,a)=>{var r=a,{offset:o}=r,l=__objRest(r,["offset"]);const c=i.createBuffer(1,2,44100),u=t(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),h=n(i,__spreadProps(__spreadValues({},l),{gain:o})),d=c.getChannelData(0);d[0]=1,d[1]=1,u.buffer=c,u.loop=!0;const p={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(e){h.channelCount=e},get channelCountMode(){return h.channelCountMode},set channelCountMode(e){h.channelCountMode=e},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(e){h.channelInterpretation=e},get context(){return h.context},get inputs(){return[]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get offset(){return h.gain},get onended(){return u.onended},set onended(e){u.onended=e},addEventListener:(...e)=>u.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>u.dispatchEvent(e[0]),removeEventListener:(...e)=>u.removeEventListener(e[0],e[1],e[2]),start(e=0){u.start.call(u,e)},stop(e=0){u.stop.call(u,e)}};return e(i,u),s(nt(p,h),(()=>u.connect(h)),(()=>u.disconnect(h)))})(_n,Tn,it,Un),Qn=((e,t,n,s,i)=>(a,r)=>{if(void 0===a.createConstantSource)return n(a,r);const o=a.createConstantSource();return $e(o,r),Qe(o,r,"offset"),t(s,(()=>s(a)))||Xe(o),t(i,(()=>i(a)))||Ze(o),e(a,o),o})(_n,Pt,Yn,vt,wt),Xn=((e,t,n,s,i,a,r)=>class extends e{constructor(e,r){const o=i(e),l=__spreadValues(__spreadValues({},Ne),r),c=s(o,l),u=a(o),h=u?n():null;super(e,!1,c,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=c,this._offset=t(this,u,c.offset,X,Q),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(e){const t="function"==typeof e?r(this,e):null;this._nativeConstantSourceNode.onended=t;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===t?e:n}start(e=0){if(this._nativeConstantSourceNode.start(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=e),"closed"!==this.context.state){F(this);const e=()=>{this._nativeConstantSourceNode.removeEventListener("ended",e),Z(this)&&G(this)};this._nativeConstantSourceNode.addEventListener("ended",e)}}stop(e=0){this._nativeConstantSourceNode.stop(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=e)}})(an,An,((e,t,n,s,i)=>()=>{const a=new WeakMap;let r=null,o=null;const l=(l,c)=>__async(this,null,(function*(){let u=n(l);const h=H(u,c);if(!h){const e={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,offset:u.offset.value};u=t(c,e),null!==r&&u.start(r),null!==o&&u.stop(o)}return a.set(c,u),h?yield e(c,l.offset,u.offset):yield s(c,l.offset,u.offset),yield i(l,c,u),u}));return{set start(e){r=e},set stop(e){o=e},render(e,t){const n=a.get(t);return void 0!==n?Promise.resolve(n):l(e,t)}}})(bn,Qn,me,Sn,Gt),Qn,jt,$t,xt),Zn=((e,t)=>(n,s)=>{const i=n.createConvolver();if($e(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),We(i,s,"buffer"),s.channelCount>2)throw e();if(t(i,"channelCount",(e=>()=>e.call(i)),(t=>n=>{if(n>2)throw e();return t.call(i,n)})),"max"===s.channelCountMode)throw e();return t(i,"channelCountMode",(e=>()=>e.call(i)),(t=>n=>{if("max"===n)throw e();return t.call(i,n)})),i})(lt,_t),Kn=((e,t,n,s,i,a)=>class extends e{constructor(e,r){const o=s(e),l=__spreadValues(__spreadValues({},Re),r),c=n(o,l);super(e,!1,c,i(o)?t():null),this._isBufferNullified=!1,this._nativeConvolverNode=c,null!==l.buffer&&a(this,l.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(e){if(this._nativeConvolverNode.buffer=e,null===e&&null!==this._nativeConvolverNode.buffer){const e=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=e.createBuffer(1,1,e.sampleRate),this._isBufferNullified=!0,a(this,0)}else this._isBufferNullified=!1,a(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(e){this._nativeConvolverNode.normalize=e}})(an,((e,t,n)=>()=>{const s=new WeakMap,i=(i,a)=>__async(this,null,(function*(){let r=t(i);if(!H(r,a)){const t={buffer:r.buffer,channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,disableNormalization:!r.normalize};r=e(a,t)}return s.set(a,r),le(r)?yield n(i,a,r.inputs[0]):yield n(i,a,r),r}));return{render(e,t){const n=s.get(t);return void 0!==n?Promise.resolve(n):i(e,t)}}})(Zn,me,Gt),Zn,jt,$t,Pn),Jn=((e,t,n,s,i,a,r)=>class extends e{constructor(e,o){const l=i(e),c=__spreadValues(__spreadValues({},Ve),o),u=s(l,c),h=a(l);super(e,!1,u,h?n(c.maxDelayTime):null),this._delayTime=t(this,h,u.delayTime),r(this,c.maxDelayTime)}get delayTime(){return this._delayTime}})(an,An,((e,t,n,s,i)=>a=>{const r=new WeakMap,o=(o,l)=>__async(this,null,(function*(){let c=n(o);const u=H(c,l);if(!u){const e={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,delayTime:c.delayTime.value,maxDelayTime:a};c=t(l,e)}return r.set(l,c),u?yield e(l,o.delayTime,c.delayTime):yield s(l,o.delayTime,c.delayTime),yield i(o,l,c),c}));return{render(e,t){const n=r.get(t);return void 0!==n?Promise.resolve(n):o(e,t)}}})(bn,st,me,Sn,Gt),st,jt,$t,Pn),es=(ts=lt,(e,t)=>{const n=e.createDynamicsCompressor();if($e(n,t),t.channelCount>2)throw ts();if("max"===t.channelCountMode)throw ts();return Qe(n,t,"attack"),Qe(n,t,"knee"),Qe(n,t,"ratio"),Qe(n,t,"release"),Qe(n,t,"threshold"),n});var ts;const ns=((e,t,n,s,i,a,r,o)=>class extends e{constructor(e,i){const l=a(e),c=__spreadValues(__spreadValues({},Be),i),u=s(l,c),h=r(l);super(e,!1,u,h?n():null),this._attack=t(this,h,u.attack),this._knee=t(this,h,u.knee),this._nativeDynamicsCompressorNode=u,this._ratio=t(this,h,u.ratio),this._release=t(this,h,u.release),this._threshold=t(this,h,u.threshold),o(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(e){const t=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=e,e>2)throw this._nativeDynamicsCompressorNode.channelCount=t,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(e){const t=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=e,"max"===e)throw this._nativeDynamicsCompressorNode.channelCountMode=t,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"==typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}})(an,An,((e,t,n,s,i)=>()=>{const a=new WeakMap,r=(r,o)=>__async(this,null,(function*(){let l=n(r);const c=H(l,o);if(!c){const e={attack:l.attack.value,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,knee:l.knee.value,ratio:l.ratio.value,release:l.release.value,threshold:l.threshold.value};l=t(o,e)}return a.set(o,l),c?(yield e(o,r.attack,l.attack),yield e(o,r.knee,l.knee),yield e(o,r.ratio,l.ratio),yield e(o,r.release,l.release),yield e(o,r.threshold,l.threshold)):(yield s(o,r.attack,l.attack),yield s(o,r.knee,l.knee),yield s(o,r.ratio,l.ratio),yield s(o,r.release,l.release),yield s(o,r.threshold,l.threshold)),yield i(r,o,l),l}));return{render(e,t){const n=a.get(t);return void 0!==n?Promise.resolve(n):r(e,t)}}})(bn,es,me,Sn,Gt),es,lt,jt,$t,Pn),ss=((e,t,n,s,i)=>()=>{const a=new WeakMap,r=(r,o)=>__async(this,null,(function*(){let l=n(r);const c=H(l,o);if(!c){const e={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,gain:l.gain.value};l=t(o,e)}return a.set(o,l),c?yield e(o,r.gain,l.gain):yield s(o,r.gain,l.gain),yield i(r,o,l),l}));return{render(e,t){const n=a.get(t);return void 0!==n?Promise.resolve(n):r(e,t)}}})(bn,it,me,Sn,Gt),is=((e,t,n,s,i,a)=>class extends e{constructor(e,r){const o=i(e),l=__spreadValues(__spreadValues({},Fe),r),c=s(o,l),u=a(o);super(e,!1,c,u?n():null),this._gain=t(this,u,c.gain,X,Q)}get gain(){return this._gain}})(an,An,ss,it,jt,$t),as=((e,t,n,s)=>(i,a,{channelCount:r,channelCountMode:o,channelInterpretation:l,feedback:c,feedforward:u})=>{const h=Ke(a,i.sampleRate),d=c instanceof Float64Array?c:new Float64Array(c),p=u instanceof Float64Array?u:new Float64Array(u),m=d.length,f=p.length,g=Math.min(m,f);if(0===m||m>20)throw s();if(0===d[0])throw t();if(0===f||f>20)throw s();if(0===p[0])throw t();if(1!==d[0]){for(let e=0;e<f;e+=1)p[e]/=d[0];for(let e=1;e<m;e+=1)d[e]/=d[0]}const _=n(i,h,r,r);_.channelCount=r,_.channelCountMode=o,_.channelInterpretation=l;const y=[],v=[],b=[];for(let e=0;e<r;e+=1){y.push(0);const e=new Float32Array(32),t=new Float32Array(32);e.fill(0),t.fill(0),v.push(e),b.push(t)}_.onaudioprocess=e=>{const t=e.inputBuffer,n=e.outputBuffer,s=t.numberOfChannels;for(let i=0;i<s;i+=1){const e=t.getChannelData(i),s=n.getChannelData(i);y[i]=je(d,m,p,f,g,v[i],b[i],y[i],32,e,s)}};const w=i.sampleRate/2;return nt({get bufferSize(){return h},get channelCount(){return _.channelCount},set channelCount(e){_.channelCount=e},get channelCountMode(){return _.channelCountMode},set channelCountMode(e){_.channelCountMode=e},get channelInterpretation(){return _.channelInterpretation},set channelInterpretation(e){_.channelInterpretation=e},get context(){return _.context},get inputs(){return[_]},get numberOfInputs(){return _.numberOfInputs},get numberOfOutputs(){return _.numberOfOutputs},addEventListener:(...e)=>_.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>_.dispatchEvent(e[0]),getFrequencyResponse(t,n,s){if(t.length!==n.length||n.length!==s.length)throw e();const i=t.length;for(let e=0;e<i;e+=1){const i=-Math.PI*(t[e]/w),a=[Math.cos(i),Math.sin(i)],r=at(rt(p,a),rt(d,a));n[e]=Math.sqrt(r[0]*r[0]+r[1]*r[1]),s[e]=Math.atan2(r[1],r[0])}},removeEventListener:(...e)=>_.removeEventListener(e[0],e[1],e[2])},_)})(Ge,qe,ot,lt),rs=((e,t,n,s)=>i=>e(ze,(()=>ze(i)))?Promise.resolve(e(s,s)).then((e=>{if(!e){const e=n(i,512,0,1);i.oncomplete=()=>{e.onaudioprocess=null,e.disconnect()},e.onaudioprocess=()=>i.currentTime,e.connect(i.destination)}return i.startRendering()})):new Promise((e=>{const n=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=t=>{n.disconnect(),e(t.renderedBuffer)},n.connect(i.destination),i.startRendering()})))(Pt,it,ot,((e,t)=>()=>{if(null===t)return Promise.resolve(!1);const n=new t(1,1,44100),s=e(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((e=>{n.oncomplete=()=>{s.disconnect(),e(0!==n.currentTime)},n.startRendering()}))})(it,zt)),os=((e,t,n,s,i)=>(a,r)=>{const o=new WeakMap;let l=null;const c=(c,u)=>__async(this,null,(function*(){let h=null,d=t(c);const p=H(d,u);if(void 0===u.createIIRFilter?h=e(u,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=u.createIIRFilter(r,a)),o.set(u,null===h?d:h),null!==h){if(null===l){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new n(c.context.destination.channelCount,c.context.length,u.sampleRate);l=(()=>__async(this,null,(function*(){yield s(c,e,e.destination);return((e,t,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),a=s instanceof Float64Array?s:new Float64Array(s),r=i.length,o=a.length,l=Math.min(r,o);if(1!==i[0]){for(let e=0;e<r;e+=1)a[e]/=i[0];for(let e=1;e<o;e+=1)i[e]/=i[0]}const c=new Float32Array(32),u=new Float32Array(32),h=t.createBuffer(e.numberOfChannels,e.length,e.sampleRate),d=e.numberOfChannels;for(let p=0;p<d;p+=1){const t=e.getChannelData(p),n=h.getChannelData(p);c.fill(0),u.fill(0),je(i,r,a,o,l,c,u,0,32,t,n)}return h})(yield i(e),u,a,r)})))()}const e=yield l;return h.buffer=e,h.start(0),h}return yield s(c,u,d),d}));return{render(e,t){const n=o.get(t);return void 0!==n?Promise.resolve(n):c(e,t)}}})(Tn,me,zt,Gt,rs);var ls;const cs=((e,t,n,s,i,a)=>class extends e{constructor(e,r){const o=s(e),l=i(o),c=__spreadValues(__spreadValues({},Ue),r),u=t(o,l?null:e.baseLatency,c);super(e,!1,u,l?n(c.feedback,c.feedforward):null),(e=>{e.getFrequencyResponse=(t=>(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw Ge();return t.call(e,n,s,i)})(e.getFrequencyResponse)})(u),this._nativeIIRFilterNode=u,a(this,1)}getFrequencyResponse(e,t,n){return this._nativeIIRFilterNode.getFrequencyResponse(e,t,n)}})(an,(ls=as,(e,t,n)=>{if(void 0===e.createIIRFilter)return ls(e,t,n);const s=e.createIIRFilter(n.feedforward,n.feedback);return $e(s,n),s}),os,jt,$t,Pn),us=((e,t,n,s,i,a,r,o)=>(l,c)=>{const u=c.listener,{forwardX:h,forwardY:d,forwardZ:p,positionX:m,positionY:f,positionZ:g,upX:_,upY:y,upZ:v}=void 0===u.forwardX?(()=>{const h=new Float32Array(1),d=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),p=r(c);let m=!1,f=[0,0,-1,0,1,0],g=[0,0,0];const _=()=>{if(m)return;m=!0;const e=s(c,256,9,0);e.onaudioprocess=({inputBuffer:e})=>{const t=[a(e,h,0),a(e,h,1),a(e,h,2),a(e,h,3),a(e,h,4),a(e,h,5)];t.some(((e,t)=>e!==f[t]))&&(u.setOrientation(...t),f=t);const n=[a(e,h,6),a(e,h,7),a(e,h,8)];n.some(((e,t)=>e!==g[t]))&&(u.setPosition(...n),g=n)},d.connect(e)},y=e=>t=>{t!==f[e]&&(f[e]=t,u.setOrientation(...f))},v=e=>t=>{t!==g[e]&&(g[e]=t,u.setPosition(...g))},b=(t,s,a)=>{const r=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});r.connect(d,0,t),r.start(),Object.defineProperty(r.offset,"defaultValue",{get:()=>s});const u=e({context:l},p,r.offset,X,Q);var h,m,f,g,y,v,b;return o(u,"value",(e=>()=>e.call(u)),(e=>t=>{try{e.call(u,t)}catch(n){if(9!==n.code)throw n}_(),p&&a(t)})),u.cancelAndHoldAtTime=(h=u.cancelAndHoldAtTime,p?()=>{throw i()}:(...e)=>{const t=h.apply(u,e);return _(),t}),u.cancelScheduledValues=(m=u.cancelScheduledValues,p?()=>{throw i()}:(...e)=>{const t=m.apply(u,e);return _(),t}),u.exponentialRampToValueAtTime=(f=u.exponentialRampToValueAtTime,p?()=>{throw i()}:(...e)=>{const t=f.apply(u,e);return _(),t}),u.linearRampToValueAtTime=(g=u.linearRampToValueAtTime,p?()=>{throw i()}:(...e)=>{const t=g.apply(u,e);return _(),t}),u.setTargetAtTime=(y=u.setTargetAtTime,p?()=>{throw i()}:(...e)=>{const t=y.apply(u,e);return _(),t}),u.setValueAtTime=(v=u.setValueAtTime,p?()=>{throw i()}:(...e)=>{const t=v.apply(u,e);return _(),t}),u.setValueCurveAtTime=(b=u.setValueCurveAtTime,p?()=>{throw i()}:(...e)=>{const t=b.apply(u,e);return _(),t}),u};return{forwardX:b(0,0,y(0)),forwardY:b(1,0,y(1)),forwardZ:b(2,-1,y(2)),positionX:b(6,0,v(0)),positionY:b(7,0,v(1)),positionZ:b(8,0,v(2)),upX:b(3,0,y(3)),upY:b(4,1,y(4)),upZ:b(5,0,y(5))}})():u;return{get forwardX(){return h},get forwardY(){return d},get forwardZ(){return p},get positionX(){return m},get positionY(){return f},get positionZ(){return g},get upX(){return _},get upY(){return y},get upZ(){return v}}})(An,zn,Qn,ot,lt,ft,$t,_t),hs=new WeakMap,ds=((e,t,n,s,i,a)=>class extends n{constructor(n,a){super(n),this._nativeContext=n,E.set(this,n),s(n)&&i.set(n,new Set),this._destination=new e(this,a),this._listener=t(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(e){const t="function"==typeof e?a(this,e):null;this._nativeContext.onstatechange=t;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===t?e:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}})(kn,us,Xt,$t,hs,xt),ps=((e,t,n,s,i,a)=>(r,o)=>{const l=r.createOscillator();return $e(l,o),Qe(l,o,"detune"),Qe(l,o,"frequency"),void 0!==o.periodicWave?l.setPeriodicWave(o.periodicWave):We(l,o,"type"),t(n,(()=>n(r)))||Xe(l),t(s,(()=>s(r)))||a(l,r),t(i,(()=>i(r)))||Ze(l),e(r,l),l})(_n,Pt,vt,bt,wt,Tt),ms=((e,t,n,s,i,a,r)=>class extends e{constructor(e,r){const o=i(e),l=__spreadValues(__spreadValues({},ut),r),c=n(o,l),u=a(o),h=u?s():null,d=e.sampleRate/2;super(e,!1,c,h),this._detune=t(this,u,c.detune,153600,-153600),this._frequency=t(this,u,c.frequency,d,-d),this._nativeOscillatorNode=c,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==l.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=l.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(e){const t="function"==typeof e?r(this,e):null;this._nativeOscillatorNode.onended=t;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===t?e:n}get type(){return this._nativeOscillatorNode.type}set type(e){this._nativeOscillatorNode.type=e,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(e){this._nativeOscillatorNode.setPeriodicWave(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=e)}start(e=0){if(this._nativeOscillatorNode.start(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=e),"closed"!==this.context.state){F(this);const e=()=>{this._nativeOscillatorNode.removeEventListener("ended",e),Z(this)&&G(this)};this._nativeOscillatorNode.addEventListener("ended",e)}}stop(e=0){this._nativeOscillatorNode.stop(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=e)}})(an,An,ps,((e,t,n,s,i)=>()=>{const a=new WeakMap;let r=null,o=null,l=null;const c=(c,u)=>__async(this,null,(function*(){let h=n(c);const d=H(h,u);if(!d){const e={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===r?void 0:r,type:h.type};h=t(u,e),null!==o&&h.start(o),null!==l&&h.stop(l)}return a.set(u,h),d?(yield e(u,c.detune,h.detune),yield e(u,c.frequency,h.frequency)):(yield s(u,c.detune,h.detune),yield s(u,c.frequency,h.frequency)),yield i(c,u,h),h}));return{set periodicWave(e){r=e},set start(e){o=e},set stop(e){l=e},render(e,t){const n=a.get(t);return void 0!==n?Promise.resolve(n):c(e,t)}}})(bn,ps,me,Sn,Gt),jt,$t,xt),fs=(gs=Tn,(e,t)=>{const n=gs(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),s=e.createBuffer(1,2,44100);return n.buffer=s,n.loop=!0,n.connect(t),n.start(),()=>{n.stop(),n.disconnect(t)}});var gs;const _s=((e,t,n,s,i)=>(a,r)=>{var o=r,{curve:l,oversample:c}=o,u=__objRest(o,["curve","oversample"]);const h=a.createWaveShaper(),d=a.createWaveShaper();$e(h,u),$e(d,u);const p=n(a,__spreadProps(__spreadValues({},u),{gain:1})),m=n(a,__spreadProps(__spreadValues({},u),{gain:-1})),f=n(a,__spreadProps(__spreadValues({},u),{gain:1})),g=n(a,__spreadProps(__spreadValues({},u),{gain:-1}));let _=null,y=!1,v=null;const b={get bufferSize(){},get channelCount(){return h.channelCount},set channelCount(e){p.channelCount=e,m.channelCount=e,h.channelCount=e,f.channelCount=e,d.channelCount=e,g.channelCount=e},get channelCountMode(){return h.channelCountMode},set channelCountMode(e){p.channelCountMode=e,m.channelCountMode=e,h.channelCountMode=e,f.channelCountMode=e,d.channelCountMode=e,g.channelCountMode=e},get channelInterpretation(){return h.channelInterpretation},set channelInterpretation(e){p.channelInterpretation=e,m.channelInterpretation=e,h.channelInterpretation=e,f.channelInterpretation=e,d.channelInterpretation=e,g.channelInterpretation=e},get context(){return h.context},get curve(){return v},set curve(n){if(null!==n&&n.length<2)throw t();if(null===n)h.curve=n,d.curve=n;else{const e=n.length,t=new Float32Array(e+2-e%2),s=new Float32Array(e+2-e%2);t[0]=n[0],s[0]=-n[e-1];const i=Math.ceil((e+1)/2),a=(e+1)/2-1;for(let r=1;r<i;r+=1){const o=r/i*a,l=Math.floor(o),c=Math.ceil(o);t[r]=l===c?n[l]:(1-(o-l))*n[l]+(1-(c-o))*n[c],s[r]=l===c?-n[e-1-l]:-(1-(o-l))*n[e-1-l]-(1-(c-o))*n[e-1-c]}t[i]=e%2==1?n[i-1]:(n[i-2]+n[i-1])/2,h.curve=t,d.curve=s}v=n,y&&(s(v)&&null===_?_=e(a,p):null!==_&&(_(),_=null))},get inputs(){return[p]},get numberOfInputs(){return h.numberOfInputs},get numberOfOutputs(){return h.numberOfOutputs},get oversample(){return h.oversample},set oversample(e){h.oversample=e,d.oversample=e},addEventListener:(...e)=>p.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>p.dispatchEvent(e[0]),removeEventListener:(...e)=>p.removeEventListener(e[0],e[1],e[2])};null!==l&&(b.curve=l instanceof Float32Array?l:new Float32Array(l)),c!==b.oversample&&(b.oversample=c);return i(nt(b,f),(()=>{p.connect(h).connect(f),p.connect(m).connect(d).connect(g).connect(f),y=!0,s(v)&&(_=e(a,p))}),(()=>{p.disconnect(h),h.disconnect(f),p.disconnect(m),m.disconnect(d),d.disconnect(g),g.disconnect(f),y=!1,null!==_&&(_(),_=null)}))})(fs,qe,it,gt,Un),ys=((e,t,n,s,i,a,r)=>(o,l)=>{const c=o.createWaveShaper();if(null!==a&&"webkitAudioContext"===a.name&&void 0===o.createGain().gain.automationRate)return n(o,l);$e(c,l);const u=null===l.curve||l.curve instanceof Float32Array?l.curve:new Float32Array(l.curve);if(null!==u&&u.length<2)throw t();We(c,{curve:u},"curve"),We(c,l,"oversample");let h=null,d=!1;r(c,"curve",(e=>()=>e.call(c)),(t=>n=>(t.call(c,n),d&&(s(n)&&null===h?h=e(o,c):s(n)||null===h||(h(),h=null)),n)));return i(c,(()=>{d=!0,s(c.curve)&&(h=e(o,c))}),(()=>{d=!1,null!==h&&(h(),h=null)}))})(fs,qe,_s,gt,Un,Kt,_t),vs=((e,t,n,s,i,a,r,o,l,c)=>(u,h)=>{var d=h,{coneInnerAngle:p,coneOuterAngle:m,coneOuterGain:f,distanceModel:g,maxDistance:_,orientationX:y,orientationY:v,orientationZ:b,panningModel:w,positionX:T,positionY:x,positionZ:S,refDistance:E,rolloffFactor:M}=d,A=__objRest(d,["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"]);const C=u.createPanner();if(A.channelCount>2)throw r();if("max"===A.channelCountMode)throw r();$e(C,A);const I={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},k=n(u,__spreadProps(__spreadValues({},I),{channelInterpretation:"speakers",numberOfInputs:6})),O=s(u,__spreadProps(__spreadValues({},A),{gain:1})),P=s(u,__spreadProps(__spreadValues({},I),{gain:1})),N=s(u,__spreadProps(__spreadValues({},I),{gain:0})),R=s(u,__spreadProps(__spreadValues({},I),{gain:0})),D=s(u,__spreadProps(__spreadValues({},I),{gain:0})),V=s(u,__spreadProps(__spreadValues({},I),{gain:0})),L=s(u,__spreadProps(__spreadValues({},I),{gain:0})),B=i(u,256,6,1),F=a(u,__spreadProps(__spreadValues({},I),{curve:new Float32Array([1,1]),oversample:"none"}));let q=[y,v,b],G=[T,x,S];const U=new Float32Array(1);B.onaudioprocess=({inputBuffer:e})=>{const t=[l(e,U,0),l(e,U,1),l(e,U,2)];t.some(((e,t)=>e!==q[t]))&&(C.setOrientation(...t),q=t);const n=[l(e,U,3),l(e,U,4),l(e,U,5)];n.some(((e,t)=>e!==G[t]))&&(C.setPosition(...n),G=n)},Object.defineProperty(N.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(V.gain,"defaultValue",{get:()=>0}),Object.defineProperty(L.gain,"defaultValue",{get:()=>0});const j={get bufferSize(){},get channelCount(){return C.channelCount},set channelCount(e){if(e>2)throw r();O.channelCount=e,C.channelCount=e},get channelCountMode(){return C.channelCountMode},set channelCountMode(e){if("max"===e)throw r();O.channelCountMode=e,C.channelCountMode=e},get channelInterpretation(){return C.channelInterpretation},set channelInterpretation(e){O.channelInterpretation=e,C.channelInterpretation=e},get coneInnerAngle(){return C.coneInnerAngle},set coneInnerAngle(e){C.coneInnerAngle=e},get coneOuterAngle(){return C.coneOuterAngle},set coneOuterAngle(e){C.coneOuterAngle=e},get coneOuterGain(){return C.coneOuterGain},set coneOuterGain(e){if(e<0||e>1)throw t();C.coneOuterGain=e},get context(){return C.context},get distanceModel(){return C.distanceModel},set distanceModel(e){C.distanceModel=e},get inputs(){return[O]},get maxDistance(){return C.maxDistance},set maxDistance(e){if(e<0)throw new RangeError;C.maxDistance=e},get numberOfInputs(){return C.numberOfInputs},get numberOfOutputs(){return C.numberOfOutputs},get orientationX(){return P.gain},get orientationY(){return N.gain},get orientationZ(){return R.gain},get panningModel(){return C.panningModel},set panningModel(e){C.panningModel=e},get positionX(){return D.gain},get positionY(){return V.gain},get positionZ(){return L.gain},get refDistance(){return C.refDistance},set refDistance(e){if(e<0)throw new RangeError;C.refDistance=e},get rolloffFactor(){return C.rolloffFactor},set rolloffFactor(e){if(e<0)throw new RangeError;C.rolloffFactor=e},addEventListener:(...e)=>O.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>O.dispatchEvent(e[0]),removeEventListener:(...e)=>O.removeEventListener(e[0],e[1],e[2])};p!==j.coneInnerAngle&&(j.coneInnerAngle=p),m!==j.coneOuterAngle&&(j.coneOuterAngle=m),f!==j.coneOuterGain&&(j.coneOuterGain=f),g!==j.distanceModel&&(j.distanceModel=g),_!==j.maxDistance&&(j.maxDistance=_),y!==j.orientationX.value&&(j.orientationX.value=y),v!==j.orientationY.value&&(j.orientationY.value=v),b!==j.orientationZ.value&&(j.orientationZ.value=b),w!==j.panningModel&&(j.panningModel=w),T!==j.positionX.value&&(j.positionX.value=T),x!==j.positionY.value&&(j.positionY.value=x),S!==j.positionZ.value&&(j.positionZ.value=S),E!==j.refDistance&&(j.refDistance=E),M!==j.rolloffFactor&&(j.rolloffFactor=M),1===q[0]&&0===q[1]&&0===q[2]||C.setOrientation(...q),0===G[0]&&0===G[1]&&0===G[2]||C.setPosition(...G);return c(nt(j,C),(()=>{O.connect(C),e(O,F,0,0),F.connect(P).connect(k,0,0),F.connect(N).connect(k,0,1),F.connect(R).connect(k,0,2),F.connect(D).connect(k,0,3),F.connect(V).connect(k,0,4),F.connect(L).connect(k,0,5),k.connect(B).connect(u.destination)}),(()=>{O.disconnect(C),o(O,F,0,0),F.disconnect(P),P.disconnect(k),F.disconnect(N),N.disconnect(k),F.disconnect(R),R.disconnect(k),F.disconnect(D),D.disconnect(k),F.disconnect(V),V.disconnect(k),F.disconnect(L),L.disconnect(k),k.disconnect(B),B.disconnect(u.destination)}))})(ce,qe,zn,it,ot,ys,lt,pe,ft,Un),bs=(ws=vs,(e,t)=>{const n=e.createPanner();return void 0===n.orientationX?ws(e,t):($e(n,t),Qe(n,t,"orientationX"),Qe(n,t,"orientationY"),Qe(n,t,"orientationZ"),Qe(n,t,"positionX"),Qe(n,t,"positionY"),Qe(n,t,"positionZ"),We(n,t,"coneInnerAngle"),We(n,t,"coneOuterAngle"),We(n,t,"coneOuterGain"),We(n,t,"distanceModel"),We(n,t,"maxDistance"),We(n,t,"panningModel"),We(n,t,"refDistance"),We(n,t,"rolloffFactor"),n)});var ws;const Ts=((e,t,n,s,i,a,r,o,l,c)=>()=>{const u=new WeakMap;let h=null;const d=(d,p)=>__async(this,null,(function*(){let m=null,f=a(d);const g={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation},_=__spreadProps(__spreadValues({},g),{coneInnerAngle:f.coneInnerAngle,coneOuterAngle:f.coneOuterAngle,coneOuterGain:f.coneOuterGain,distanceModel:f.distanceModel,maxDistance:f.maxDistance,panningModel:f.panningModel,refDistance:f.refDistance,rolloffFactor:f.rolloffFactor}),y=H(f,p);if("bufferSize"in f)m=s(p,__spreadProps(__spreadValues({},g),{gain:1}));else if(!y){const e=__spreadProps(__spreadValues({},_),{orientationX:f.orientationX.value,orientationY:f.orientationY.value,orientationZ:f.orientationZ.value,positionX:f.positionX.value,positionY:f.positionY.value,positionZ:f.positionZ.value});f=i(p,e)}if(u.set(p,null===m?f:m),null!==m){if(null===h){if(null===r)throw new Error("Missing the native OfflineAudioContext constructor.");const e=new r(6,d.context.length,p.sampleRate),s=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(e.destination),h=(()=>__async(this,null,(function*(){const t=yield Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(((t,s)=>__async(this,null,(function*(){const i=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return yield o(e,t,i.offset),i})))));for(let e=0;e<6;e+=1)t[e].connect(s,0,e),t[e].start(0);return c(e)})))()}const e=yield h,a=s(p,__spreadProps(__spreadValues({},g),{gain:1}));yield l(d,p,a);const u=[];for(let t=0;t<e.numberOfChannels;t+=1)u.push(e.getChannelData(t));let f=[u[0][0],u[1][0],u[2][0]],y=[u[3][0],u[4][0],u[5][0]],v=s(p,__spreadProps(__spreadValues({},g),{gain:1})),b=i(p,__spreadProps(__spreadValues({},_),{orientationX:f[0],orientationY:f[1],orientationZ:f[2],positionX:y[0],positionY:y[1],positionZ:y[2]}));a.connect(v).connect(b.inputs[0]),b.connect(m);for(let t=128;t<e.length;t+=128){const e=[u[0][t],u[1][t],u[2][t]],n=[u[3][t],u[4][t],u[5][t]];if(e.some(((e,t)=>e!==f[t]))||n.some(((e,t)=>e!==y[t]))){f=e,y=n;const r=t/p.sampleRate;v.gain.setValueAtTime(0,r),v=s(p,__spreadProps(__spreadValues({},g),{gain:0})),b=i(p,__spreadProps(__spreadValues({},_),{orientationX:f[0],orientationY:f[1],orientationZ:f[2],positionX:y[0],positionY:y[1],positionZ:y[2]})),v.gain.setValueAtTime(1,r),a.connect(v).connect(b.inputs[0]),b.connect(m)}}return m}return y?(yield e(p,d.orientationX,f.orientationX),yield e(p,d.orientationY,f.orientationY),yield e(p,d.orientationZ,f.orientationZ),yield e(p,d.positionX,f.positionX),yield e(p,d.positionY,f.positionY),yield e(p,d.positionZ,f.positionZ)):(yield o(p,d.orientationX,f.orientationX),yield o(p,d.orientationY,f.orientationY),yield o(p,d.orientationZ,f.orientationZ),yield o(p,d.positionX,f.positionX),yield o(p,d.positionY,f.positionY),yield o(p,d.positionZ,f.positionZ)),le(f)?yield l(d,p,f.inputs[0]):yield l(d,p,f),f}));return{render(e,t){const n=u.get(t);return void 0!==n?Promise.resolve(n):d(e,t)}}})(bn,zn,Qn,it,bs,me,zt,Sn,Gt,rs),xs=((e,t,n,s,i,a,r)=>class extends e{constructor(e,o){const l=i(e),c=__spreadValues(__spreadValues({},ht),o),u=n(l,c),h=a(l);super(e,!1,u,h?s():null),this._nativePannerNode=u,this._orientationX=t(this,h,u.orientationX,X,Q),this._orientationY=t(this,h,u.orientationY,X,Q),this._orientationZ=t(this,h,u.orientationZ,X,Q),this._positionX=t(this,h,u.positionX,X,Q),this._positionY=t(this,h,u.positionY,X,Q),this._positionZ=t(this,h,u.positionZ,X,Q),r(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(e){this._nativePannerNode.coneInnerAngle=e}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(e){this._nativePannerNode.coneOuterAngle=e}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(e){this._nativePannerNode.coneOuterGain=e}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(e){this._nativePannerNode.distanceModel=e}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(e){this._nativePannerNode.maxDistance=e}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(e){this._nativePannerNode.panningModel=e}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(e){this._nativePannerNode.refDistance=e}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(e){this._nativePannerNode.rolloffFactor=e}})(an,An,bs,Ts,jt,$t,Pn),Ss=(e=>(t,{disableNormalization:n,imag:s,real:i})=>{const a=s instanceof Float32Array?s:new Float32Array(s),r=i instanceof Float32Array?i:new Float32Array(i),o=t.createPeriodicWave(r,a,{disableNormalization:n});if(Array.from(s).length<2)throw e();return o})(W),Es=((e,t,n,s)=>class i{constructor(i,a){const r=t(i),o=s(__spreadValues(__spreadValues({},dt),a)),l=e(r,o);return n.add(l),l}static[Symbol.hasInstance](e){return null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===i.prototype||n.has(e)}})(Ss,jt,new WeakSet,(e=>{const{imag:t,real:n}=e;return __spreadProps(__spreadValues({},e),void 0===t?void 0===n?{imag:[0,0],real:[0,0]}:{imag:Array.from(n,(()=>0)),real:n}:void 0===n?{imag:t,real:Array.from(t,(()=>0))}:{imag:t,real:n})})),Ms=((e,t,n,s,i,a)=>{const r=16385,o=new Float32Array([1,1]),l=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},u=__spreadProps(__spreadValues({},c),{oversample:"none"}),h=(e,a,h,d,p)=>{if(1===a)return((e,t,i,a)=>{const h=new Float32Array(r),d=new Float32Array(r);for(let n=0;n<r;n+=1){const e=n/16384*l;h[n]=Math.cos(e),d[n]=Math.sin(e)}const p=n(e,__spreadProps(__spreadValues({},c),{gain:0})),m=s(e,__spreadProps(__spreadValues({},u),{curve:h})),f=s(e,__spreadProps(__spreadValues({},u),{curve:o})),g=n(e,__spreadProps(__spreadValues({},c),{gain:0})),_=s(e,__spreadProps(__spreadValues({},u),{curve:d}));return{connectGraph(){t.connect(p),t.connect(void 0===f.inputs?f:f.inputs[0]),t.connect(g),f.connect(i),i.connect(void 0===m.inputs?m:m.inputs[0]),i.connect(void 0===_.inputs?_:_.inputs[0]),m.connect(p.gain),_.connect(g.gain),p.connect(a,0,0),g.connect(a,0,1)},disconnectGraph(){t.disconnect(p),t.disconnect(void 0===f.inputs?f:f.inputs[0]),t.disconnect(g),f.disconnect(i),i.disconnect(void 0===m.inputs?m:m.inputs[0]),i.disconnect(void 0===_.inputs?_:_.inputs[0]),m.disconnect(p.gain),_.disconnect(g.gain),p.disconnect(a,0,0),g.disconnect(a,0,1)}}})(e,h,d,p);if(2===a)return((e,i,a,h)=>{const d=new Float32Array(r),p=new Float32Array(r),m=new Float32Array(r),f=new Float32Array(r),g=Math.floor(8192.5);for(let t=0;t<r;t+=1)if(t>g){const e=(t-g)/(16384-g)*l;d[t]=Math.cos(e),p[t]=Math.sin(e),m[t]=0,f[t]=1}else{const e=t/(16384-g)*l;d[t]=1,p[t]=0,m[t]=Math.cos(e),f[t]=Math.sin(e)}const _=t(e,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),y=n(e,__spreadProps(__spreadValues({},c),{gain:0})),v=s(e,__spreadProps(__spreadValues({},u),{curve:d})),b=n(e,__spreadProps(__spreadValues({},c),{gain:0})),w=s(e,__spreadProps(__spreadValues({},u),{curve:p})),T=s(e,__spreadProps(__spreadValues({},u),{curve:o})),x=n(e,__spreadProps(__spreadValues({},c),{gain:0})),S=s(e,__spreadProps(__spreadValues({},u),{curve:m})),E=n(e,__spreadProps(__spreadValues({},c),{gain:0})),M=s(e,__spreadProps(__spreadValues({},u),{curve:f}));return{connectGraph(){i.connect(_),i.connect(void 0===T.inputs?T:T.inputs[0]),_.connect(y,0),_.connect(b,0),_.connect(x,1),_.connect(E,1),T.connect(a),a.connect(void 0===v.inputs?v:v.inputs[0]),a.connect(void 0===w.inputs?w:w.inputs[0]),a.connect(void 0===S.inputs?S:S.inputs[0]),a.connect(void 0===M.inputs?M:M.inputs[0]),v.connect(y.gain),w.connect(b.gain),S.connect(x.gain),M.connect(E.gain),y.connect(h,0,0),x.connect(h,0,0),b.connect(h,0,1),E.connect(h,0,1)},disconnectGraph(){i.disconnect(_),i.disconnect(void 0===T.inputs?T:T.inputs[0]),_.disconnect(y,0),_.disconnect(b,0),_.disconnect(x,1),_.disconnect(E,1),T.disconnect(a),a.disconnect(void 0===v.inputs?v:v.inputs[0]),a.disconnect(void 0===w.inputs?w:w.inputs[0]),a.disconnect(void 0===S.inputs?S:S.inputs[0]),a.disconnect(void 0===M.inputs?M:M.inputs[0]),v.disconnect(y.gain),w.disconnect(b.gain),S.disconnect(x.gain),M.disconnect(E.gain),y.disconnect(h,0,0),x.disconnect(h,0,0),b.disconnect(h,0,1),E.disconnect(h,0,1)}}})(e,h,d,p);throw i()};return(t,s)=>{var r=s,{channelCount:o,channelCountMode:l,pan:c}=r,u=__objRest(r,["channelCount","channelCountMode","pan"]);if("max"===l)throw i();const d=e(t,__spreadProps(__spreadValues({},u),{channelCount:1,channelCountMode:l,numberOfInputs:2})),p=n(t,__spreadProps(__spreadValues({},u),{channelCount:o,channelCountMode:l,gain:1})),m=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:c});let{connectGraph:f,disconnectGraph:g}=h(t,o,p,m,d);Object.defineProperty(m.gain,"defaultValue",{get:()=>0}),Object.defineProperty(m.gain,"maxValue",{get:()=>1}),Object.defineProperty(m.gain,"minValue",{get:()=>-1});const _={get bufferSize(){},get channelCount(){return p.channelCount},set channelCount(e){p.channelCount!==e&&(y&&g(),({connectGraph:f,disconnectGraph:g}=h(t,e,p,m,d)),y&&f()),p.channelCount=e},get channelCountMode(){return p.channelCountMode},set channelCountMode(e){if("clamped-max"===e||"max"===e)throw i();p.channelCountMode=e},get channelInterpretation(){return p.channelInterpretation},set channelInterpretation(e){p.channelInterpretation=e},get context(){return p.context},get inputs(){return[p]},get numberOfInputs(){return p.numberOfInputs},get numberOfOutputs(){return p.numberOfOutputs},get pan(){return m.gain},addEventListener:(...e)=>p.addEventListener(e[0],e[1],e[2]),dispatchEvent:(...e)=>p.dispatchEvent(e[0]),removeEventListener:(...e)=>p.removeEventListener(e[0],e[1],e[2])};let y=!1;return a(nt(_,d),(()=>{f(),y=!0}),(()=>{g(),y=!1}))}})(zn,tt,it,ys,lt,Un),As=((e,t)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw t();if(void 0===n.createStereoPanner)return e(n,s);const a=n.createStereoPanner();return $e(a,s),Qe(a,s,"pan"),Object.defineProperty(a,"channelCountMode",{get:()=>i,set:e=>{if(e!==i)throw t()}}),a})(Ms,lt),Cs=((e,t,n,s,i,a)=>class extends e{constructor(e,r){const o=i(e),l=__spreadValues(__spreadValues({},pt),r),c=n(o,l),u=a(o);super(e,!1,c,u?s():null),this._pan=t(this,u,c.pan)}get pan(){return this._pan}})(an,An,As,((e,t,n,s,i)=>()=>{const a=new WeakMap,r=(r,o)=>__async(this,null,(function*(){let l=n(r);const c=H(l,o);if(!c){const e={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,pan:l.pan.value};l=t(o,e)}return a.set(o,l),c?yield e(o,r.pan,l.pan):yield s(o,r.pan,l.pan),le(l)?yield i(r,o,l.inputs[0]):yield i(r,o,l),l}));return{render(e,t){const n=a.get(t);return void 0!==n?Promise.resolve(n):r(e,t)}}})(bn,As,me,Sn,Gt),jt,$t),Is=((e,t,n)=>()=>{const s=new WeakMap,i=(i,a)=>__async(this,null,(function*(){let r=t(i);if(!H(r,a)){const t={channelCount:r.channelCount,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,curve:r.curve,oversample:r.oversample};r=e(a,t)}return s.set(a,r),le(r)?yield n(i,a,r.inputs[0]):yield n(i,a,r),r}));return{render(e,t){const n=s.get(t);return void 0!==n?Promise.resolve(n):i(e,t)}}})(ys,me,Gt),ks=((e,t,n,s,i,a,r)=>class extends e{constructor(e,t){const o=i(e),l=__spreadValues(__spreadValues({},mt),t),c=n(o,l);super(e,!0,c,a(o)?s():null),this._isCurveNullified=!1,this._nativeWaveShaperNode=c,r(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(e){if(null===e)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(e.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=e}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(e){this._nativeWaveShaperNode.oversample=e}})(an,qe,ys,Is,jt,$t,Pn),Os=(e=>null!==e&&e.isSecureContext)(Dt),Ps=(e=>(t,n,s)=>{Object.defineProperties(e,{currentFrame:{configurable:!0,get:()=>Math.round(t*n)},currentTime:{configurable:!0,get:()=>t}});try{return s()}finally{null!==e&&(delete e.currentFrame,delete e.currentTime)}})(Dt),Ns=new WeakMap,Rs=((e,t)=>n=>{let s=e.get(n);if(void 0!==s)return s;if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new t(1,1,44100),e.set(n,s),s})(Ns,zt),Ds=Os?((e,t,n,s,i,a,r,o,l,c,u,h,d)=>{let p=0;return(m,f,g={credentials:"omit"})=>{const _=u.get(m);if(void 0!==_&&_.has(f))return Promise.resolve();const y=c.get(m);if(void 0!==y){const e=y.get(f);if(void 0!==e)return e}const v=a(m),b=void 0===v.audioWorklet?i(f).then((([e,t])=>{const[s,i]=P(e,t);return n(`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`)})).then((()=>{const e=d._AWGS.pop();if(void 0===e)throw new SyntaxError;s(v.currentTime,v.sampleRate,(()=>e(class{},void 0,((e,n)=>{if(""===e.trim())throw t();const s=C.get(v);if(void 0!==s){if(s.has(e))throw t();R(n),N(n.parameterDescriptors),s.set(e,n)}else R(n),N(n.parameterDescriptors),C.set(v,new Map([[e,n]]))}),v.sampleRate,void 0,void 0)))})):Promise.all([i(f),Promise.resolve(e(h,h))]).then((([[e,t],n])=>{const s=p+1;p=s;const[i,a]=P(e,t),c=new Blob([`${i};((AudioWorkletProcessor,registerProcessor)=>{${a}\n})(${n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}"},(n,p)=>registerProcessor(n,class extends p{${n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));"}process(i,o,p){${n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));"}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${s}',class extends AudioWorkletProcessor{process(){return !1}})`],{type:"application/javascript; charset=utf-8"}),u=URL.createObjectURL(c);return v.audioWorklet.addModule(u,g).then((()=>{if(o(v))return v;const e=r(v);return e.audioWorklet.addModule(u,g).then((()=>e))})).then((e=>{if(null===l)throw new SyntaxError;try{new l(e,`__sac${s}`)}catch(t){throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(u)))}));return void 0===y?c.set(m,new Map([[f,b]])):y.set(f,b),b.then((()=>{const e=u.get(m);void 0===e?u.set(m,new Set([f])):e.add(f)})).finally((()=>{const e=c.get(m);void 0!==e&&e.delete(f)})),b}})(Pt,lt,(e=>t=>new Promise(((n,s)=>{if(null===e)return void s(new SyntaxError);const i=e.document.head;if(null===i)s(new SyntaxError);else{const a=e.document.createElement("script"),r=new Blob([t],{type:"application/javascript"}),o=URL.createObjectURL(r),l=e.onerror,c=()=>{e.onerror=l,URL.revokeObjectURL(o)};e.onerror=(t,n,i,a,r)=>n===o||n===e.location.href&&1===i&&1===a?(c(),s(r),!1):null!==l?l(t,n,i,a,r):void 0,a.onerror=()=>{c(),s(new SyntaxError)},a.onload=()=>{c(),n()},a.src=o,a.type="module",i.appendChild(a)}})))(Dt),Ps,(e=>t=>__async(this,null,(function*(){try{const e=yield fetch(t);if(e.ok)return[yield e.text(),e.url]}catch(n){}throw e()})))((()=>new DOMException("","AbortError"))),jt,Rs,$t,sn,new WeakMap,new WeakMap,((e,t)=>()=>__async(this,null,(function*(){if(null===e)return!0;if(null===t)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new t(1,128,44100),i=URL.createObjectURL(n);let a=!1,r=!1;try{yield s.audioWorklet.addModule(i);const t=new e(s,"a",{numberOfOutputs:0}),n=s.createOscillator();t.port.onmessage=()=>a=!0,t.onprocessorerror=()=>r=!0,n.connect(t),n.start(0),yield s.startRendering(),yield new Promise((e=>setTimeout(e)))}catch(o){}finally{URL.revokeObjectURL(i)}return a&&!r})))(sn,zt),Dt):void 0,Vs=((e,t)=>n=>e(n)||t(n))(Jt,$t),Ls=((e,t,n,s,i,a,r,o,l,c,u)=>(h,d)=>{const p=r(h)?h:a(h);if(i.has(d)){const e=n();return Promise.reject(e)}try{i.add(d)}catch(m){}return t(l,(()=>l(p)))?p.decodeAudioData(d).then((n=>(De(d).catch((()=>{})),t(o,(()=>o(n)))||u(n),e.add(n),n))):new Promise(((t,n)=>{const i=()=>__async(this,null,(function*(){try{yield De(d)}catch(m){}})),a=e=>{n(e),i()};try{p.decodeAudioData(d,(n=>{"function"!=typeof n.copyFromChannel&&(c(n),$(n)),e.add(n),i().then((()=>t(n)))}),(e=>{a(null===e?s():e)}))}catch(r){a(r)}}))})(ln,Pt,(()=>new DOMException("","DataCloneError")),(()=>new DOMException("","EncodingError")),new WeakSet,jt,Vs,z,ze,dn,pn),Bs=(Fs=Ds,qs=on,Gs=fn,Us=In,js=Nn,Hs=Wn,zs=$n,Ws=Xn,$s=Kn,Ys=Ls,Qs=Jn,Xs=ns,Zs=is,Ks=cs,Js=ds,ei=ms,ti=xs,ni=Es,si=Cs,ii=ks,class extends Js{constructor(e,t){super(e,t),this._nativeContext=e,this._audioWorklet=void 0===Fs?void 0:{addModule:(e,t)=>Fs(this,e,t)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new qs(this)}createBiquadFilter(){return new js(this)}createBuffer(e,t,n){return new Gs({length:t,numberOfChannels:e,sampleRate:n})}createBufferSource(){return new Us(this)}createChannelMerger(e=6){return new Hs(this,{numberOfInputs:e})}createChannelSplitter(e=6){return new zs(this,{numberOfOutputs:e})}createConstantSource(){return new Ws(this)}createConvolver(){return new $s(this)}createDelay(e=1){return new Qs(this,{maxDelayTime:e})}createDynamicsCompressor(){return new Xs(this)}createGain(){return new Zs(this)}createIIRFilter(e,t){return new Ks(this,{feedback:t,feedforward:e})}createOscillator(){return new ei(this)}createPanner(){return new ti(this)}createPeriodicWave(e,t,n={disableNormalization:!1}){return new ni(this,__spreadProps(__spreadValues({},n),{imag:t,real:e}))}createStereoPanner(){return new si(this)}createWaveShaper(){return new ii(this)}decodeAudioData(e,t,n){return Ys(this._nativeContext,e).then((e=>("function"==typeof t&&t(e),e)),(e=>{throw"function"==typeof n&&n(e),e}))}});var Fs,qs,Gs,Us,js,Hs,zs,Ws,$s,Ys,Qs,Xs,Zs,Ks,Js,ei,ti,ni,si,ii;const ai=((e,t,n,s)=>class extends e{constructor(e,i){const a=n(e),r=t(a,i);if(s(a))throw TypeError();super(e,!0,r,null),this._nativeMediaElementAudioSourceNode=r}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}})(an,((e,t)=>e.createMediaElementSource(t.mediaElement)),jt,$t),ri=((e,t,n,s)=>class extends e{constructor(e,i){const a=n(e);if(s(a))throw new TypeError;const r=__spreadValues(__spreadValues({},He),i),o=t(a,r);super(e,!1,o,null),this._nativeMediaStreamAudioDestinationNode=o}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}})(an,((e,t)=>{const n=e.createMediaStreamDestination();return $e(n,t),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n}),jt,$t),oi=((e,t,n,s)=>class extends e{constructor(e,i){const a=n(e),r=t(a,i);if(s(a))throw new TypeError;super(e,!0,r,null),this._nativeMediaStreamAudioSourceNode=r}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}})(an,((e,{mediaStream:t})=>{const n=t.getAudioTracks();n.sort(((e,t)=>e.id<t.id?-1:e.id>t.id?1:0));const s=n.slice(0,1),i=e.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:t}),i}),jt,$t),li=((e,t)=>(n,{mediaStreamTrack:s})=>{if("function"==typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),a=n.createMediaStreamSource(i);if("audio"!==s.kind)throw e();if(t(n))throw new TypeError;return a})(qe,$t),ci=((e,t,n)=>class extends e{constructor(e,s){const i=n(e);super(e,!0,t(i,s),null)}})(an,li,jt),ui=((e,t,n,s,i,a,r,o,l)=>class extends e{constructor(e={}){if(null===l)throw new Error("Missing the native AudioContext constructor.");let t;try{t=new l(e)}catch(r){if(12===r.code&&"sampleRate is not in range"===r.message)throw n();throw r}if(null===t)throw s();if(!(e=>void 0===e||"number"==typeof e||"string"==typeof e&&("balanced"===e||"interactive"===e||"playback"===e))(e.latencyHint))throw new TypeError(`The provided value '${e.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==e.sampleRate&&t.sampleRate!==e.sampleRate)throw n();super(t,2);const{latencyHint:i}=e,{sampleRate:a}=t;if(this._baseLatency="number"==typeof t.baseLatency?t.baseLatency:"balanced"===i?512/a:"interactive"===i||void 0===i?256/a:"playback"===i?1024/a:128*Math.max(2,Math.min(128,Math.round(i*a/128)))/a,this._nativeAudioContext=t,"webkitAudioContext"===l.name?(this._nativeGainNode=t.createGain(),this._nativeOscillatorNode=t.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(t.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===t.state){this._state="suspended";const e=()=>{"suspended"===this._state&&(this._state=null),t.removeEventListener("statechange",e)};t.addEventListener("statechange",e)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw t()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),ne(this)})))}createMediaElementSource(e){return new i(this,{mediaElement:e})}createMediaStreamDestination(){return new a(this)}createMediaStreamSource(e){return new r(this,{mediaStream:e})}createMediaStreamTrackSource(e){return new o(this,{mediaStreamTrack:e})}resume(){return"suspended"===this._state?new Promise(((e,t)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?e():this.resume().then(e,t)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((e=>{if(void 0===e||15===e.code)throw t();throw e}))}suspend(){return this._nativeAudioContext.suspend().catch((e=>{if(void 0===e)throw t();throw e}))}})(Bs,qe,lt,(()=>new DOMException("","UnknownError")),ai,ri,oi,ci,Kt),hi=(di=hs,e=>{const t=di.get(e);if(void 0===t)throw new Error("The context has no set of AudioWorkletNodes.");return t});var di;const pi=(mi=hi,(e,t)=>{mi(e).add(t)});var mi;const fi=(e=>(t,n,s=0,i=0)=>{const a=t[s];if(void 0===a)throw e();return be(n)?a.connect(n,0,i):a.connect(n,0)})(W),gi=(e=>(t,n)=>{e(t).delete(n)})(hi),_i=(e=>(t,n,s,i=0)=>void 0===n?t.forEach((e=>e.disconnect())):"number"==typeof n?Le(e,t,n).disconnect():be(n)?void 0===s?t.forEach((e=>e.disconnect(n))):void 0===i?Le(e,t,s).disconnect(n,0):Le(e,t,s).disconnect(n,0,i):void 0===s?t.forEach((e=>e.disconnect(n))):Le(e,t,s).disconnect(n,0))(W),yi=new WeakMap,vi=(bi=yi,wi=D,e=>wi(bi,e));var bi,wi;const Ti=((e,t,n,s,i,a,r,o,l,c,u,h,d)=>(p,m,f,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw l();const _=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(_.some((e=>e<1)))throw l();if(_.length!==g.numberOfOutputs)throw t();if("explicit"!==g.channelCountMode)throw l();const y=g.channelCount*g.numberOfInputs,v=_.reduce(((e,t)=>e+t),0),b=void 0===f.parameterDescriptors?0:f.parameterDescriptors.length;if(y+b>6||v>6)throw l();const w=new MessageChannel,T=[],x=[];for(let e=0;e<g.numberOfInputs;e+=1)T.push(r(p,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),x.push(i(p,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const S=[];if(void 0!==f.parameterDescriptors)for(const{defaultValue:e,maxValue:t,minValue:n,name:s}of f.parameterDescriptors){const i=a(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[s]?g.parameterData[s]:void 0===e?0:e});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===e?0:e},maxValue:{get:()=>void 0===t?X:t},minValue:{get:()=>void 0===n?Q:n}}),S.push(i)}const E=s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+b)}),M=Ke(m,p.sampleRate),A=o(p,M,y+b,Math.max(1,v)),C=i(p,{channelCount:Math.max(1,v),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,v)}),k=[];for(let e=0;e<g.numberOfOutputs;e+=1)k.push(s(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:_[e]}));for(let e=0;e<g.numberOfInputs;e+=1){T[e].connect(x[e]);for(let t=0;t<g.channelCount;t+=1)x[e].connect(E,t,e*g.channelCount+t)}const O=new Se(void 0===f.parameterDescriptors?[]:f.parameterDescriptors.map((({name:e},t)=>{const n=S[t];return n.connect(E,0,y+t),n.start(0),[e,n.offset]})));E.connect(A);let P=g.channelInterpretation,N=null;const R=0===g.numberOfOutputs?[A]:k,D={get bufferSize(){return M},get channelCount(){return g.channelCount},set channelCount(e){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(e){throw n()},get channelInterpretation(){return P},set channelInterpretation(e){for(const t of T)t.channelInterpretation=e;P=e},get context(){return A.context},get inputs(){return T},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return N},set onprocessorerror(e){"function"==typeof N&&D.removeEventListener("processorerror",N),N="function"==typeof e?e:null,"function"==typeof N&&D.addEventListener("processorerror",N)},get parameters(){return O},get port(){return w.port2},addEventListener:(...e)=>A.addEventListener(e[0],e[1],e[2]),connect:e.bind(null,R),disconnect:c.bind(null,R),dispatchEvent:(...e)=>A.dispatchEvent(e[0]),removeEventListener:(...e)=>A.removeEventListener(e[0],e[1],e[2])},V=new Map;w.port1.addEventListener=(e=>(...t)=>{if("message"===t[0]){const e="function"==typeof t[1]?t[1]:"object"==typeof t[1]&&null!==t[1]&&"function"==typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==e){const n=V.get(t[1]);void 0!==n?t[1]=n:(t[1]=t=>{u(p.currentTime,p.sampleRate,(()=>e(t)))},V.set(e,t[1]))}}return e.call(w.port1,t[0],t[1],t[2])})(w.port1.addEventListener),w.port1.removeEventListener=(e=>(...t)=>{if("message"===t[0]){const e=V.get(t[1]);void 0!==e&&(V.delete(t[1]),t[1]=e)}return e.call(w.port1,t[0],t[1],t[2])})(w.port1.removeEventListener);let L=null;Object.defineProperty(w.port1,"onmessage",{get:()=>L,set:e=>{"function"==typeof L&&w.port1.removeEventListener("message",L),L="function"==typeof e?e:null,"function"==typeof L&&(w.port1.addEventListener("message",L),w.port1.start())}}),f.prototype.port=w.port1;let B=null;const F=((e,t,n,s)=>{let i=I.get(e);void 0===i&&(i=new WeakMap,I.set(e,i));const a=Je(n,s);return i.set(t,a),a})(p,D,f,g);F.then((e=>B=e));const q=Ce(g.numberOfInputs,g.channelCount),G=Ce(g.numberOfOutputs,_),U=void 0===f.parameterDescriptors?[]:f.parameterDescriptors.reduce(((e,{name:t})=>__spreadProps(__spreadValues({},e),{[t]:new Float32Array(128)})),{});let j=!0;const H=()=>{g.numberOfOutputs>0&&A.disconnect(C);for(let e=0,t=0;e<g.numberOfOutputs;e+=1){const n=k[e];for(let s=0;s<_[e];s+=1)C.disconnect(n,t+s,s);t+=_[e]}},z=new Map;A.onaudioprocess=({inputBuffer:e,outputBuffer:t})=>{if(null!==B){const s=h(D);for(let i=0;i<M;i+=128){for(let t=0;t<g.numberOfInputs;t+=1)for(let n=0;n<g.channelCount;n+=1)Me(e,q[t],n,n,i);void 0!==f.parameterDescriptors&&f.parameterDescriptors.forEach((({name:t},n)=>{Me(e,U,t,y+n,i)}));for(let e=0;e<g.numberOfInputs;e+=1)for(let t=0;t<_[e];t+=1)0===G[e][t].byteLength&&(G[e][t]=new Float32Array(128));try{const e=q.map(((e,t)=>{if(s[t].size>0)return z.set(t,M/128),e;const n=z.get(t);return void 0===n?[]:(e.every((e=>e.every((e=>0===e))))&&(1===n?z.delete(t):z.set(t,n-1)),e)})),n=u(p.currentTime+i/p.sampleRate,p.sampleRate,(()=>B.process(e,G,U)));j=n;for(let s=0,a=0;s<g.numberOfOutputs;s+=1){for(let e=0;e<_[s];e+=1)Ae(t,G[s],e,a+e,i);a+=_[s]}}catch(n){j=!1,D.dispatchEvent(new ErrorEvent("processorerror",{colno:n.colno,filename:n.filename,lineno:n.lineno,message:n.message}))}if(!j){for(let e=0;e<g.numberOfInputs;e+=1){T[e].disconnect(x[e]);for(let t=0;t<g.channelCount;t+=1)x[i].disconnect(E,t,e*g.channelCount+t)}if(void 0!==f.parameterDescriptors){const e=f.parameterDescriptors.length;for(let t=0;t<e;t+=1){const e=S[t];e.disconnect(E,0,y+t),e.stop()}}E.disconnect(A),A.onaudioprocess=null,W?H():Z();break}}}};let W=!1;const $=r(p,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),Y=()=>A.connect($).connect(p.destination),Z=()=>{A.disconnect($),$.disconnect()};return Y(),d(D,(()=>{if(j){Z(),g.numberOfOutputs>0&&A.connect(C);for(let e=0,t=0;e<g.numberOfOutputs;e+=1){const n=k[e];for(let s=0;s<_[e];s+=1)C.connect(n,t+s,s);t+=_[e]}}W=!0}),(()=>{j&&(Y(),H()),W=!1}))})(fi,W,qe,zn,tt,Qn,it,ot,lt,_i,Ps,vi,Un),xi=((e,t,n,s,i)=>(a,r,o,l,c,u)=>{if(null!==o)try{const t=new o(a,l,u),s=new Map;let r=null;if(Object.defineProperties(t,{channelCount:{get:()=>u.channelCount,set:()=>{throw e()}},channelCountMode:{get:()=>"explicit",set:()=>{throw e()}},onprocessorerror:{get:()=>r,set:e=>{"function"==typeof r&&t.removeEventListener("processorerror",r),r="function"==typeof e?e:null,"function"==typeof r&&t.addEventListener("processorerror",r)}}}),t.addEventListener=(e=>(...n)=>{if("processorerror"===n[0]){const e="function"==typeof n[1]?n[1]:"object"==typeof n[1]&&null!==n[1]&&"function"==typeof n[1].handleEvent?n[1].handleEvent:null;if(null!==e){const t=s.get(n[1]);void 0!==t?n[1]=t:(n[1]=t=>{"error"===t.type?(Object.defineProperties(t,{type:{value:"processorerror"}}),e(t)):e(new ErrorEvent(n[0],__spreadValues({},t)))},s.set(e,n[1]))}}return e.call(t,"error",n[1],n[2]),e.call(t,...n)})(t.addEventListener),t.removeEventListener=(e=>(...n)=>{if("processorerror"===n[0]){const e=s.get(n[1]);void 0!==e&&(s.delete(n[1]),n[1]=e)}return e.call(t,"error",n[1],n[2]),e.call(t,n[0],n[1],n[2])})(t.removeEventListener),0!==u.numberOfOutputs){const e=n(a,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});t.connect(e).connect(a.destination);return i(t,(()=>e.disconnect()),(()=>e.connect(a.destination)))}return t}catch(h){if(11===h.code)throw s();throw h}if(void 0===c)throw s();return(e=>{const{port1:t}=new MessageChannel;try{t.postMessage(e)}finally{t.close()}})(u),t(a,r,c,u)})(qe,Ti,it,lt,Un),Si=((e,t,n,s,i,a,r,o,l,c,u,h,d,p,m,f)=>(g,_,y)=>{const v=new WeakMap;let b=null;const w=(o,w)=>__async(this,null,(function*(){let T=u(o),x=null;const S=H(T,w),E=Array.isArray(_.outputChannelCount)?_.outputChannelCount:Array.from(_.outputChannelCount);if(null===h){const e=E.reduce(((e,t)=>e+t),0),n=i(w,{channelCount:Math.max(1,e),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,e)}),a=[];for(let t=0;t<o.numberOfOutputs;t+=1)a.push(s(w,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:E[t]}));const c=r(w,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1});c.connect=t.bind(null,a),c.disconnect=l.bind(null,a),x=[n,a,c]}else S||(T=new h(w,g));if(v.set(w,null===x?T:x[2]),null!==x){if(null===b){if(void 0===y)throw new Error("Missing the processor constructor.");if(null===d)throw new Error("Missing the native OfflineAudioContext constructor.");const e=o.channelCount*o.numberOfInputs,t=void 0===y.parameterDescriptors?0:y.parameterDescriptors.length,n=e+t,l=()=>__async(this,null,(function*(){const l=new d(n,128*Math.ceil(o.context.length/128),w.sampleRate),c=[],u=[];for(let e=0;e<_.numberOfInputs;e+=1)c.push(r(l,{channelCount:_.channelCount,channelCountMode:_.channelCountMode,channelInterpretation:_.channelInterpretation,gain:1})),u.push(i(l,{channelCount:_.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:_.channelCount}));const h=yield Promise.all(Array.from(o.parameters.values()).map((e=>__async(this,null,(function*(){const t=a(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:e.value});return yield p(l,e,t.offset),t}))))),g=s(l,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,e+t)});for(let e=0;e<_.numberOfInputs;e+=1){c[e].connect(u[e]);for(let t=0;t<_.channelCount;t+=1)u[e].connect(g,t,e*_.channelCount+t)}for(const[t,n]of h.entries())n.connect(g,0,e+t),n.start(0);return g.connect(l.destination),yield Promise.all(c.map((e=>m(o,l,e)))),f(l)}));b=Ie(o,0===n?null:yield l(),w,_,E,y,c)}const e=yield b,t=n(w,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[l,u,h]=x;null!==e&&(t.buffer=e,t.start(0)),t.connect(l);for(let n=0,s=0;n<o.numberOfOutputs;n+=1){const e=u[n];for(let t=0;t<E[n];t+=1)l.connect(e,s+t,t);s+=E[n]}return h}if(S)for(const[t,n]of o.parameters.entries())yield e(w,n,T.parameters.get(t));else for(const[e,t]of o.parameters.entries())yield p(w,t,T.parameters.get(e));return yield m(o,w,T),T}));return{render(e,t){o(t,e);const n=v.get(t);return void 0!==n?Promise.resolve(n):w(e,t)}}})(bn,fi,Tn,zn,tt,Qn,it,gi,_i,Ps,me,sn,zt,Sn,Gt,rs),Ei=(Mi=Ns,e=>Mi.get(e));var Mi;const Ai=(e=>(t,n)=>{e.set(t,n)})(yi),Ci=Os?((e,t,n,s,i,a,r,o,l,c,u,h,d,p)=>class extends t{constructor(t,p,m){var f;const g=o(t),_=l(g),y=u(__spreadValues(__spreadValues({},Ee),m));d(y);const v=C.get(g),b=null==v?void 0:v.get(p),w=_||"closed"!==g.state?g:null!==(f=r(g))&&void 0!==f?f:g,T=i(w,_?null:t.baseLatency,c,p,b,y);super(t,!0,T,_?s(p,y,b):null);const x=[];T.parameters.forEach(((e,t)=>{const s=n(this,_,e);x.push([t,s])})),this._nativeAudioWorkletNode=T,this._onprocessorerror=null,this._parameters=new Se(x),_&&e(g,this);const{activeInputs:S}=a(this);h(T,S)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(e){const t="function"==typeof e?p(this,e):null;this._nativeAudioWorkletNode.onprocessorerror=t;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===t?e:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}})(pi,an,An,Si,xi,J,Ei,jt,$t,sn,(e=>__spreadProps(__spreadValues({},e),{outputChannelCount:void 0!==e.outputChannelCount?e.outputChannelCount:1===e.numberOfInputs&&1===e.numberOfOutputs?[e.channelCount]:Array.from({length:e.numberOfOutputs},(()=>1))})),Ai,(e=>{const{port1:t,port2:n}=new MessageChannel;try{t.postMessage(e)}finally{t.close(),n.close()}}),xt):void 0,Ii=((e,t)=>(n,s,i)=>{if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(n,s,i)}catch(a){if("SyntaxError"===a.name)throw e();throw a}})(lt,zt),ki=((e,t,n,s,i,a,r,o)=>(l,c)=>n(l).render(l,c).then((()=>Promise.all(Array.from(s(c)).map((e=>n(e).render(e,c)))))).then((()=>i(c))).then((n=>("function"!=typeof n.copyFromChannel?(r(n),$(n)):t(a,(()=>a(n)))||o(n),e.add(n),n))))(ln,Pt,Ft,hi,rs,z,dn,pn),Oi=((e,t,n,s,i)=>class extends e{constructor(e,n,i){let a;if("number"==typeof e&&void 0!==n&&void 0!==i)a={length:n,numberOfChannels:e,sampleRate:i};else{if("object"!=typeof e)throw new Error("The given parameters are not valid.");a=e}const{length:r,numberOfChannels:o,sampleRate:l}=__spreadValues(__spreadValues({},ct),a),c=s(o,r,l);t(ze,(()=>ze(c)))||c.addEventListener("statechange",(()=>{let e=0;const t=n=>{"running"===this._state&&(e>0?(c.removeEventListener("statechange",t),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):e+=1)};return t})()),super(c,o),this._length=r,this._nativeOfflineAudioContext=c,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,ne(this)})))}_waitForThePromiseToSettle(e){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(e):setTimeout((()=>this._waitForThePromiseToSettle(e)))}})(Bs,Pt,qe,Ii,ki),Pi=((e,t)=>n=>{const s=e.get(n);return t(s)||t(n)})(E,Jt),Ni=(Ri=T,Di=tn,e=>Ri.has(e)||Di(e));var Ri,Di;const Vi=(Li=S,Bi=nn,e=>Li.has(e)||Bi(e));var Li,Bi;const Fi=((e,t)=>n=>{const s=e.get(n);return t(s)||t(n)})(E,$t);function qi(e,t){if(!e)throw new Error(t)}function Gi(e,t,n=1/0){if(!(t<=e&&e<=n))throw new RangeError(`Value must be within [${t}, ${n}], got: ${e}`)}function Ui(e){e.isOffline||"running"===e.state||Hi('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let ji=console;function Hi(...e){ji.warn(...e)}function zi(e){return void 0===e}function Wi(e){return!zi(e)}function $i(e){return"number"==typeof e}function Yi(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object}function Qi(e){return Array.isArray(e)}function Xi(e){return"string"==typeof e}function Zi(e){return Xi(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)}const Ki="object"==typeof self?self:null,Ji=Ki&&(Ki.hasOwnProperty("AudioContext")||Ki.hasOwnProperty("webkitAudioContext"));function ea(e,t,n,s){var i,a=arguments.length,r=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,n,s);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(r=(a<3?i(r):a>3?i(t,n,r):i(t,n))||r);return a>3&&r&&Object.defineProperty(t,n,r),r}function ta(e,t,n,s){return new(n||(n=Promise))((function(i,a){function r(e){try{l(s.next(e))}catch(t){a(t)}}function o(e){try{l(s.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}l((s=s.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class na{constructor(e,t,n){this._callback=e,this._type=t,this._updateInterval=n,this._createClock()}_createWorker(){const e=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(e){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(e){this._updateInterval=Math.max(e,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*e,1))}get type(){return this._type}set type(e){this._disposeClock(),this._type=e,this._createClock()}dispose(){this._disposeClock()}}function sa(e){return Vi(e)}function ia(e){return Ni(e)}function aa(e){return Fi(e)}function ra(e){return Pi(e)}function oa(e){return e instanceof AudioBuffer}function la(e,t){return"value"===e||sa(t)||ia(t)||oa(t)}function ca(e,...t){if(!t.length)return e;const n=t.shift();if(Yi(e)&&Yi(n))for(const s in n)la(s,n[s])?e[s]=n[s]:Yi(n[s])?(e[s]||Object.assign(e,{[s]:{}}),ca(e[s],n[s])):Object.assign(e,{[s]:n[s]});return ca(e,...t)}function ua(e,t,n=[],s){const i={},a=Array.from(t);if(Yi(a[0])&&s&&!Reflect.has(a[0],s)){Object.keys(a[0]).some((t=>Reflect.has(e,t)))||(ca(i,{[s]:a[0]}),n.splice(n.indexOf(s),1),a.shift())}if(1===a.length&&Yi(a[0]))ca(i,a[0]);else for(let r=0;r<n.length;r++)Wi(a[r])&&(i[n[r]]=a[r]);return ca(e,i)}function ha(e,t){return zi(e)?t:e}
/**
   * Tone.js
   * @author Yotam Mann
   * @license http://opensource.org/licenses/MIT MIT License
   * @copyright 2014-2019 Yotam Mann
   */class da{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...e){(this.debug||Ki&&this.toString()===Ki.TONE_DEBUG_CLASS)&&function(...e){ji.log(...e)}(this,...e)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}da.version="dev";const pa=1e-6;function ma(e,t){return e>t+pa}function fa(e,t){return ma(e,t)||_a(e,t)}function ga(e,t){return e+pa<t}function _a(e,t){return Math.abs(e-t)<pa}class ya extends da{constructor(){super(),this.name="Timeline",this._timeline=[];const e=ua(ya.getDefaults(),arguments,["memory"]);this.memory=e.memory,this.increasing=e.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(e){if(qi(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){const t=this._timeline[this.length-1];qi(fa(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{const t=this._search(e.time);this._timeline.splice(t+1,0,e)}if(this.length>this.memory){const e=this.length-this.memory;this._timeline.splice(0,e)}return this}remove(e){const t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this}get(e,t="time"){const n=this._search(e,t);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(e,t="time"){const n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(e){const t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];const n=this._search(e);return n-1>=0?this._timeline[n-1]:null}cancel(e){if(this._timeline.length>1){let t=this._search(e);if(t>=0)if(_a(this._timeline[t].time,e)){for(let n=t;n>=0&&_a(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&fa(this._timeline[0].time,e)&&(this._timeline=[]);return this}cancelBefore(e){const t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}previousEvent(e){const t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}_search(e,t="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][t]<=e)return s-1;for(;n<i;){let s=Math.floor(n+(i-n)/2);const a=this._timeline[s],r=this._timeline[s+1];if(_a(a[t],e)){for(let n=s;n<this._timeline.length;n++){if(!_a(this._timeline[n][t],e))break;s=n}return s}if(ga(a[t],e)&&ma(r[t],e))return s;ma(a[t],e)?i=s:n=s+1}return-1}_iterate(e,t=0,n=this._timeline.length-1){this._timeline.slice(t,n+1).forEach(e)}forEach(e){return this._iterate(e),this}forEachBefore(e,t){const n=this._search(e);return-1!==n&&this._iterate(t,0,n),this}forEachAfter(e,t){const n=this._search(e);return this._iterate(t,n+1),this}forEachBetween(e,t,n){let s=this._search(e),i=this._search(t);return-1!==s&&-1!==i?(this._timeline[s].time!==e&&(s+=1),this._timeline[i].time===t&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(e,t){let n=this._search(e);for(;n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}forEachAtTime(e,t){const n=this._search(e);if(-1!==n&&_a(this._timeline[n].time,e)){let s=n;for(let t=n;t>=0&&_a(this._timeline[t].time,e);t--)s=t;this._iterate((e=>{t(e)}),s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const va=[];function ba(e){va.push(e)}const wa=[];function Ta(e){wa.push(e)}class xa extends da{constructor(){super(...arguments),this.name="Emitter"}on(e,t){return e.split(/\W+/).forEach((e=>{zi(this._events)&&(this._events={}),this._events.hasOwnProperty(e)||(this._events[e]=[]),this._events[e].push(t)})),this}once(e,t){const n=(...s)=>{t(...s),this.off(e,n)};return this.on(e,n),this}off(e,t){return e.split(/\W+/).forEach((n=>{if(zi(this._events)&&(this._events={}),this._events.hasOwnProperty(e))if(zi(t))this._events[e]=[];else{const n=this._events[e];for(let e=n.length-1;e>=0;e--)n[e]===t&&n.splice(e,1)}})),this}emit(e,...t){if(this._events&&this._events.hasOwnProperty(e)){const n=this._events[e].slice(0);for(let e=0,s=n.length;e<s;e++)n[e].apply(this,t)}return this}static mixin(e){["on","once","off","emit"].forEach((t=>{const n=Object.getOwnPropertyDescriptor(xa.prototype,t);Object.defineProperty(e.prototype,t,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class Sa extends xa{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class Ea extends Sa{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new ya,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const e=ua(Ea.getDefaults(),arguments,["context"]);e.context?this._context=e.context:this._context=function(e){return new ui(e)}({latencyHint:e.latencyHint}),this._ticker=new na(this.emit.bind(this,"tick"),e.clockSource,e.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(e.latencyHint),this.lookAhead=e.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){var e;return this._initialized||(e=this,va.forEach((t=>t(e))),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(e,t,n){return this._context.createBuffer(e,t,n)}createChannelMerger(e){return this._context.createChannelMerger(e)}createChannelSplitter(e){return this._context.createChannelSplitter(e)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(e){return this._context.createDelay(e)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(e,t){return this._context.createIIRFilter(e,t)}createPanner(){return this._context.createPanner()}createPeriodicWave(e,t,n){return this._context.createPeriodicWave(e,t,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(e){qi(ra(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamSource(e)}createMediaElementSource(e){qi(ra(this._context),"Not available if OfflineAudioContext");return this._context.createMediaElementSource(e)}createMediaStreamDestination(){qi(ra(this._context),"Not available if OfflineAudioContext");return this._context.createMediaStreamDestination()}decodeAudioData(e){return this._context.decodeAudioData(e)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(e){qi(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}get transport(){return this.initialize(),this._transport}set transport(e){qi(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}get draw(){return this.initialize(),this._draw}set draw(e){qi(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}get destination(){return this.initialize(),this._destination}set destination(e){qi(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}createAudioWorkletNode(e,t){return function(e,t,n){return qi(Wi(Ci),"This node only works in a secure context (https or localhost)"),new Ci(e,t,n)}(this.rawContext,e,t)}addAudioWorkletModule(e,t){return ta(this,void 0,void 0,(function*(){qi(Wi(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),yield this._workletModules.get(t)}))}workletsAreReady(){return ta(this,void 0,void 0,(function*(){const e=[];this._workletModules.forEach((t=>e.push(t))),yield Promise.all(e)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(e){this._ticker.updateInterval=e}get clockSource(){return this._ticker.type}set clockSource(e){this._ticker.type=e}get latencyHint(){return this._latencyHint}_setLatencyHint(e){let t=0;if(this._latencyHint=e,Xi(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25}this.lookAhead=t,this.updateInterval=t/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return ra(this._context)?this._context.resume():Promise.resolve()}close(){return ta(this,void 0,void 0,(function*(){var e;ra(this._context)&&(yield this._context.close()),this._initialized&&(e=this,wa.forEach((t=>t(e))))}))}getConstant(e){if(this._constants.has(e))return this._constants.get(e);{const t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=e;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=t,s.loop=!0,s.start(0),this._constants.set(e,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((e=>this._constants[e].disconnect())),this}_timeoutLoop(){const e=this.now();let t=this._timeouts.peek();for(;this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}setTimeout(e,t){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}clearTimeout(e){return this._timeouts.forEach((t=>{t.id===e&&this._timeouts.remove(t)})),this}clearInterval(e){return this.clearTimeout(e)}setInterval(e,t){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{e(),s()},id:n,time:i+t})};return s(),n}}function Ma(e,t){Qi(t)?t.forEach((t=>Ma(e,t))):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function Aa(e,t){Qi(t)?t.forEach((t=>Aa(e,t))):Object.defineProperty(e,t,{writable:!0})}const Ca=()=>{};class Ia extends da{constructor(){super(),this.name="ToneAudioBuffer",this.onload=Ca;const e=ua(Ia.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=e.reverse,this.onload=e.onload,e.url&&oa(e.url)||e.url instanceof Ia?this.set(e.url):Xi(e.url)&&this.load(e.url).catch(e.onerror)}static getDefaults(){return{onerror:Ca,onload:Ca,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:Na().sampleRate}set(e){return e instanceof Ia?e.loaded?this._buffer=e.get():e.onload=()=>{this.set(e),this.onload(this)}:this._buffer=e,this._reversed&&this._reverse(),this}get(){return this._buffer}load(e){return ta(this,void 0,void 0,(function*(){const t=Ia.load(e).then((e=>{this.set(e),this.onload(this)}));Ia.downloads.push(t);try{yield t}finally{const e=Ia.downloads.indexOf(t);Ia.downloads.splice(e,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(e){const t=Qi(e)&&e[0].length>0,n=t?e.length:1,s=t?e[0].length:e.length,i=Na(),a=i.createBuffer(n,s,i.sampleRate),r=t||1!==n?e:[e];for(let o=0;o<n;o++)a.copyToChannel(r[o],o);return this._buffer=a,this}toMono(e){if($i(e))this.fromArray(this.toArray(e));else{let e=new Float32Array(this.length);const t=this.numberOfChannels;for(let n=0;n<t;n++){const t=this.toArray(n);for(let n=0;n<t.length;n++)e[n]+=t[n]}e=e.map((e=>e/t)),this.fromArray(e)}return this}toArray(e){if($i(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);{const e=[];for(let t=0;t<this.numberOfChannels;t++)e[t]=this.getChannelData(t);return e}}getChannelData(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}slice(e,t=this.duration){const n=Math.floor(e*this.sampleRate),s=Math.floor(t*this.sampleRate);qi(n<s,"The start time must be less than the end time");const i=s-n,a=Na().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let r=0;r<this.numberOfChannels;r++)a.copyToChannel(this.getChannelData(r).subarray(n,s),r);return new Ia(a)}_reverse(){if(this.loaded)for(let e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(e){this._reversed!==e&&(this._reversed=e,this._reverse())}static fromArray(e){return(new Ia).fromArray(e)}static fromUrl(e){return ta(this,void 0,void 0,(function*(){const t=new Ia;return yield t.load(e)}))}static load(e){return ta(this,void 0,void 0,(function*(){const t=e.match(/\[([^\]\[]+\|.+)\]$/);if(t){const n=t[1].split("|");let s=n[0];for(const e of n)if(Ia.supportsType(e)){s=e;break}e=e.replace(t[0],s)}const n=""===Ia.baseUrl||Ia.baseUrl.endsWith("/")?Ia.baseUrl:Ia.baseUrl+"/",s=yield fetch(n+e);if(!s.ok)throw new Error(`could not load url: ${e}`);const i=yield s.arrayBuffer();return yield Na().decodeAudioData(i)}))}static supportsType(e){const t=e.split("."),n=t[t.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}static loaded(){return ta(this,void 0,void 0,(function*(){for(yield Promise.resolve();Ia.downloads.length;)yield Ia.downloads[0]}))}}Ia.baseUrl="",Ia.downloads=[];class ka extends Ea{constructor(){var e,t,n;super({clockSource:"offline",context:aa(arguments[0])?arguments[0]:(e=arguments[0],t=arguments[1]*arguments[2],n=arguments[2],new Oi(e,t,n)),lookAhead:0,updateInterval:aa(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=aa(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(e){return ta(this,void 0,void 0,(function*(){let t=0;for(;this._duration-this._currentTime>=0;){this.emit("tick"),this._currentTime+=128/this.sampleRate,t++;const n=Math.floor(this.sampleRate/128);e&&t%n==0&&(yield new Promise((e=>setTimeout(e,1))))}}))}render(e=!0){return ta(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(e);const t=yield this._context.startRendering();return new Ia(t)}))}close(){return Promise.resolve()}}const Oa=new class extends Sa{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(e,t,n){return{}}createChannelMerger(e){return{}}createChannelSplitter(e){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(e){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(e,t){return{}}createPanner(){return{}}createPeriodicWave(e,t,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(e){return{}}createMediaElementSource(e){return{}}createMediaStreamDestination(){return{}}decodeAudioData(e){return Promise.resolve({})}createAudioWorkletNode(e,t){return{}}get rawContext(){return{}}addAudioWorkletModule(e,t){return ta(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(e,t){return 0}clearTimeout(e){return this}setInterval(e,t){return 0}clearInterval(e){return this}getConstant(e){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(e){}get destination(){return{}}set destination(e){}now(){return 0}immediate(){return 0}};let Pa=Oa;function Na(){var e;return Pa===Oa&&Ji&&(e=new Ea,Pa=ra(e)?new Ea(e):aa(e)?new ka(e):e),Pa}if(Ki&&!Ki.TONE_SILENCE_LOGGING){let e="v";e="";const t=` * Tone.js ${e}dev * `;console.log(`%c${t}`,"background: #000; color: #fff")}function Ra(e){return Math.pow(2,e/12)}let Da=440;function Va(e){return Math.round(La(e))}function La(e){return 69+12*Math.log2(e/Da)}function Ba(e){return Da*Math.pow(2,(e-69)/12)}class Fa extends da{constructor(e,t,n){super(),this.defaultUnits="s",this._val=t,this._units=n,this.context=e,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:e=>this._frequencyToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:e=>this._ticksToUnits(parseInt(e,10)),regexp:/^(\d+)i$/i},m:{method:e=>this._beatsToUnits(parseInt(e,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(e,t)=>{const n=parseInt(e,10),s="."===t?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:e=>this._expressions[this.defaultUnits].method.call(this,e),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:e=>this._secondsToUnits(parseFloat(e)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:e=>parseInt(e,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:e=>{const t=parseInt(e,10);return this._beatsToUnits(8/(3*Math.floor(t)))},regexp:/^(\d+)t$/i},tr:{method:(e,t,n)=>{let s=0;return e&&"0"!==e&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(s+=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof Fa&&this.fromType(this._val),zi(this._val))return this._noArg();if(Xi(this._val)&&zi(this._units)){for(const e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Yi(this._val)){let e=0;for(const t in this._val)if(Wi(this._val[t])){const n=this._val[t];e+=new this.constructor(this.context,t).valueOf()*n}return e}if(Wi(this._units)){const e=this._expressions[this._units],t=this._val.toString().trim().match(e.regexp);return t?e.method.apply(this,t.slice(1)):e.method.call(this,this._val)}return Xi(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(e){return 1/e}_beatsToUnits(e){return 60/this._getBpm()*e}_secondsToUnits(e){return e}_ticksToUnits(e){return e*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class qa extends Fa{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:e=>this._now()+new this.constructor(this.context,e).valueOf(),regexp:/^\+(.+)/},quantize:{method:e=>{const t=new qa(this.context,e).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(t))},regexp:/^@(.+)/}})}quantize(e,t=1){const n=new this.constructor(this.context,e).valueOf(),s=this.valueOf();return s+(Math.round(s/n)*n-s)*t}toNotation(){const e=this.toSeconds(),t=["1m"];for(let i=1;i<9;i++){const e=Math.pow(2,i);t.push(e+"n."),t.push(e+"n"),t.push(e+"t")}t.push("0");let n=t[0],s=new qa(this.context,t[0]).toSeconds();return t.forEach((t=>{const i=new qa(this.context,t).toSeconds();Math.abs(i-e)<Math.abs(s-e)&&(n=t,s=i)})),n}toBarsBeatsSixteenths(){const e=this._beatsToUnits(1);let t=this.valueOf()/e;t=parseFloat(t.toFixed(4));const n=Math.floor(t/this._getTimeSignature());let s=t%1*4;t=Math.floor(t)%this._getTimeSignature();const i=s.toString();i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3)));return[n,t,s].join(":")}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return Va(this.toFrequency())}_now(){return this.context.now()}}class Ga extends qa{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return Da}static set A4(e){!function(e){Da=e}(e)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(e){return"midi"===this.defaultUnits?e:Ga.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(e,t){const n=Ua[e.toLowerCase()]+12*(parseInt(t,10)+1);return"midi"===this.defaultUnits?n:Ga.mtof(n)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(e,t,n){let s=1;return e&&"0"!==e&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(s*=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(e){return new Ga(this.context,this.valueOf()*Ra(e))}harmonize(e){return e.map((e=>this.transpose(e)))}toMidi(){return Va(this.valueOf())}toNote(){const e=this.toFrequency(),t=Math.log2(e/Ga.A4);let n=Math.round(12*t)+57;const s=Math.floor(n/12);s<0&&(n+=-12*s);return ja[n%12]+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(e){return e}_ticksToUnits(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}_beatsToUnits(e){return 1/super._beatsToUnits(e)}_secondsToUnits(e){return 1/e}static mtof(e){return Ba(e)}static ftom(e){return Va(e)}}const Ua={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},ja=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];class Ha extends qa{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}class za extends da{constructor(){super();const e=ua(za.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=e.context}static getDefaults(){return{context:Na()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(e){return new qa(this.context,e).toSeconds()}toFrequency(e){return new Ga(this.context,e).toFrequency()}toTicks(e){return new Ha(this.context,e).toTicks()}_getPartialProperties(e){const t=this.get();return Object.keys(t).forEach((n=>{zi(e[n])&&delete t[n]})),t}get(){const e=this.constructor.getDefaults();return Object.keys(e).forEach((t=>{if(Reflect.has(this,t)){const n=this[t];Wi(n)&&Wi(n.value)&&Wi(n.setValueAtTime)?e[t]=n.value:n instanceof za?e[t]=n._getPartialProperties(e[t]):Qi(n)||$i(n)||Xi(n)||"boolean"==typeof n?e[t]=n:delete e[t]}})),e}set(e){return Object.keys(e).forEach((t=>{Reflect.has(this,t)&&Wi(this[t])&&(this[t]&&Wi(this[t].value)&&Wi(this[t].setValueAtTime)?this[t].value!==e[t]&&(this[t].value=e[t]):this[t]instanceof za?this[t].set(e[t]):this[t]=e[t])})),this}}class Wa extends ya{constructor(e="stopped"){super(),this.name="StateTimeline",this._initial=e,this.setStateAtTime(this._initial,0)}getValueAtTime(e){const t=this.get(e);return null!==t?t.state:this._initial}setStateAtTime(e,t,n){return Gi(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}getLastState(e,t){for(let n=this._search(t);n>=0;n--){const t=this._timeline[n];if(t.state===e)return t}}getNextState(e,t){const n=this._search(t);if(-1!==n)for(let s=n;s<this._timeline.length;s++){const t=this._timeline[s];if(t.state===e)return t}}}let $a=class e extends za{constructor(){super(ua(e.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=ua(e.getDefaults(),arguments,["param","units","convert"]);for(qi(Wi(t.param)&&(sa(t.param)||t.param instanceof e),"param must be an AudioParam");!sa(t.param);)t.param=t.param._param;this._swappable=!!Wi(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new ya(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,Wi(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(za.getDefaults(),{convert:!0,units:"number"})}get value(){const e=this.now();return this.getValueAtTime(e)}set value(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}get minValue(){return Wi(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return Wi(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(e,t){return this.units===t}_assertRange(e){return Wi(this.maxValue)&&Wi(this.minValue)&&Gi(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}_fromType(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?(t=e,Math.pow(10,t/20)):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e;var t}_toType(e){return this.convert&&"decibels"===this.units?(t=e,Math.log(t)/Math.LN10*20):e;var t}setValueAtTime(e,t){const n=this.toSeconds(t),s=this._fromType(e);return qi(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(e){const t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),s=this._events.get(t);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let e=s.value;if("setTargetAtTime"===s.type){const t=this._events.getBefore(s.time);e=null===t?this._initialValue:t.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,e,n.time,n.value,t):this._exponentialInterpolate(s.time,e,n.time,n.value,t)}else i=s.value;else{const e=this._events.getBefore(s.time);let n;n=null===e?this._initialValue:e.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,t))}return this._toType(i)}setRampPoint(e){e=this.toSeconds(e);let t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}linearRampToValueAtTime(e,t){const n=this._fromType(e),s=this.toSeconds(t);return qi(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(e,t){let n=this._fromType(e);n=_a(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(t);return qi(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}linearRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}targetRampTo(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}exponentialApproachValueAtTime(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,s),this.cancelAndHoldAtTime(t+.9*n),this.linearRampToValueAtTime(e,t+n),this}setTargetAtTime(e,t,n){const s=this._fromType(e);qi(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(t);return this._assertRange(s),qi(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(e)}, ${JSON.stringify(t)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",e,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(e,t,n,s=1){n=this.toSeconds(n),t=this.toSeconds(t);const i=this._fromType(e[0])*s;this.setValueAtTime(this._toType(i),t);const a=n/(e.length-1);for(let r=1;r<e.length;r++){const n=this._fromType(e[r])*s;this.linearRampToValueAtTime(this._toType(n),t+r*a)}return this}cancelScheduledValues(e){const t=this.toSeconds(e);return qi(isFinite(t),`Invalid argument to cancelScheduledValues: ${JSON.stringify(e)}`),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}cancelAndHoldAtTime(e){const t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));qi(isFinite(t),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(e)}`),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);const s=this._events.get(t),i=this._events.getAfter(t);return s&&_a(s.time,t)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),t):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}rampTo(e,t=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}apply(e){const t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);const n=this._events.get(t);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:t+2,a=(i-t)/10;for(let n=t;n<i;n+=a)e.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(t=>{"cancelScheduledValues"===t.type?e.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?e.setTargetAtTime(t.value,t.time,t.constant):e[t.type](t.value,t.time)})),this}setParam(e){qi(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(e,t,n,s,i){return n+(t-n)*Math.exp(-(i-e)/s)}_linearInterpolate(e,t,n,s,i){return t+(i-e)/(n-e)*(s-t)}_exponentialInterpolate(e,t,n,s,i){return t*Math.pow(s/t,(i-e)/(n-e))}};class Ya extends za{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return Wi(this.input)?sa(this.input)||this.input instanceof $a?1:this.input.numberOfInputs:0}get numberOfOutputs(){return Wi(this.output)?this.output.numberOfOutputs:0}_isAudioNode(e){return Wi(e)&&(e instanceof Ya||ia(e))}_getInternalNodes(){const e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}_setChannelProperties(e){this._getInternalNodes().forEach((t=>{t.channelCount=e.channelCount,t.channelCountMode=e.channelCountMode,t.channelInterpretation=e.channelInterpretation}))}_getChannelProperties(){const e=this._getInternalNodes();qi(e.length>0,"ToneAudioNode does not have any internal nodes");const t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(e){const t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}connect(e,t=0,n=0){return Xa(this,e,t,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return Hi("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(e,t=0,n=0){return Za(this,e,t,n),this}chain(...e){return Qa(this,...e),this}fan(...e){return e.forEach((e=>this.connect(e))),this}dispose(){return super.dispose(),Wi(this.input)&&(this.input instanceof Ya?this.input.dispose():ia(this.input)&&this.input.disconnect()),Wi(this.output)&&(this.output instanceof Ya?this.output.dispose():ia(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function Qa(...e){const t=e.shift();e.reduce(((e,t)=>(e instanceof Ya?e.connect(t):ia(e)&&Xa(e,t),t)),t)}function Xa(e,t,n=0,s=0){for(qi(Wi(e),"Cannot connect from undefined node"),qi(Wi(t),"Cannot connect to undefined node"),(t instanceof Ya||ia(t))&&qi(t.numberOfInputs>0,"Cannot connect to node with no inputs"),qi(e.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof Ya||t instanceof $a;)Wi(t.input)&&(t=t.input);for(;e instanceof Ya;)Wi(e.output)&&(e=e.output);sa(t)?e.connect(t,n):e.connect(t,n,s)}function Za(e,t,n=0,s=0){if(Wi(t))for(;t instanceof Ya;)t=t.input;for(;!ia(e);)Wi(e.output)&&(e=e.output);sa(t)?e.disconnect(t,n):ia(t)?e.disconnect(t,n,s):e.disconnect()}class Ka extends Ya{constructor(){super(ua(Ka.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const e=ua(Ka.getDefaults(),arguments,["gain","units"]);this.gain=new $a({context:this.context,convert:e.convert,param:this._gainNode.gain,units:e.units,value:e.gain,minValue:e.minValue,maxValue:e.maxValue}),Ma(this,"gain")}static getDefaults(){return Object.assign(Ya.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class Ja extends Ya{constructor(e){super(e),this.onended=Ca,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new Ka({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(e){const t=this.toSeconds(e);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},this._fadeIn=e.fadeIn,this._fadeOut=e.fadeOut,this._curve=e.curve,this.onended=e.onended}static getDefaults(){return Object.assign(Ya.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:Ca})}_startGain(e,t=1){qi(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}stop(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}_stopGain(e){qi(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const t=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+t,this._stopTime=Math.max(this._stopTime,this.context.currentTime),t>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,t,e):this._gainNode.gain.targetRampTo(0,t,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const e="exponential"===this._curve?2*t:0;this._stopSource(this.now()+e),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==Ca&&(this.onended(this),this.onended=Ca,!this.context.isOffline)){const e=()=>this.dispose();void 0!==window.requestIdleCallback?window.requestIdleCallback(e):setTimeout(e,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),qi(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class er extends Ja{constructor(){super(ua(er.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const e=ua(er.getDefaults(),arguments,["offset"]);Xa(this._source,this._gainNode),this.offset=new $a({context:this.context,convert:e.convert,param:this._source.offset,units:e.units,value:e.offset,minValue:e.minValue,maxValue:e.maxValue})}static getDefaults(){return Object.assign(Ja.getDefaults(),{convert:!0,offset:1,units:"number"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}_stopSource(e){this._source.stop(e)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class tr extends Ya{constructor(){super(ua(tr.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const e=ua(tr.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new er({context:this.context,convert:e.convert,offset:e.value,units:e.units,minValue:e.minValue,maxValue:e.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(Ya.getDefaults(),{convert:!0,units:"number",value:0})}connect(e,t=0,n=0){return nr(this,e,t,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(e,t){return this._param.setValueAtTime(e,t),this}getValueAtTime(e){return this._param.getValueAtTime(e)}setRampPoint(e){return this._param.setRampPoint(e),this}linearRampToValueAtTime(e,t){return this._param.linearRampToValueAtTime(e,t),this}exponentialRampToValueAtTime(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}exponentialRampTo(e,t,n){return this._param.exponentialRampTo(e,t,n),this}linearRampTo(e,t,n){return this._param.linearRampTo(e,t,n),this}targetRampTo(e,t,n){return this._param.targetRampTo(e,t,n),this}exponentialApproachValueAtTime(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}setTargetAtTime(e,t,n){return this._param.setTargetAtTime(e,t,n),this}setValueCurveAtTime(e,t,n,s){return this._param.setValueCurveAtTime(e,t,n,s),this}cancelScheduledValues(e){return this._param.cancelScheduledValues(e),this}cancelAndHoldAtTime(e){return this._param.cancelAndHoldAtTime(e),this}rampTo(e,t,n){return this._param.rampTo(e,t,n),this}get value(){return this._param.value}set value(e){this._param.value=e}get convert(){return this._param.convert}set convert(e){this._param.convert=e}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(e){this._param.overridden=e}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(e){return this._param.apply(e),this}}function nr(e,t,n,s){(t instanceof $a||sa(t)||t instanceof tr&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof tr&&(t.overridden=!0)),Xa(e,t,n,s)}class sr extends $a{constructor(){super(ua(sr.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new ya(1/0),this._multiplier=1;const e=ua(sr.getDefaults(),arguments,["value"]);this._multiplier=e.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(e.value)}),this.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign($a.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);const s=this._fromType(e),i=this._events.get(t),a=Math.round(Math.max(1/n,1));for(let r=0;r<=a;r++){const e=n*r+t,a=this._exponentialApproach(i.time,i.value,s,n,e);this.linearRampToValueAtTime(this._toType(a),e)}return this}setValueAtTime(e,t){const n=this.toSeconds(t);super.setValueAtTime(e,t);const s=this._events.get(n),i=this._events.previousEvent(s),a=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(a,0),this}linearRampToValueAtTime(e,t){const n=this.toSeconds(t);super.linearRampToValueAtTime(e,t);const s=this._events.get(n),i=this._events.previousEvent(s),a=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(a,0),this}exponentialRampToValueAtTime(e,t){t=this.toSeconds(t);const n=this._fromType(e),s=this._events.get(t),i=Math.round(Math.max(10*(t-s.time),1)),a=(t-s.time)/i;for(let r=0;r<=i;r++){const e=a*r+s.time,i=this._exponentialInterpolate(s.time,s.value,t,n,e);this.linearRampToValueAtTime(this._toType(i),e)}return this}_getTicksUntilEvent(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(zi(e.ticks)){const t=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(t,e.time)}const n=this._fromType(this.getValueAtTime(e.time));let s=this._fromType(this.getValueAtTime(t));const i=this._events.get(t);return i&&i.time===t&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(n+s)+e.ticks}getTicksAtTime(e){const t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}getDurationOfTicks(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(t);return this.getTimeOfTick(s+e)-n}getTimeOfTick(e){const t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&"linearRampToValueAtTime"===n.type&&t.value!==n.value){const s=this._fromType(this.getValueAtTime(t.time)),i=(this._fromType(this.getValueAtTime(n.time))-s)/(n.time-t.time),a=Math.sqrt(Math.pow(s,2)-2*i*(t.ticks-e)),r=(-s+a)/i,o=(-s-a)/i;return(r>0?r:o)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}ticksToTime(e,t){return this.getDurationOfTicks(e,t)}timeToTicks(e,t){const n=this.toSeconds(t),s=this.toSeconds(e),i=this.getTicksAtTime(n);return this.getTicksAtTime(n+s)-i}_fromType(e){return"bpm"===this.units&&this.multiplier?1/(60/e/this.multiplier):super._fromType(e)}_toType(e){return"bpm"===this.units&&this.multiplier?e/this.multiplier*60:super._toType(e)}get multiplier(){return this._multiplier}set multiplier(e){const t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}class ir extends tr{constructor(){super(ua(ir.getDefaults(),arguments,["value"])),this.name="TickSignal";const e=ua(ir.getDefaults(),arguments,["value"]);this.input=this._param=new sr({context:this.context,convert:e.convert,multiplier:e.multiplier,param:this._constantSource.offset,units:e.units,value:e.value})}static getDefaults(){return Object.assign(tr.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(e,t){return this._param.ticksToTime(e,t)}timeToTicks(e,t){return this._param.timeToTicks(e,t)}getTimeOfTick(e){return this._param.getTimeOfTick(e)}getDurationOfTicks(e,t){return this._param.getDurationOfTicks(e,t)}getTicksAtTime(e){return this._param.getTicksAtTime(e)}get multiplier(){return this._param.multiplier}set multiplier(e){this._param.multiplier=e}dispose(){return super.dispose(),this._param.dispose(),this}}class ar extends za{constructor(){super(ua(ar.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new Wa,this._tickOffset=new ya;const e=ua(ar.getDefaults(),arguments,["frequency"]);this.frequency=new ir({context:this.context,units:e.units,value:e.frequency}),Ma(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},za.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(e,t){const n=this.toSeconds(e);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),Wi(t)&&this.setTicksAtTime(t,n)),this}stop(e){const t=this.toSeconds(e);if("stopped"===this._state.getValueAtTime(t)){const e=this._state.get(t);e&&e.time>0&&(this._tickOffset.cancel(e.time),this._state.cancel(e.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&this._state.setStateAtTime("paused",t),this}cancel(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}getTicksAtTime(e){const t=this.toSeconds(e),n=this._state.getLastState("stopped",t),s={state:"paused",time:t};this._state.add(s);let i=n,a=0;return this._state.forEachBetween(n.time,t+this.sampleTime,(e=>{let t=i.time;const n=this._tickOffset.get(e.time);n&&n.time>=i.time&&(a=n.ticks,t=n.time),"started"===i.state&&"started"!==e.state&&(a+=this.frequency.getTicksAtTime(e.time)-this.frequency.getTicksAtTime(t)),i=e})),this._state.remove(s),a}get ticks(){return this.getTicksAtTime(this.now())}set ticks(e){this.setTicksAtTime(e,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(e){const t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}getSecondsAtTime(e){e=this.toSeconds(e);const t=this._state.getLastState("stopped",e),n={state:"paused",time:e};this._state.add(n);let s=t,i=0;return this._state.forEachBetween(t.time,e+this.sampleTime,(e=>{let t=s.time;const n=this._tickOffset.get(e.time);n&&n.time>=s.time&&(i=n.seconds,t=n.time),"started"===s.state&&"started"!==e.state&&(i+=e.time-t),s=e})),this._state.remove(n),i}setTicksAtTime(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}getStateAtTime(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}getTimeOfTick(e,t=this.now()){const n=this._tickOffset.get(t),s=this._state.get(t),i=Math.max(n.time,s.time),a=this.frequency.getTicksAtTime(i)+e-n.ticks;return this.frequency.getTimeOfTick(a)}forEachTickBetween(e,t,n){let s=this._state.get(e);this._state.forEachBetween(e,t,(t=>{s&&"started"===s.state&&"started"!==t.state&&this.forEachTickBetween(Math.max(s.time,e),t.time-this.sampleTime,n),s=t}));let i=null;if(s&&"started"===s.state){const r=Math.max(s.time,e),o=this.frequency.getTicksAtTime(r),l=o-this.frequency.getTicksAtTime(s.time);let c=Math.ceil(l)-l;c=_a(c,1)?0:c;let u=this.frequency.getTimeOfTick(o+c);for(;u<t;){try{n(u,Math.round(this.getTicksAtTime(u)))}catch(a){i=a;break}u+=this.frequency.getDurationOfTicks(1,u)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class rr extends za{constructor(){super(ua(rr.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=Ca,this._lastUpdate=0,this._state=new Wa("stopped"),this._boundLoop=this._loop.bind(this);const e=ua(rr.getDefaults(),arguments,["callback","frequency"]);this.callback=e.callback,this._tickSource=new ar({context:this.context,frequency:e.frequency,units:e.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,Ma(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(za.getDefaults(),{callback:Ca,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(e,t){Ui(this.context);const n=this.toSeconds(e);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}stop(e){const t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}pause(e){const t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(e){this._tickSource.ticks=e}get seconds(){return this._tickSource.seconds}set seconds(e){this._tickSource.seconds=e}getSecondsAtTime(e){return this._tickSource.getSecondsAtTime(e)}setTicksAtTime(e,t){return this._tickSource.setTicksAtTime(e,t),this}getTimeOfTick(e,t=this.now()){return this._tickSource.getTimeOfTick(e,t)}getTicksAtTime(e){return this._tickSource.getTicksAtTime(e)}nextTickTime(e,t){const n=this.toSeconds(t),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+e,n)}_loop(){const e=this._lastUpdate,t=this.now();this._lastUpdate=t,this.log("loop",e,t),e!==t&&(this._state.forEachBetween(e,t,(e=>{switch(e.state){case"started":const t=this._tickSource.getTicksAtTime(e.time);this.emit("start",e.time,t);break;case"stopped":0!==e.time&&this.emit("stop",e.time);break;case"paused":this.emit("pause",e.time)}})),this._tickSource.forEachTickBetween(e,t,((e,t)=>{this.callback(e,t)})))}getStateAtTime(e){const t=this.toSeconds(e);return this._state.getValueAtTime(t)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}xa.mixin(rr);class or extends da{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const e=ua(or.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=e.baseUrl,Object.keys(e.urls).forEach((t=>{this._loadingCount++;const n=e.urls[t];this.add(t,n,this._bufferLoaded.bind(this,e.onload),e.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:Ca,onload:Ca,urls:{}}}has(e){return this._buffers.has(e.toString())}get(e){return qi(this.has(e),`ToneAudioBuffers has no buffer named: ${e}`),this._buffers.get(e.toString())}_bufferLoaded(e){this._loadingCount--,0===this._loadingCount&&e&&e()}get loaded(){return Array.from(this._buffers).every((([e,t])=>t.loaded))}add(e,t,n=Ca,s=Ca){return Xi(t)?this._buffers.set(e.toString(),new Ia(this.baseUrl+t,n,s)):this._buffers.set(e.toString(),new Ia(t,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach((e=>e.dispose())),this._buffers.clear(),this}}class lr extends Ha{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(e){return this._getPPQ()*e}_secondsToUnits(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(e){return e}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}let cr=class extends za{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new ya,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(e){return this._events.cancel(this.toSeconds(e)),this}_drawLoop(){const e=this.context.currentTime;for(;this._events.length&&this._events.peek().time-this.anticipation<=e;){const t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}};ba((e=>{e.draw=new cr({context:e})})),Ta((e=>{e.draw.dispose()}));class ur extends Ya{constructor(){super(ua(ur.getDefaults(),arguments,["volume"])),this.name="Volume";const e=ua(ur.getDefaults(),arguments,["volume"]);this.input=this.output=new Ka({context:this.context,gain:e.volume,units:"decibels"}),this.volume=this.output.gain,Ma(this,"volume"),this._unmutedVolume=e.volume,this.mute=e.mute}static getDefaults(){return Object.assign(Ya.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}let hr=class e extends Ya{constructor(){super(ua(e.getDefaults(),arguments)),this.name="Destination",this.input=new ur({context:this.context}),this.output=new Ka({context:this.context}),this.volume=this.input.volume;const t=ua(e.getDefaults(),arguments);Qa(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(Ya.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(e){this.input.mute=e}chain(...e){return this.input.disconnect(),e.unshift(this.input),e.push(this.output),Qa(...e),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}};ba((e=>{e.destination=new hr({context:e})})),Ta((e=>{e.destination.dispose()}));class dr extends da{constructor(e){super(),this.name="TimelineValue",this._timeline=new ya({memory:10}),this._initialValue=e}set(e,t){return this._timeline.add({value:e,time:t}),this}get(e){const t=this._timeline.get(e);return t?t.value:this._initialValue}}class pr extends da{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(e){qi(Wi(e.time),"Events must have a time property"),qi(Wi(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();let t=new mr(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}remove(e){if(null!==this._root){const t=[];this._root.search(e.time,t);for(const n of t)if(n.event===e){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(e){return this.forEachFrom(e,(e=>this.remove(e))),this}_setRoot(e){this._root=e,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}_removeNode(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{let t,n=null;if(e.getBalance()>0)if(null===e.left.right)t=e.left,t.right=e.right,n=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent&&(t.parent.right=t.left,n=t.parent,t.left=e.left,t.right=e.right)}else if(null===e.right.left)t=e.right,t.left=e.left,n=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent&&(t.parent.left=t.right,n=t.parent,t.left=e.left,t.right=e.right)}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),n&&this._rebalance(n)}e.dispose()}_rotateLeft(e){const t=e.parent,n=e.isLeftChild(),s=e.right;s&&(e.right=s.left,s.left=e),null!==t?n?t.left=s:t.right=s:this._setRoot(s)}_rotateRight(e){const t=e.parent,n=e.isLeftChild(),s=e.left;s&&(e.left=s.right,s.right=e),null!==t?n?t.left=s:t.right=s:this._setRoot(s)}_rebalance(e){const t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}get(e){if(null!==this._root){const t=[];if(this._root.search(e,t),t.length>0){let e=t[0];for(let n=1;n<t.length;n++)t[n].low>e.low&&(e=t[n]);return e.event}}return null}forEach(e){if(null!==this._root){const t=[];this._root.traverse((e=>t.push(e))),t.forEach((t=>{t.event&&e(t.event)}))}return this}forEachAtTime(e,t){if(null!==this._root){const n=[];this._root.search(e,n),n.forEach((e=>{e.event&&t(e.event)}))}return this}forEachFrom(e,t){if(null!==this._root){const n=[];this._root.searchAfter(e,n),n.forEach((e=>{e.event&&t(e.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((e=>e.dispose())),this._root=null,this}}class mr{constructor(e,t,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=e,this.high=t,this.max=this.high}insert(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)}search(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))}searchAfter(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)}traverse(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class fr{constructor(e,t){this.id=fr._eventId++;const n=Object.assign(fr.getDefaults(),t);this.transport=e,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:Ca,once:!1,time:0}}invoke(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}fr._eventId=0;class gr extends fr{constructor(e,t){super(e,t),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(gr.getDefaults(),t);this.duration=new lr(e.context,n.duration).valueOf(),this._interval=new lr(e.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},fr.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(e){this._createEvents(e),super.invoke(e)}_createEvents(e){const t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new lr(this.context,this._nextTick).toSeconds()))}_restart(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new lr(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new lr(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}let _r=class e extends za{constructor(){super(ua(e.getDefaults(),arguments)),this.name="Transport",this._loop=new dr(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new ya,this._repeatedEvents=new pr,this._syncedSignals=[],this._swingAmount=0;const t=ua(e.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new rr({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),Ma(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(za.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!=0&&t%(2*this._swingTicks)!=0){const n=t%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;e+=new lr(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(t,(t=>t.invoke(e)))}schedule(e,t){const n=new fr(this,{callback:e,time:new Ha(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(e,t,n,s=1/0){const i=new gr(this,{callback:e,duration:new qa(this.context,s).toTicks(),interval:new qa(this.context,t).toTicks(),time:new Ha(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(e,t){const n=new fr(this,{callback:e,once:!0,time:new Ha(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}clear(e){if(this._scheduledEvents.hasOwnProperty(e)){const t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}_addEvent(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}cancel(e=0){const t=this.toTicks(e);return this._timeline.forEachFrom(t,(e=>this.clear(e.id))),this._repeatedEvents.forEachFrom(t,(e=>this.clear(e.id))),this}_bindClockEvents(){this._clock.on("start",((e,t)=>{t=new lr(this.context,t).toSeconds(),this.emit("start",e,t)})),this._clock.on("stop",(e=>{this.emit("stop",e)})),this._clock.on("pause",(e=>{this.emit("pause",e)}))}get state(){return this._clock.getStateAtTime(this.now())}start(e,t){let n;return Wi(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}stop(e){return this._clock.stop(e),this}pause(e){return this._clock.pause(e),this}toggle(e){return e=this.toSeconds(e),"started"!==this._clock.getStateAtTime(e)?this.start(e):this.stop(e),this}get timeSignature(){return this._timeSignature}set timeSignature(e){Qi(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}get loopStart(){return new qa(this.context,this._loopStart,"i").toSeconds()}set loopStart(e){this._loopStart=this.toTicks(e)}get loopEnd(){return new qa(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(e){this._loopEnd=this.toTicks(e)}get loop(){return this._loop.get(this.now())}set loop(e){this._loop.set(e,this.now())}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get swing(){return this._swingAmount}set swing(e){this._swingAmount=e}get swingSubdivision(){return new lr(this.context,this._swingTicks).toNotation()}set swingSubdivision(e){this._swingTicks=this.toTicks(e)}get position(){const e=this.now(),t=this._clock.getTicksAtTime(e);return new lr(this.context,t).toBarsBeatsSixteenths()}set position(e){const t=this.toTicks(e);this.ticks=t}get seconds(){return this._clock.seconds}set seconds(e){const t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}get progress(){if(this.loop){const e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(e){if(this._clock.ticks!==e){const t=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(t),s=t+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t);this.emit("stop",s),this._clock.setTicksAtTime(e,s),this.emit("start",s,this._clock.getSecondsAtTime(s))}else this._clock.setTicksAtTime(e,t)}}getTicksAtTime(e){return Math.round(this._clock.getTicksAtTime(e))}getSecondsAtTime(e){return this._clock.getSecondsAtTime(e)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(e){this._clock.frequency.multiplier=e}nextSubdivision(e){if(e=this.toTicks(e),"started"!==this.state)return 0;{const t=this.now(),n=e-this.getTicksAtTime(t)%e;return this._clock.nextTickTime(n,t)}}syncSignal(e,t){if(!t){const n=this.now();if(0!==e.getValueAtTime(n)){const s=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);t=e.getValueAtTime(n)/s}else t=0}const n=new Ka(t);return this.bpm.connect(n),n.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:n,signal:e}),e.value=0,this}unsyncSignal(e){for(let t=this._syncedSignals.length-1;t>=0;t--){const n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),Aa(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}};xa.mixin(_r),ba((e=>{e.transport=new _r({context:e})})),Ta((e=>{e.transport.dispose()}));class yr extends Ya{constructor(e){super(e),this.input=void 0,this._state=new Wa("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=Ca,this._syncedStop=Ca,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new ur({context:this.context,mute:e.mute,volume:e.volume}),this.volume=this._volume.volume,Ma(this,"volume"),this.onstop=e.onstop}static getDefaults(){return Object.assign(Ya.getDefaults(),{mute:!1,onstop:Ca,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}_clampToCurrentTime(e){return this._synced?e:Math.max(e,this.context.currentTime)}start(e,t,n){let s=zi(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const e=this._state.get(s);e&&(e.offset=this.toSeconds(ha(t,0)),e.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((e=>{this._start(e,t,n)}),s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else Ui(this.context),this._start(s,t,n);else qi(ma(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,t,n);return this}stop(e){let t=zi(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||Wi(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){const e=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(e)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}restart(e,t,n){return e=this.toSeconds(e),"started"===this._state.getValueAtTime(e)&&(this._state.cancel(e),this._restart(e,t,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(e,t)=>{if(t>0){const n=this._state.get(t);if(n&&"started"===n.state&&n.time!==t){const s=t-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(e,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=e=>{const t=this.context.transport.getSecondsAtTime(Math.max(e-this.sampleTime,0));"started"===this._state.getValueAtTime(t)&&this._stop(e)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((e=>this.context.transport.clear(e))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=Ca,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class vr extends Ja{constructor(){super(ua(vr.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const e=ua(vr.getDefaults(),arguments,["frequency","type"]);Xa(this._oscillator,this._gainNode),this.type=e.type,this.frequency=new $a({context:this.context,param:this._oscillator.frequency,units:"frequency",value:e.frequency}),this.detune=new $a({context:this.context,param:this._oscillator.detune,units:"cents",value:e.detune}),Ma(this,["frequency","detune"])}static getDefaults(){return Object.assign(Ja.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(e){const t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}_stopSource(e){this._oscillator.stop(e)}setPeriodicWave(e){return this._oscillator.setPeriodicWave(e),this}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class br extends yr{constructor(){super(ua(br.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const e=ua(br.getDefaults(),arguments,["frequency","type"]);this.frequency=new tr({context:this.context,units:"frequency",value:e.frequency}),Ma(this,"frequency"),this.detune=new tr({context:this.context,units:"cents",value:e.detune}),Ma(this,"detune"),this._partials=e.partials,this._partialCount=e.partialCount,this._type=e.type,e.partialCount&&"custom"!==e.type&&(this._type=this.baseType+e.partialCount.toString()),this.phase=e.phase}static getDefaults(){return Object.assign(yr.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(e){const t=this.toSeconds(e),n=new vr({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(t)}_stop(e){const t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}_restart(e){const t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){return br._periodicWaveCache.find((e=>{return e.phase===this._phase&&(t=e.partials,n=this._partials,t.length===n.length&&t.every(((e,t)=>n[t]===e)));var t,n}))}{const e=br._periodicWaveCache.find((e=>e.type===this._type&&e.phase===this._phase));return this._partialCount=e?e.partialCount:this._partialCount,e}}get type(){return this._type}set type(e){this._type=e;const t=-1!==["sine","square","sawtooth","triangle"].indexOf(e);if(0===this._phase&&t)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=e);else{const t=this._getCachedPeriodicWave();if(Wi(t)){const{partials:e,wave:n}=t;this._wave=n,this._partials=e,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[t,n]=this._getRealImaginary(e,this._phase),s=this.context.createPeriodicWave(t,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),br._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:t,type:this._type,wave:this._wave}),br._periodicWaveCache.length>100&&br._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(e){this.partialCount&&"custom"!==this._type&&"custom"!==e?this.type=e+this.partialCount:this.type=e}get partialCount(){return this._partialCount}set partialCount(e){Gi(e,0);let t=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),"custom"!==this._type)this.type=0===e?t:t+e.toString();else{const t=new Float32Array(e);this._partials.forEach(((e,n)=>t[n]=e)),this._partials=Array.from(t),this.type=this._type}}_getRealImaginary(e,t){let n=2048;const s=new Float32Array(n),i=new Float32Array(n);let a=1;if("custom"===e){if(a=this._partials.length+1,this._partialCount=this._partials.length,n=a,0===this._partials.length)return[s,i]}else{const t=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);t?(a=parseInt(t[2],10)+1,this._partialCount=parseInt(t[2],10),e=t[1],a=Math.max(a,2),n=a):this._partialCount=0,this._partials=[]}for(let r=1;r<n;++r){const n=2/(r*Math.PI);let o;switch(e){case"sine":o=r<=a?1:0,this._partials[r-1]=o;break;case"square":o=1&r?2*n:0,this._partials[r-1]=o;break;case"sawtooth":o=n*(1&r?1:-1),this._partials[r-1]=o;break;case"triangle":o=1&r?n*n*2*(r-1>>1&1?-1:1):0,this._partials[r-1]=o;break;case"custom":o=this._partials[r-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}0!==o?(s[r]=-o*Math.sin(t*r),i[r]=o*Math.cos(t*r)):(s[r]=0,i[r]=0)}return[s,i]}_inverseFFT(e,t,n){let s=0;const i=e.length;for(let a=0;a<i;a++)s+=e[a]*Math.cos(a*n)+t[a]*Math.sin(a*n);return s}getInitialValue(){const[e,t]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI;for(let o=0;o<32;o++)n=Math.max(this._inverseFFT(e,t,o/32*s),n);return i=-this._inverseFFT(e,t,this._phase)/n,a=-1,r=1,Math.max(Math.min(i,r),a);var i,a,r}get partials(){return this._partials.slice(0,this.partialCount)}set partials(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(e){this._phase=e*Math.PI/180,this.type=this._type}asArray(e=1024){return ta(this,void 0,void 0,(function*(){return function(e,t){return ta(this,void 0,void 0,(function*(){const n=t/e.context.sampleRate,s=new ka(1,n,e.context.sampleRate);return new e.constructor(Object.assign(e.get(),{frequency:2/n,detune:0,context:s})).toDestination().start(0),(yield s.render()).getChannelData(0)}))}(this,e)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}br._periodicWaveCache=[];class wr extends Ya{constructor(){super(Object.assign(ua(wr.getDefaults(),arguments,["context"])))}connect(e,t=0,n=0){return nr(this,e,t,n),this}}class Tr extends wr{constructor(){super(Object.assign(ua(Tr.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const e=ua(Tr.getDefaults(),arguments,["mapping","length"]);Qi(e.mapping)||e.mapping instanceof Float32Array?this.curve=Float32Array.from(e.mapping):"function"==typeof e.mapping&&this.setMap(e.mapping,e.length)}static getDefaults(){return Object.assign(tr.getDefaults(),{length:1024})}setMap(e,t=1024){const n=new Float32Array(t);for(let s=0,i=t;s<i;s++){const t=s/(i-1)*2-1;n[s]=e(t,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(e){this._shaper.curve=e}get oversample(){return this._shaper.oversample}set oversample(e){qi(["none","2x","4x"].some((t=>t.includes(e))),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class xr extends wr{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new Tr({context:this.context,mapping:e=>(e+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Sr extends tr{constructor(){super(Object.assign(ua(Sr.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new Ka({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,Qa(this._constantSource,this._sum)}static getDefaults(){return Object.assign(tr.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class Er extends tr{constructor(){super(Object.assign(ua(Er.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const e=ua(Er.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new Ka({context:this.context,minValue:e.minValue,maxValue:e.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(e.value,0)}static getDefaults(){return Object.assign(tr.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Mr extends wr{constructor(){super(Object.assign(ua(Mr.getDefaults(),arguments,["min","max"]))),this.name="Scale";const e=ua(Mr.getDefaults(),arguments,["min","max"]);this._mult=this.input=new Er({context:this.context,value:e.max-e.min}),this._add=this.output=new Sr({context:this.context,value:e.min}),this._min=e.min,this._max=e.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(wr.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(e){this._min=e,this._setRange()}get max(){return this._max}set max(e){this._max=e,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class Ar extends wr{constructor(){super(Object.assign(ua(Ar.getDefaults(),arguments))),this.name="Zero",this._gain=new Ka({context:this.context}),this.output=this._gain,this.input=void 0,Xa(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),Za(this.context.getConstant(0),this._gain),this}}let Cr=class e extends Ya{constructor(){super(ua(e.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=$a.prototype._fromType,this._toType=$a.prototype._toType,this._is=$a.prototype._is,this._clampValue=$a.prototype._clampValue;const t=ua(e.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new br(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new Ka({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new tr({context:this.context,units:"audioRange",value:0}),this._zeros=new Ar({context:this.context}),this._a2g=new xr({context:this.context}),this._scaler=this.output=new Mr({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),Ma(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(br.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}stop(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(e){e=this._fromType(e),this._scaler.min=e}get max(){return this._toType(this._scaler.max)}set max(e){e=this._fromType(e),this._scaler.max=e}get type(){return this._oscillator.type}set type(e){this._oscillator.type=e,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(e){this._oscillator.partials=e,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(e){this._oscillator.phase=e,this._setStoppedValue()}get units(){return this._units}set units(e){const t=this.min,n=this.max;this._units=e,this.min=t,this.max=n}get state(){return this._oscillator.state}connect(e,t,n){return(e instanceof $a||e instanceof tr)&&(this.convert=e.convert,this.units=e.units),nr(this,e,t,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}};class Ir extends Ja{constructor(){super(ua(Ir.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const e=ua(Ir.getDefaults(),arguments,["url","onload"]);Xa(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new $a({context:this.context,param:this._source.playbackRate,units:"positive",value:e.playbackRate}),this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this._buffer=new Ia(e.url,e.onload,e.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(Ja.getDefaults(),{url:new Ia,loop:!1,loopEnd:0,loopStart:0,onload:Ca,onerror:Ca,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(e){this._fadeIn=e}get fadeOut(){return this._fadeOut}set fadeOut(e){this._fadeOut=e}get curve(){return this._curve}set curve(e){this._curve=e}start(e,t,n,s=1){qi(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(e);this._startGain(i,s),t=this.loop?ha(t,this.loopStart):ha(t,0);let a=Math.max(this.toSeconds(t),0);if(this.loop){const e=this.toSeconds(this.loopEnd)||this.buffer.duration,t=this.toSeconds(this.loopStart),n=e-t;fa(a,e)&&(a=(a-t)%n+t),_a(a,this.buffer.duration)&&(a=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,ga(a,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,a)),Wi(n)){let e=this.toSeconds(n);e=Math.max(e,0),this.stop(i+e)}return this}_stopSource(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(e){this._source.loopStart=this.toSeconds(e)}get loopEnd(){return this._source.loopEnd}set loopEnd(e){this._source.loopEnd=this.toSeconds(e)}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._source.loop}set loop(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}function kr(e,t=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Gi(this.toSeconds(s),e,t),n.set(this,s)}})}}let Or=class e extends yr{constructor(){super(ua(e.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=ua(e.getDefaults(),arguments,["url","onload"]);this._buffer=new Ia({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(yr.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:Ca,onerror:Ca,playbackRate:1,reverse:!1})}load(e){return ta(this,void 0,void 0,(function*(){return yield this._buffer.load(e),this._onload(),this}))}_onload(e=Ca){e(),this.autostart&&this.start()}_onSourceEnd(e){this.onstop(this),this._activeSources.delete(e),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(e,t,n){return super.start(e,t,n),this}_start(e,t,n){t=this._loop?ha(t,this._loopStart):ha(t,0);const s=this.toSeconds(t),i=n;n=ha(n,Math.max(this._buffer.duration-s,0));let a=this.toSeconds(n);a/=this._playbackRate,e=this.toSeconds(e);const r=new Ir({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(e+a),this._state.setStateAtTime("stopped",e+a,{implicitEnd:!0})),this._activeSources.add(r),this._loop&&zi(i)?r.start(e,s):r.start(e,s,a-this.toSeconds(this.fadeOut))}_stop(e){const t=this.toSeconds(e);this._activeSources.forEach((e=>e.stop(t)))}restart(e,t,n){return super.restart(e,t,n),this}_restart(e,t,n){this._stop(e),this._start(e,t,n)}seek(e,t){const n=this.toSeconds(t);if("started"===this._state.getValueAtTime(n)){const t=this.toSeconds(e);this._stop(n),this._start(n,t)}return this}setLoopPoints(e,t){return this.loopStart=e,this.loopEnd=t,this}get loopStart(){return this._loopStart}set loopStart(e){this._loopStart=e,this.buffer.loaded&&Gi(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopStart=e}))}get loopEnd(){return this._loopEnd}set loopEnd(e){this._loopEnd=e,this.buffer.loaded&&Gi(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((t=>{t.loopEnd=e}))}get buffer(){return this._buffer}set buffer(e){this._buffer.set(e)}get loop(){return this._loop}set loop(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach((t=>{t.loop=e})),e)){const e=this._state.getNextState("stopped",this.now());e&&this._state.cancel(e.time)}}get playbackRate(){return this._playbackRate}set playbackRate(e){this._playbackRate=e;const t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((e=>e.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(e,t)}))}get reverse(){return this._buffer.reverse}set reverse(e){this._buffer.reverse=e}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((e=>e.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}};ea([kr(0)],Or.prototype,"fadeIn",void 0),ea([kr(0)],Or.prototype,"fadeOut",void 0);let Pr=class e extends Ya{constructor(){super(ua(e.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=ua(e.getDefaults(),arguments);this._volume=this.output=new ur({context:this.context,volume:t.volume}),this.volume=this._volume.volume,Ma(this,"volume")}static getDefaults(){return Object.assign(Ya.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let e=!1;return this._synced||(this._synced=!0,e=!0),e}_syncMethod(e,t){const n=this["_original_"+e]=this[e];this[e]=(...e)=>{const s=e[t],i=this.context.transport.schedule((s=>{e[t]=s,n.apply(this,e)}),s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((e=>this.context.transport.clear(e))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(e,t,n,s){const i=this.toSeconds(n),a=this.toSeconds(t);return this.triggerAttack(e,i,s),this.triggerRelease(i+a),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}},Nr=class e extends Pr{constructor(){super(ua(e.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=ua(e.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),n={};Object.keys(t.urls).forEach((e=>{const s=parseInt(e,10);if(qi(Zi(e)||$i(s)&&isFinite(s),`url key is neither a note or midi pitch: ${e}`),Zi(e)){const s=new Ga(this.context,e).toMidi();n[s]=t.urls[e]}else $i(s)&&isFinite(s)&&(n[s]=t.urls[s])})),this._buffers=new or({urls:n,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this.loop=t.loop||!1,this.loopStart=t.loopStart||0,this.loopEnd=t.loopEnd,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(Pr.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:Ca,onerror:Ca,release:.1,urls:{},loop:!1,loopStart:0,loopEnd:void 0})}_findClosest(e){let t=0;for(;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}throw new Error(`No available buffers for note: ${e}`)}triggerAttack(e,t,n=1){return this.log("triggerAttack",e,t,n),Array.isArray(e)||(e=[e]),e.forEach((e=>{const s=La(new Ga(this.context,e).toFrequency()),i=Math.round(s),a=s-i,r=this._findClosest(i),o=i-r,l=this._buffers.get(o),c=Ra(r+a),u=new Ir({url:l,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);this.loop&&(u.loop=!0,u.loopStart=this.loopStart,void 0!==this.loopEnd&&(u.loopEnd=this.loopEnd)),u.start(t,0,this.loop?void 0:l.duration/c,n),Qi(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(u),u.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const e=this._activeSources.get(i),t=e.indexOf(u);-1!==t&&e.splice(t,1)}}})),this}triggerRelease(e,t){return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach((e=>{const n=new Ga(this.context,e).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const e=this._activeSources.get(n);t=this.toSeconds(t),e.forEach((e=>{e.stop(t)})),this._activeSources.set(n,[])}})),this}releaseAll(e){const t=this.toSeconds(e);return this._activeSources.forEach((e=>{for(;e.length;){e.shift().stop(t)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(e,t,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(e,i,s),Qi(t)?(qi(Qi(e),"notes must be an array when duration is array"),e.forEach(((e,n)=>{const s=t[Math.min(n,t.length-1)];this.triggerRelease(e,i+this.toSeconds(s))}))):this.triggerRelease(e,i+this.toSeconds(t)),this}add(e,t,n){if(qi(Zi(e)||isFinite(e),`note must be a pitch or midi: ${e}`),Zi(e)){const s=new Ga(this.context,e).toMidi();this._buffers.add(s,t,n)}else this._buffers.add(e,t,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((e=>{e.forEach((e=>e.dispose()))})),this._activeSources.clear(),this}};ea([kr(0)],Nr.prototype,"attack",void 0),ea([kr(0)],Nr.prototype,"release",void 0);class Rr extends wr{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new Tr({context:this.context,mapping:e=>2*Math.abs(e)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class Dr extends Ya{constructor(){super(Object.assign(ua(Dr.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new Rr({context:this.context}),this.a=new Ka({context:this.context,gain:0}),this.b=new Ka({context:this.context,gain:0}),this.output=new Ka({context:this.context}),this._internalChannels=[this.a,this.b];const e=ua(Dr.getDefaults(),arguments,["fade"]);this.fade=new tr({context:this.context,units:"normalRange",value:e.fade}),Ma(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",Xa(this._split,this.a.gain,0),Xa(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(Ya.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class Vr extends Ya{constructor(){super(ua(Vr.getDefaults(),arguments,["channels"])),this.name="Split";const e=ua(Vr.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(e.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(Ya.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class Lr extends Ya{constructor(){super(ua(Lr.getDefaults(),arguments,["channels"])),this.name="Merge";const e=ua(Lr.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(e.channels)}static getDefaults(){return Object.assign(Ya.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class Br extends Ya{constructor(e){super(e),this.name="StereoEffect",this.input=new Ka({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new Dr({context:this.context,fade:e.wet}),this.wet=this._dryWet.fade,this._split=new Vr({context:this.context,channels:2}),this._merge=new Lr({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),Ma(this,["wet"])}connectEffectLeft(...e){this._split.connect(e[0],0,0),Qa(...e),Xa(e[e.length-1],this._merge,0,0)}connectEffectRight(...e){this._split.connect(e[0],1,0),Qa(...e),Xa(e[e.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(Ya.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class Fr extends Br{constructor(e){super(e),this.feedback=new tr({context:this.context,value:e.feedback,units:"normalRange"}),this._feedbackL=new Ka({context:this.context}),this._feedbackR=new Ka({context:this.context}),this._feedbackSplit=new Vr({context:this.context,channels:2}),this._feedbackMerge=new Lr({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),Ma(this,["feedback"])}static getDefaults(){return Object.assign(Br.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class qr extends Fr{constructor(e){super(e),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),Ma(this,["feedback"])}}class Gr extends Ya{constructor(){super(ua(Gr.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const e=ua(Gr.getDefaults(),arguments,["delayTime","maxDelay"]),t=this.toSeconds(e.maxDelay);this._maxDelay=Math.max(t,this.toSeconds(e.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(t),this.delayTime=new $a({context:this.context,param:this._delayNode.delayTime,units:"time",value:e.delayTime,minValue:0,maxValue:this.maxDelay}),Ma(this,"delayTime")}static getDefaults(){return Object.assign(Ya.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}class Ur extends qr{constructor(){super(ua(Ur.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";const e=ua(Ur.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new Gr({context:this.context,maxDelay:e.maxDelay}),this._rightDelay=new Gr({context:this.context,maxDelay:e.maxDelay}),this._rightPreDelay=new Gr({context:this.context,maxDelay:e.maxDelay}),this.delayTime=new tr({context:this.context,units:"time",value:e.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),Ma(this,["delayTime"])}static getDefaults(){return Object.assign(qr.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class jr extends Ya{constructor(){super(ua(jr.getDefaults(),arguments,["solo"])),this.name="Solo";const e=ua(jr.getDefaults(),arguments,["solo"]);this.input=this.output=new Ka({context:this.context}),jr._allSolos.has(this.context)||jr._allSolos.set(this.context,new Set),jr._allSolos.get(this.context).add(this),this.solo=e.solo}static getDefaults(){return Object.assign(Ya.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(e){e?this._addSolo():this._removeSolo(),jr._allSolos.get(this.context).forEach((e=>e._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){jr._soloed.has(this.context)||jr._soloed.set(this.context,new Set),jr._soloed.get(this.context).add(this)}_removeSolo(){jr._soloed.has(this.context)&&jr._soloed.get(this.context).delete(this)}_isSoloed(){return jr._soloed.has(this.context)&&jr._soloed.get(this.context).has(this)}_noSolos(){return!jr._soloed.has(this.context)||jr._soloed.has(this.context)&&0===jr._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),jr._allSolos.get(this.context).delete(this),this._removeSolo(),this}}jr._allSolos=new Map,jr._soloed=new Map;class Hr extends Ya{constructor(){super(Object.assign(ua(Hr.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const e=ua(Hr.getDefaults(),arguments,["pan"]);this.pan=new $a({context:this.context,param:this._panner.pan,value:e.pan,minValue:-1,maxValue:1}),this._panner.channelCount=e.channelCount,this._panner.channelCountMode="explicit",Ma(this,"pan")}static getDefaults(){return Object.assign(Ya.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class zr extends Ya{constructor(){super(ua(zr.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const e=ua(zr.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new Hr({context:this.context,pan:e.pan,channelCount:e.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new ur({context:this.context,volume:e.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=e.mute,Ma(this,["pan","volume"])}static getDefaults(){return Object.assign(Ya.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(e){this._volume.mute=e}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}(class e extends Ya{constructor(){super(ua(e.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=ua(e.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new jr({solo:t.solo,context:this.context}),this._panVol=this.output=new zr({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),Ma(this,["pan","volume"])}static getDefaults(){return Object.assign(Ya.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(e){this._solo.solo=e}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(e){this._panVol.mute=e}_getBus(t){return e.buses.has(t)||e.buses.set(t,new Ka({context:this.context})),e.buses.get(t)}send(e,t=0){const n=this._getBus(e),s=new Ka({context:this.context,units:"decibels",gain:t});return this.connect(s),s.connect(n),s}receive(e){return this._getBus(e).connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}).buses=new Map;let Wr=class extends Ya{constructor(){super(...arguments),this.name="Listener",this.positionX=new $a({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new $a({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new $a({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new $a({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new $a({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new $a({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new $a({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new $a({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new $a({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(Ya.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}};ba((e=>{e.listener=new Wr({context:e})})),Ta((e=>{e.listener.dispose()}));class $r extends Ya{constructor(){super(ua($r.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";const e=ua($r.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=e.panningModel,this.maxDistance=e.maxDistance,this.distanceModel=e.distanceModel,this.coneOuterGain=e.coneOuterGain,this.coneOuterAngle=e.coneOuterAngle,this.coneInnerAngle=e.coneInnerAngle,this.refDistance=e.refDistance,this.rolloffFactor=e.rolloffFactor,this.positionX=new $a({context:this.context,param:this._panner.positionX,value:e.positionX}),this.positionY=new $a({context:this.context,param:this._panner.positionY,value:e.positionY}),this.positionZ=new $a({context:this.context,param:this._panner.positionZ,value:e.positionZ}),this.orientationX=new $a({context:this.context,param:this._panner.orientationX,value:e.orientationX}),this.orientationY=new $a({context:this.context,param:this._panner.orientationY,value:e.orientationY}),this.orientationZ=new $a({context:this.context,param:this._panner.orientationZ,value:e.orientationZ})}static getDefaults(){return Object.assign(Ya.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(e,t,n){return this.positionX.value=e,this.positionY.value=t,this.positionZ.value=n,this}setOrientation(e,t,n){return this.orientationX.value=e,this.orientationY.value=t,this.orientationZ.value=n,this}get panningModel(){return this._panner.panningModel}set panningModel(e){this._panner.panningModel=e}get refDistance(){return this._panner.refDistance}set refDistance(e){this._panner.refDistance=e}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(e){this._panner.rolloffFactor=e}get distanceModel(){return this._panner.distanceModel}set distanceModel(e){this._panner.distanceModel=e}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(e){this._panner.coneInnerAngle=e}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(e){this._panner.coneOuterAngle=e}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(e){this._panner.coneOuterGain=e}get maxDistance(){return this._panner.maxDistance}set maxDistance(e){this._panner.maxDistance=e}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}let Yr=class e extends Ya{constructor(){super(ua(e.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new tr({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=ua(e.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(Ya.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(e,t){if(Xi(e))return e;{let n;for(n in Qr)if(Qr[n][t]===e)return n;return e}}_setCurve(e,t,n){if(Xi(n)&&Reflect.has(Qr,n)){const s=Qr[n];Yi(s)?"_decayCurve"!==e&&(this[e]=s[t]):this[e]=s}else{if(!Qi(n)||"_decayCurve"===e)throw new Error("Envelope: invalid curve: "+n);this[e]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(e){this._setCurve("_attackCurve","In",e)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(e){this._setCurve("_releaseCurve","Out",e)}get decayCurve(){return this._decayCurve}set decayCurve(e){qi(["linear","exponential"].some((t=>t===e)),`Invalid envelope curve: ${e}`),this._decayCurve=e}triggerAttack(e,t=1){this.log("triggerAttack",e,t),e=this.toSeconds(e);let n=this.toSeconds(this.attack);const s=this.toSeconds(this.decay),i=this.getValueAtTime(e);if(i>0){n=(1-i)/(1/n)}if(n<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,n,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,n,e);else{this._sig.cancelAndHoldAtTime(e);let s=this._attackCurve;for(let e=1;e<s.length;e++)if(s[e-1]<=i&&i<=s[e]){s=this._attackCurve.slice(e),s[0]=i;break}this._sig.setValueCurveAtTime(s,e,n,t)}if(s&&this.sustain<1){const i=t*this.sustain,a=e+n;this.log("decay",a),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(i,s+a):this._sig.exponentialApproachValueAtTime(i,a,s)}return this}triggerRelease(e){this.log("triggerRelease",e),e=this.toSeconds(e);const t=this.getValueAtTime(e);if(t>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,e):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,e):(qi(Qi(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}getValueAtTime(e){return this._sig.getValueAtTime(e)}triggerAttackRelease(e,t,n=1){return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}cancel(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}connect(e,t=0,n=0){return nr(this,e,t,n),this}asArray(e=1024){return ta(this,void 0,void 0,(function*(){const t=e/this.context.sampleRate,n=new ka(1,t,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),a=.1*i,r=i+a,o=new this.constructor(Object.assign(this.get(),{attack:t*this.toSeconds(this.attack)/r,decay:t*this.toSeconds(this.decay)/r,release:t*this.toSeconds(this.release)/r,context:n}));o._sig.toDestination(),o.triggerAttackRelease(t*(s+a)/r,0);return(yield n.render()).getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}};ea([kr(0)],Yr.prototype,"attack",void 0),ea([kr(0)],Yr.prototype,"decay",void 0),ea([function(e,t=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){Gi(s,e,t),n.set(this,s)}})}}(0,1)],Yr.prototype,"sustain",void 0),ea([kr(0)],Yr.prototype,"release",void 0);const Qr=(()=>{const e=128;let t,n;const s=[];for(t=0;t<e;t++)s[t]=Math.sin(t/127*(Math.PI/2));const i=[];for(t=0;t<127;t++){n=t/127;const e=Math.sin(n*(2*Math.PI)*6.4-Math.PI/2)+1;i[t]=e/10+.83*n}i[127]=1;const a=[];for(t=0;t<e;t++)a[t]=Math.ceil(t/127*5)/5;const r=[];for(t=0;t<e;t++)n=t/127,r[t]=.5*(1-Math.cos(Math.PI*n));const o=[];for(t=0;t<e;t++){n=t/127;const e=4*Math.pow(n,3)+.2,s=Math.cos(e*Math.PI*2*n);o[t]=Math.abs(s*(1-n))}function l(e){const t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=1-e[n];return t}return{bounce:{In:l(o),Out:o},cosine:{In:s,Out:(c=s,c.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:i,Out:l(i)},sine:{In:r,Out:l(r)},step:{In:a,Out:l(a)}};var c})();class Xr extends wr{constructor(){super(Object.assign(ua(Xr.getDefaults(),arguments,["value"]))),this.name="Pow";const e=ua(Xr.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new Tr({context:this.context,mapping:this._expFunc(e.value),length:8192}),this._exponent=e.value}static getDefaults(){return Object.assign(wr.getDefaults(),{value:1})}_expFunc(e){return t=>Math.pow(Math.abs(t),e)}get value(){return this._exponent}set value(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class Zr extends Yr{constructor(){super(ua(Zr.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const e=ua(Zr.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=e.octaves,this._baseFrequency=this.toFrequency(e.baseFrequency),this._exponent=this.input=new Xr({context:this.context,value:e.exponent}),this._scale=this.output=new Mr({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(Yr.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(e){const t=this.toFrequency(e);Gi(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}get exponent(){return this._exponent.value}set exponent(e){this._exponent.value=e}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class Kr extends Ya{constructor(){super(ua(Kr.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const e=ua(Kr.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new $a({context:this.context,units:"number",value:e.Q,param:this._filter.Q}),this.frequency=new $a({context:this.context,units:"frequency",value:e.frequency,param:this._filter.frequency}),this.detune=new $a({context:this.context,units:"cents",value:e.detune,param:this._filter.detune}),this.gain=new $a({context:this.context,units:"decibels",convert:!1,value:e.gain,param:this._filter.gain}),this.type=e.type}static getDefaults(){return Object.assign(Ya.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(e){qi(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e),`Invalid filter type: ${e}`),this._filter.type=e}getFrequencyResponse(e=128){const t=new Float32Array(e);for(let a=0;a<e;a++){const n=19980*Math.pow(a/e,2)+20;t[a]=n}const n=new Float32Array(e),s=new Float32Array(e),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(t,n,s),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class Jr extends Ya{constructor(){super(ua(Jr.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new Ka({context:this.context}),this.output=new Ka({context:this.context}),this._filters=[];const e=ua(Jr.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new tr({context:this.context,units:"positive",value:e.Q}),this.frequency=new tr({context:this.context,units:"frequency",value:e.frequency}),this.detune=new tr({context:this.context,units:"cents",value:e.detune}),this.gain=new tr({context:this.context,units:"decibels",convert:!1,value:e.gain}),this._type=e.type,this.rolloff=e.rolloff,Ma(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(Ya.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(e){qi(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e),`Invalid filter type: ${e}`),this._type=e,this._filters.forEach((t=>t.type=e))}get rolloff(){return this._rolloff}set rolloff(e){const t=$i(e)?e:parseInt(e,10),n=[-12,-24,-48,-96];let s=n.indexOf(t);qi(-1!==s,`rolloff can only be ${n.join(", ")}`),s+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach((e=>e.disconnect())),this._filters=new Array(s);for(let i=0;i<s;i++){const e=new Kr({context:this.context});e.type=this._type,this.frequency.connect(e.frequency),this.detune.connect(e.detune),this.Q.connect(e.Q),this.gain.connect(e.gain),this._filters[i]=e}this._internalChannels=this._filters,Qa(this.input,...this._internalChannels,this.output)}getFrequencyResponse(e=128){const t=new Kr({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(e).map((()=>1));return this._filters.forEach((()=>{t.getFrequencyResponse(e).forEach(((e,t)=>n[t]*=e))})),t.dispose(),n}dispose(){return super.dispose(),this._filters.forEach((e=>{e.dispose()})),Aa(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class eo extends Ya{constructor(){super(ua(eo.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new Ka({context:this.context}),this.output=void 0,this.low=new Jr({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new Jr({context:this.context,frequency:0,type:"highpass"}),this.mid=new Jr({context:this.context,frequency:0,type:"lowpass"}),this.high=new Jr({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];const e=ua(eo.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new tr({context:this.context,units:"frequency",value:e.lowFrequency}),this.highFrequency=new tr({context:this.context,units:"frequency",value:e.highFrequency}),this.Q=new tr({context:this.context,units:"positive",value:e.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),Ma(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(Ya.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),Aa(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class to extends Ya{constructor(){super(ua(to.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new Ka({context:this.context}),this._internalChannels=[];const e=ua(to.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new eo({context:this.context,highFrequency:e.highFrequency,lowFrequency:e.lowFrequency}),this._lowGain=new Ka({context:this.context,gain:e.low,units:"decibels"}),this._midGain=new Ka({context:this.context,gain:e.mid,units:"decibels"}),this._highGain=new Ka({context:this.context,gain:e.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),Ma(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(Ya.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),Aa(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class no extends Ya{constructor(){super(ua(no.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();const e=ua(no.getDefaults(),arguments,["url","onload"]);this._buffer=new Ia(e.url,(t=>{this.buffer=t,e.onload()})),this.input=new Ka({context:this.context}),this.output=new Ka({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=e.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(Ya.getDefaults(),{normalize:!0,onload:Ca})}load(e){return ta(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(e)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(e){e&&this._buffer.set(e),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const t=this._buffer.get();this._convolver.buffer=t||null}get normalize(){return this._convolver.normalize}set normalize(e){this._convolver.normalize=e}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function so(){return Na().now()}function io(){return Na().immediate()}Na().transport,Na().destination,Na().destination,Na().listener;const ao=Na().draw,ro=Na();class oo{constructor({initializingElement:e,onInit:t,sceneManager:n,appFSM:s,autoEnableAudio:i=!0}){this.autoEnableAudio=!0,"undefined"!=typeof window&&(window.TONE_SILENCE_LOGGING=!0),this.initializingElement=e||window,this.init=this.init.bind(this),this.onInit=t,this.sceneManager=n,this.appFSM=s,this.autoEnableAudio=i,this.onInitialFadeIn=()=>{}}init(){return __async(this,null,(function*(){if(this.sceneManager)try{yield this.sceneManager.initializeAudioContext(),this.initializingElement.removeEventListener("touchend",this.init),this.initializingElement.removeEventListener("mousedown",this.init),this.sceneManager.setBusVolume("fade",1,1),this.onInitialFadeIn(),_o.setMuteOnBlur("out",.3,this.sceneManager)}catch(e){console.warn(e,"could not initialize audio")}}))}initAudio(){return __async(this,null,(function*(){return this.sceneManager.audioIsInitialized||(this.autoEnableAudio&&this.sceneManager.initializeAudioContext(),this.initializingElement.addEventListener("touchend",this.init),this.initializingElement.addEventListener("mousedown",this.init)),_o.setMuteOnBlur("out",.3,this.sceneManager),this.onInit&&(yield this.onInit())}))}setMute(e){this.sceneManager.setBusMute("master",e)}setBlurMute(e){this.sceneManager.setBusMute("out",e)}disableBlurMute(e){this.sceneManager.disableBlur=e}enableIosHack(e){this.sceneManager.iosHack=e}changeScene(e){var t;null==(t=this.appFSM)||t.transition(e)}trigger(e,t){this.sceneManager.audioIsInitialized&&this.sceneManager.trigger(e,t)}}const lo=({x:e,y:t,rows:n,columns:s,totalWidth:i,totalHeight:a,margin:r=0})=>{const o=Math.round(i-2*r),l=Math.round(a-2*r);r=Math.round(r);const c=Math.round(o/s),u=Math.round(l/n),h=Math.floor((t-r)/u),d=Math.floor((e-r)/c),p=n-1;return{x:d*c+r,y:h*u+r,row:Math.abs(h-p),column:d}};function co(e,t,n,s){var i;function a(e,t,n,s,i){for(var a=0;a<t.length;++a)e.addEventListener(t[a],n,{capture:s,passive:i})}function r(e,t,n,s,i){for(var a=0;a<t.length;++a)e.removeEventListener(t[a],n,{capture:s,passive:i})}function o(){}void 0===n&&(n=!1),void 0===s&&(s=!0),void 0!==document.hidden?i={hidden:"hidden",visibilitychange:"visibilitychange"}:void 0!==document.webkitHidden?i={hidden:"webkitHidden",visibilitychange:"webkitvisibilitychange"}:void 0!==document.mozHidden?i={hidden:"mozHidden",visibilitychange:"mozvisibilitychange"}:void 0!==document.msHidden&&(i={hidden:"msHidden",visibilitychange:"msvisibilitychange"});var l=navigator.userAgent.toLowerCase(),c=n||l.indexOf("iphone")>=0&&l.indexOf("like iphone")<0||l.indexOf("ipad")>=0&&l.indexOf("like ipad")<0||l.indexOf("ipod")>=0&&l.indexOf("like ipod")<0||l.indexOf("mac os x")>=0&&navigator.maxTouchPoints>0;function u(){}function h(e){!e||(e.target,window)}function d(){var t;"running"!==e.state&&"closed"!==e.state&&(w&&(t=e.resume())&&t.then(o,o).catch(o))}function p(e){e&&e.unmute_handled||(e.unmute_handled=!0,d())}i&&a(document,[i.visibilitychange],u,!0,!0),c&&a(window,["focus","blur"],h,!0,!0),s&&(a(e,["statechange"],p,!0,!0),e.onstatechange||(e.onstatechange=p));var m=null;function f(e,t){for(var n=t;e>1;e--)n+=t;return n}var g="data:audio/mpeg;base64,//uQx"+f(23,"A")+"WGluZwAAAA8AAAACAAACcQCA"+f(16,"gICA")+f(66,"/")+"8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkI"+f(320,"A")+"//sQxAADgnABGiAAQBCqgCRMAAgEAH"+f(15,"/")+"7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq"+f(18,"/")+"9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAw"+f(97,"V")+"Q==";let _=!1,y=!1;function v(){m&&(m.src="about:blank",m.load(),m=null)}var b=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],w=!1;function T(){w=!0,function(e){__async(this,null,(function*(){if(c){if(!m){if(_)return!1;var e=document.createElement("div");e.innerHTML="<audio x-webkit-airplay='deny'></audio>",_=!0,(m=e.children.item(0)).controls=!1,m.disableRemotePlayback=!0,m.preload="auto",m.src=g,m.loop=!0,window.LoaderView&&(yield LoaderView.completed),m.load()}if(m.paused){if(y)return!1;var t=m.play();y=!0,t&&t.then(o,v).catch(v)}}}))}(),s&&d()}return a(window,b,T,!0,!0),{dispose:function(){v(),i&&r(document,[i.visibilitychange],u,!0,!0),c&&r(window,["focus","blur"],h,!0,!0),r(window,b,T,!0,!0),r(e,["statechange"],p,!0,!0),e.onstatechange===p&&(e.onstatechange=null)}}}const uo=(e,t)=>Math.sqrt(__pow(e.x-t.x,2)+__pow(e.y-t.y,2)),ho=(e,t,n=1)=>Math.min(Math.max(e,t),n);class po{constructor(e=10,t=0){this.oldestVal=0,this.sum=0,this.firstTime=!0,this.size=e,this.buffer=new Array(this.size).fill(t)}lowpass(e){this.buffer.push(e),this.oldestVal=this.buffer.shift(),this.firstTime?(this.sum=this.buffer.reduce(((e,t)=>e+t)),this.firstTime=!1):this.sum=this.sum-this.oldestVal+e;return this.sum/this.size}}const mo=()=>ro,fo=(e,t)=>{const n=e.numberOfChannels,s=t*n*2+44,i=new ArrayBuffer(s),a=new DataView(i),r=[];let o,l,c=0,u=0;for(d(1179011410),d(s-8),d(1163280727),d(544501094),d(16),h(1),h(n),d(e.sampleRate),d(2*e.sampleRate*n),h(2*n),h(16),d(1635017060),d(s-u-4),o=0;o<e.numberOfChannels;o++)r.push(e.getChannelData(o));for(;u<s;){for(o=0;o<n;o++)l=Math.max(-1,Math.min(1,r[o][c])),l=0|(.5+l<0?32768*l:32767*l),a.setInt16(u,l,!0),u+=2;c++}return new Blob([i],{type:"audio/wav"});function h(e){a.setUint16(u,e,!0),u+=2}function d(e){a.setUint32(u,e,!0),u+=4}},go=e=>{let t,n=e.length,s=0;for(;n--;)s=Math.random()*n|0,t=e[n],e[n]=e[s],e[s]=t;return e},_o={calculateDistance:uo,getRangeBasedOnDistance:e=>{const{maxDistance:t,refDistance:n}=e,s={x:e.listenerPosition.x,y:e.listenerPosition.z},i={x:e.position.x,y:e.position.z},a=uo(s,i);if(a<=n)return 1;const r=ho(Math.abs(a-n),0,t);return a>t?0:-r/(t-n)+1},clip:ho,invert:e=>1-e,getContext:mo,setMuteOnBlur:(e,t=.3,n,s)=>{if(n.disableBlur)return console.log("this.disableBlur",n.disableBlur,"will return now"),()=>{};const i=i=>{document.hidden?(n.setBusVolume(e,0,t),s&&s(!0)):(n.setBusVolume(e,1,t),s&&s(!1))};return window.addEventListener("visibilitychange",i),()=>{window.removeEventListener("visibilitychange",i)}},isWebkit:e=>/\b(iPad|iPhone|iPod)\b/.test(e)&&/WebKit/.test(e)&&!/Edge/.test(e)&&!window.MSStream,isMobile:e=>e.match(/Mobi/),isSafari:e=>e.match(/Safari/)&&!e.match(/Chrome/),decodeFileToBuffer:(e,t)=>__async(this,null,(function*(){const n=yield(e=>new Promise(((t,n)=>{const s=new FileReader;s.readAsArrayBuffer(e),s.onload=()=>t(s.result),s.onerror=e=>n(e)})))(t);return yield e.decodeAudioData(n)})),convertBufferToWave:fo,Smoother:po,MouseInteraction:class{constructor({columns:e,rows:t,onTrigger:n,onFrame:s,options:i}){this.state={mouseIsMoving:!1,mouseEnergy:0,mouseActionEnabled:!1,mouseCoords:{x:0,y:0},lastMouseCoords:{x:0,y:0},stopped:!0,velocity:0,mouseIsDown:!1},this.numColumns=6,this.numRows=6,this.velocityDecay=.94,this.maxVelocity=20,this.width=0,this.height=0,this.boundingRect=null,this.useMouseDown=!1,this.handleMouseMove=e=>{const{clientX:t,clientY:n}=e;this.useMouseDown&&!this.state.mouseIsDown||this.setMouseCoords.bind(this)(t,n,this.width,this.height)},this.handleTouchMove=e=>{const{touches:t}=e;if(t.length>0){const{clientX:e,clientY:n}=t[0];if(this.boundingRect){const t=this.boundingRect.left,s=this.boundingRect.right,i=this.boundingRect.top,a=this.boundingRect.bottom;e>=t&&e<=s&&n>=i&&n<=a&&this.setMouseCoords.bind(this)(e,n,this.width,this.height)}else this.setMouseCoords.bind(this)(e,n,this.width,this.height)}},this.numColumns=e,this.numRows=t,this.onTrigger=n,this.onFrame=s,this.energySmoother=new po(5,0),i&&i.velocityDecay&&(this.velocityDecay=i.velocityDecay),i&&i.maxVelocity&&(this.maxVelocity=i.maxVelocity),i&&i.useMouseDown&&(this.useMouseDown=i.useMouseDown)}start(e){this.state.stopped=!1,this.bindMouseMove(e)}stop(){this.state.mouseActionEnabled=!1,this.state.stopped=!0}enable(){this.state.mouseActionEnabled=!0}disable(){this.state.mouseActionEnabled=!1}bindMouseMove(e){e instanceof HTMLElement?(this.width=e.clientWidth,this.height=e.clientHeight,this.boundingRect=e.getBoundingClientRect()):e instanceof Window?(this.width=e.innerWidth,this.height=e.innerHeight):e instanceof Document&&(this.width=window.innerWidth,this.height=window.innerHeight),e.addEventListener("mousemove",this.handleMouseMove),e.addEventListener("touchmove",this.handleTouchMove),this.useMouseDown&&(e.addEventListener("mousedown",(()=>{this.state.mouseIsDown=!0})),e.addEventListener("mouseup",(()=>{this.state.mouseIsDown=!1}))),this.startRequestAnimationFrame()}setMouseCoords(e,t,n,s){this.state.mouseActionEnabled&&this.triggerGrid(this.state.mouseCoords,{x:e,y:t},n,s),this.state.lastMouseCoords=this.state.mouseCoords,this.state.mouseCoords={x:e,y:t}}triggerGrid(e,t,n,s){let i=lo({x:e.x,y:e.y,rows:this.numRows,columns:this.numColumns,totalWidth:n,totalHeight:s}),a=lo({x:t.x,y:t.y,rows:this.numRows,columns:this.numColumns,totalWidth:n,totalHeight:s});this.setMouseDelta(i.x-a.x,i.y-a.y),i.x===a.x&&i.y===a.y||this.onTrigger&&this.onTrigger(a)}setMouseDelta(e,t){this.state.mouseIsMoving=!0,e<=.001&&t<=.001&&(this.state.mouseIsMoving=!1);const n=Math.sqrt(__pow(e,2)+__pow(t,2))/500,s=ho(this.state.mouseEnergy+n,0,1);this.state.mouseEnergy=this.energySmoother.lowpass(s)}setVelocity(e,t,n){var s=Math.sqrt(__pow(e,2)+__pow(t,2))/n;null!==s&&s<this.maxVelocity&&(this.state.velocity=s)}startRequestAnimationFrame(){let e=0,t={x:0,y:0};const n=s=>{const i=(a=.01,r=((e,t)=>1e3/(e-t))(s,e),a*(120/r));var a,r;this.state.mouseEnergy>0&&(this.state.mouseEnergy-=i),this.state.mouseCoords.x!==t.x&&this.state.mouseCoords.y!==t.y&&s-e<100&&this.setVelocity(t.x-this.state.mouseCoords.x,t.y-this.state.mouseCoords.y,s-e),this.state.velocity>0&&(this.state.velocity=this.state.velocity*=this.velocityDecay),e=s,t=this.state.mouseCoords,this.onFrame&&this.onFrame(this.state),this.state.stopped||requestAnimationFrame(n)};n(0)}removeListeners(e){this.stop(),e.removeEventListener("mousemove",this.handleMouseMove),e.removeEventListener("touchmove",this.handleTouchMove)}},unmuteIOS:(e=!1,t=!0)=>co(mo().rawContext,0,e,t),makeArray:e=>Array.isArray(e)?e:[e],bindAudioStart:(e,t)=>__async(this,null,(function*(){const n=()=>__async(this,null,(function*(){try{yield e.initializeAudioContext(),t.removeEventListener("touchend",n),t.removeEventListener("mousedown",n)}catch(s){console.warn(s,"could not initialize audio")}}));e.audioIsInitialized||(t.addEventListener("touchend",n),t.addEventListener("mousedown",n))})),InteractiveLayerBase:oo,getQuantizedToGrid:({x:e,y:t,rows:n,columns:s,totalWidth:i,totalHeight:a,margin:r=0})=>{const o=Math.round(i-2*r),l=Math.round(a-2*r);r=Math.round(r);const c=Math.round(o/s),u=Math.round(l/n),h=Math.floor((t-r)/u),d=Math.floor((e-r)/c),p=n-1;return{x:d*c+r,y:h*u+r,row:Math.abs(h-p),column:d}}};var yo=(e=>(e.UPDATE="update",e.MOVE="move",e.DELETE="delete",e.CREATE="create",e))(yo||{});class vo{constructor(e){this.updateListeners=[],this.config=e}load(e){this.config=e}setName(e){return this.config.name=e,this.config.name}addSource(e){this.config.sources.push(e)}addInstrument(e,t){this.config.scenes[e].sounds.push(t)}deleteInstrument(e){const t=e.split(":")[0],n=e.split(":")[1];this.config.scenes[t].sounds=this.config.scenes[t].sounds.filter((e=>e.name!==n))}updateBus({bus:e,toUpdate:t={},action:n="update"}){const s=this.config.busses.find((t=>t.name===e));let i={};switch(n){case"create":t.name&&0===this.config.busses.filter((e=>e.name===t.name)).length&&(this.config.busses.push(t),i=t);break;case"delete":const n=this.config.busses.find((t=>t.name===e));this.config.busses=this.config.busses.filter((t=>t.name!==e)),this.config.busses.forEach((t=>{t.parent===e&&this.updateBus({bus:t.name,toUpdate:{parent:n.parent},action:"update"})})),Object.values(this.config.scenes).forEach((t=>{t.bus===e&&delete t.bus,t.sounds.forEach((t=>{t.bus===e&&delete t.bus}))})),i.name=e;default:s&&Object.keys(t).forEach((e=>{if(s[e]===t[e])return;if(e.split(":").length>1){const[n,a]=e.split(":");if("sendTo"===n){const n=s.sends.find((e=>e.bus===a));n&&(n.gain=t[e])}else{const i=s.effects.find((e=>e.effectType.toLowerCase()===n));i&&(i.settings[a]=t[e])}i[e]=t[e]}else s[e]=t[e],i[e]=s[e]})),t.name&&(this.config.busses.forEach((n=>{n.parent===e&&(n.parent=t.name)})),Object.values(this.config.scenes).forEach((n=>{n.bus===e&&(n.bus=t.name),n.sounds.forEach((n=>{n.bus===e&&(n.bus=t.name)}))})))}const a=`busses.${e}`;return Object.keys(i).length>0&&this.onUpdate({location:a,toUpdate:i,action:n}),i}updateSource({source:e,toUpdate:t={},action:n="update"}){const s=this.config.sources.find((t=>t.name===e));let i={};switch(n){case"create":const n=t,{buffer:a}=n,r=__objRest(n,["buffer"]);this.addSource(r),i=t;break;case"delete":this.config.sources=this.config.sources.filter((t=>t.name!==e)),i=t;default:s&&Object.keys(t).forEach((e=>{s[e]!==t[e]&&(s[e]=t[e],i[e]=s[e])}))}const a=`sources.${e}`;return Object.keys(i).length>0&&this.onUpdate({location:a,toUpdate:i,action:n}),i}updateInstrument({instrument:e,toUpdate:t={},action:n="update"}){const s=e.split(":")[0],i=e.split(":")[1],a=this.config.scenes[s].sounds.find((e=>e.name===i));let r={};switch(n){case"move":if(t.scene){let e=t.scene;r.scene=e,this.config.scenes[e].sounds.push(a),this.config.scenes[s].sounds.splice(this.config.scenes[s].sounds.findIndex((e=>e.name===i)),1)}break;case"delete":this.config.scenes[s].sounds=this.config.scenes[s].sounds.filter((e=>e.name!==i)),r.name=i;break;case"create":const e=t,{buffer:n}=e,o=__objRest(e,["buffer"]);this.config.scenes[s].sounds.push(o);const l={name:o.sound};this.config.sources.push(l),r=t;break;default:a&&Object.keys(t).forEach((e=>{a[e]!==t[e]&&(a[e]=t[e],r[e]=a[e])}))}const o=`scenes.${s}.sounds.${i}`;return Object.keys(r).length>0&&this.onUpdate({location:o,toUpdate:r,action:n}),r}updateScene({scene:e,toUpdate:t={},action:n="update"}){const s={},i=this.config.scenes[e];switch(n){case"delete":delete this.config.scenes[e].sounds,s.scene=e;break;case"create":i||(this.config.scenes[e]={sounds:[]},s.scene=e);break;case"update":i&&Object.keys(t).forEach((e=>{i[e]!==t[e]&&(i[e]=t[e],s[e]=i[e])}))}const a=`scenes.${e}`;return Object.keys(s).length>0&&this.onUpdate({location:a,toUpdate:s,action:n}),s}cleanConfig(e){const t=JSON.parse(JSON.stringify(e));return t.sources=t.sources.map((e=>(e.file===e.name&&delete e.file,e))),t.scenes=Object.entries(t.scenes).reduce(((e,[t,n])=>{const s=n.bus;if(s){const i=n.sounds.map((e=>(e.bus===s&&delete e.bus,"player"===e.type&&delete e.type,e)));n.sounds=i,e[t]=n}else e[t]=n;return e}),{}),this.removeUnusedSources(t),t}removeUnusedSources(e){const t=new Set;for(const n of Object.values(e.scenes)){const e=n.sounds;if(e&&e.length)for(const n of e){const e=n.sound;"string"==typeof e?t.add(e):Array.isArray(e)?e.forEach((e=>{"string"==typeof e&&t.add(e)})):"object"==typeof e&&Object.values(e).forEach((e=>t.add(e)))}}for(const n of e.busses){const e=n.effects;if(Array.isArray(e))for(const n of e)n.settings&&n.settings.sound&&t.add(n.settings.sound)}return e.sources=e.sources.filter((e=>t.has(e.name))),e}getCurrentConfig(e,t){return this.config.busses.forEach((t=>{const n=e.get(t.name);1!==n.channel.initialGain&&n.channel.initialGain!==t.gain&&(t.gain=n.channel.initialGain)})),Object.entries(this.config.scenes).forEach((([e])=>{var n;null==(n=this.config.scenes[e].sounds)||n.forEach((n=>{var s,i,a;const r=t.getInstrument(`${e}:${n.name}`);r?(1!==(null==(s=r.channel)?void 0:s.initialGain)&&(null==(i=r.channel)?void 0:i.initialGain)!==n.gain&&(n.gain=null==(a=r.channel)?void 0:a.initialGain),r.settings.loop&&(n.loop=!0),0!==r.settings.loopStart&&(n.loopStart=r.settings.loopStart),0!==r.settings.loopEnd&&(n.loopEnd=r.settings.loopEnd),n.type!==r.settings.type&&(n.type=r.settings.type),n.sound!==r.settings.sound&&(n.sound=r.settings.sound)):console.warn(`Could not find instrument ${n.name}`)}))})),this.cleanConfig(this.config)}setOnUpdate(e){-1===this.updateListeners.indexOf(e)&&this.updateListeners.push(e)}onUpdate(e){this.updateListeners.forEach((t=>{t(e)}))}}class bo{constructor(e,t="/"){this.supportedLanguages=["en"],this.baseFilePath=t,this.buffersInProgress=new Map,this.sources=new Map,e.forEach((e=>{this.sources.set(e.name,e)})),this.buffers=new Map}setConfigManager(e){this.config=e,this.config.setOnUpdate(this.onConfigUpdate.bind(this))}addSources(e){e.forEach((e=>{this.addSource(e)}))}addSource(e,t){return t&&this.setSoundBuffer(e.name,t),this.sources.set(e.name,e),e}getSource(e){return this.sources.get(e)}getSoundBuffer(e,t=!1){return __async(this,null,(function*(){const n=this.buffers.get(e);if(n)return Promise.resolve(n);if(this.buffersInProgress.get(e))return this.buffersInProgress.get(e);const s=this.sources.get(e);let i;if(void 0===s&&window.AE_DEBUG&&console.warn("Sound:",e,"is not defined in the source list."),s.file||(s.file=s.name),t){const e=this.getLocalizedPathName();e?i=`${this.baseFilePath}${e}/${s.file}`:(console.warn("BufferManager: Couldn't resolve localized path for",s.file),i=`${this.baseFilePath}${s.file}`)}else i=`${this.baseFilePath}${s.file}`;const a=Ia.load(`${i}.[ogg|mp3]`);this.buffersInProgress.set(e,a);const r=yield a;return r&&this.buffers.set(e,r),this.buffersInProgress.delete(e),r}))}getLocalizedPathName(){const e=this.language||navigator.language;let t=null;return t=this.supportedLanguages.includes(e)?e:"en",t||(t=this.defaultLanguage),t}onConfigUpdate(e){const{location:t,toUpdate:n,action:s}=e;if(t.match(/^sources\./)){const e=t.split(".")[1];switch(s){case yo.CREATE:this.addSource(n,n.buffer);break;case yo.DELETE:this.removeSource(e);break;case yo.UPDATE:this.updateSource(e,n)}}else if(t.match(/^scenes\./)){const e=t.split(".");if(e.length>3&&"sounds"===e[2]){const t=e[3],i=n.source||t;switch(s){case yo.CREATE:this.buffers.has(i)||this.addSource(n,n.buffer);case yo.DELETE:}}}}updateSource(e,t){}setSoundBuffer(e,t){this.buffers.set(e,t)}removeSource(e){this.sources.delete(e)}deleteSoundBuffer(e){this.buffers.delete(e)}empty(){this.buffers.forEach(((e,t)=>this.deleteSoundBuffer(t)))}setBaseFilePath(e){this.baseFilePath=e}setSupportedLanguages(e){this.supportedLanguages=e}setDefaultLanguage(e){this.defaultLanguage=e}setLanguage(e){this.language=e}exportAllBuffers(){return Array.from(this.buffers).map((([e,t])=>[e,fo(t,t.length)]))}}const wo={default:0,warp:"linear",min:0,max:1},To=class{constructor(e){this.definition=__spreadValues(__spreadValues({},wo),e)}process(e){const{warp:t,min:n=0,max:s=1}=this.definition;let i=e;return t&&(i=((e,t)=>{let n=e=>e;if("string"==typeof t)switch(t){case"exp":n=e=>__pow(e,2);break;case"cubic":n=e=>__pow(e,3)}else"function"==typeof t&&(n=t);return n(e)})(e,t)),"number"==typeof e&&(i=((e,t,n)=>e*Math.abs(n-t)+t)(e,n,s)),i}};To.PAN={definition:{default:0,min:-1,max:1},process:e=>2*e-1},To.BOOLEAN={definition:{default:!1},process:e=>!!e};let xo=To;class So{constructor({name:e,set:t,controlSpec:n}){this.controlSpec=n||new xo({}),this.name=e,this._rawValue=this.controlSpec.definition.default,this.setCallback=t}get rawValue(){return this._rawValue}set(e,t){const n=this.controlSpec.process(e);return this._rawValue=n,this.setCallback(n,t),this}setRaw(e,t){"default"!==e&&null!=e||(e=this.controlSpec.definition.default),this._rawValue=e,this.setCallback(e,t)}}const Eo=e=>new So({name:"gain",set:(t,{fadeTime:n=0,startTime:s}={})=>e.channel.setGain(t,n,s)}),Mo=e=>new So({name:"pan",set:t=>e.channel.setPosition(t)});var Ao,Co=new Uint8Array(16);function Io(){if(!Ao&&!(Ao="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ao(Co)}const ko=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Oo(e){return"string"==typeof e&&ko.test(e)}for(var Po=[],No=0;No<256;++No)Po.push((No+256).toString(16).substr(1));function Ro(e,t,n){var s=(e=e||{}).random||(e.rng||Io)();return s[6]=15&s[6]|64,s[8]=63&s[8]|128,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Po[e[t+0]]+Po[e[t+1]]+Po[e[t+2]]+Po[e[t+3]]+"-"+Po[e[t+4]]+Po[e[t+5]]+"-"+Po[e[t+6]]+Po[e[t+7]]+"-"+Po[e[t+8]]+Po[e[t+9]]+"-"+Po[e[t+10]]+Po[e[t+11]]+Po[e[t+12]]+Po[e[t+13]]+Po[e[t+14]]+Po[e[t+15]]).toLowerCase();if(!Oo(n))throw TypeError("Stringified UUID is invalid");return n}(s)}const Do=(e=1)=>new Tr((t=>ho(2*t-e,0,1)));class Vo{constructor(e,t){this.name="lfo",this.uuid=Ro(),this.params=new Map;const{frequency:n=2,min:s=0,max:i=1,waveshaper:a,type:r,phase:o=0}=e,l=new Cr(n,s,i);if(r&&(l.type=r),o&&(l.phase=o),a){const{sparseness:e}=a,t=Do(e);Xa(l,t),this.modulator=t}else this.modulator=l;l.start();const c=`${t}-lfo-frequency`;this.params.set(c,new So({name:c,set:e=>l.set({frequency:e}),controlSpec:new xo({min:.05,max:20,default:l.frequency})}));const u=`${t}-lfo-min`;this.params.set(u,new So({name:u,set:e=>l.set({min:e}),controlSpec:new xo({min:s,max:i,default:l.min})}));const h=`${t}-lfo-max`;this.params.set(h,new So({name:h,set:e=>l.set({max:e}),controlSpec:new xo({min:s,max:i,default:l.max})}))}setParam(e,t,n){this.params.get(e).set(t,n)}play(e,t){this.modulator.start(e)}connect(e){this.modulator.connect(e)}disconnect(){this.modulator.disconnect()}dispose(){this.disconnect(),this.modulator.dispose()}}const Lo=e=>e?Bo[e.toLowerCase()]:Vo,Bo={lfo:Vo,envelope:class{constructor(e,t){this.name="envelope",this.uuid=Ro(),this.params=new Map,this.modulator=new Yr(e);const n=`${this.name}-env-attack`;this.params.set(n,new So({name:n,set:e=>this.modulator.attack=e,controlSpec:new xo({min:0,max:20,default:this.modulator.attack.value})}));const s=`${this.name}-env-decay`;this.params.set(s,new So({name:s,set:e=>this.modulator.decay=e,controlSpec:new xo({min:0,max:2,default:this.modulator.decay.value})}));const i=`${this.name}-env-sustain`;this.params.set(i,new So({name:i,set:e=>this.modulator.sustain=e,controlSpec:new xo({min:0,max:1,default:this.modulator.sustain.value})}));const a=`${this.name}-env-release`;this.params.set(a,new So({name:a,set:e=>this.modulator.release=e,controlSpec:new xo({min:0,max:20,default:this.modulator.release.value})}))}setParam(e,t,n){this.params.get(e).set(t,n)}play(e,t){this.modulator.triggerAttackRelease(t,e)}connect(e){this.modulator.connect(e)}disconnect(){this.modulator.disconnect()}dispose(){this.disconnect(),this.modulator.dispose()}},frequencyenvelope:class{constructor(e,t){this.name="envelope",this.uuid=Ro(),this.params=new Map,this.modulator=new Zr(e);const n=`${this.name}-env-attack`;this.params.set(n,new So({name:n,set:e=>this.modulator.attack=e,controlSpec:new xo({min:0,max:20,default:this.modulator.attack})}));const s=`${this.name}-env-decay`;this.params.set(s,new So({name:s,set:e=>this.modulator.decay=e,controlSpec:new xo({min:0,max:2,default:this.modulator.decay})}));const i=`${this.name}-env-sustain`;this.params.set(i,new So({name:i,set:e=>this.modulator.sustain=e,controlSpec:new xo({min:0,max:1,default:this.modulator.sustain})}));const a=`${this.name}-env-release`;this.params.set(a,new So({name:a,set:e=>this.modulator.release=e,controlSpec:new xo({min:0,max:20,default:this.modulator.release})}));const r=`${this.name}-env-base-frequency`;this.params.set(r,new So({name:r,set:e=>this.modulator.baseFrequency=e,controlSpec:new xo({min:10,max:4e3,default:this.modulator.baseFrequency,warp:"exp"})}));const o=`${this.name}-env-octaves`;this.params.set(o,new So({name:o,set:e=>this.modulator.octaves=e,controlSpec:new xo({min:0,max:10,default:this.modulator.octaves,step:1})}))}setParam(e,t,n){this.params.get(e).set(t,n)}play(e,t){this.modulator.cancel(e),this.modulator.triggerAttackRelease(t,e)}connect(e){this.modulator.connect(e)}disconnect(){this.modulator.disconnect()}dispose(){this.disconnect(),this.modulator.dispose()}}};let Fo=class{constructor(e){this.name="lpf",this.uuid=Ro(),this.params=new Map;const{frequency:t=17e3,Q:n=1}=e;this.modulators=[];const s=new Jr(t,"lowpass");n&&(s.Q.value=n),this.effectInstance=s,Object.entries(e).forEach((([e,t])=>{if("object"==typeof t){const n=t,{type:s}=n,i=n.settings,a=new(Lo(s))(i,e);a.connect(this.effectInstance[e]),this.modulators.push(a)}})),this.initParams(),this.setModulatorParams()}setModulatorParams(){this.modulators.forEach((e=>{const{params:t}=e;t.forEach((e=>{this.params.set(`${this.name}:${e.name}`,e)}))}))}initParams(){this.params=new Map([new So({name:"frequency",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.frequency.cancelScheduledValues(0),this.effectInstance.frequency.setTargetAtTime(e,0,t)},controlSpec:new xo({min:.1,max:2e4,warp:"exp",default:this.effectInstance.frequency.value})}),new So({name:"Q",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.Q.cancelScheduledValues(0),this.effectInstance.Q.setTargetAtTime(e,0,t)},controlSpec:new xo({min:0,max:30,default:this.effectInstance.Q.value})})].map((e=>[e.name,e])))}setParam(e,t,n){this.params.get(e).set(t,n)}setRawParam(e,t,n){this.params.get(e).setRaw(t,n)}disconnect(){this.effectInstance.disconnect(),this.modulators.forEach((e=>{e.disconnect()}))}dispose(){this.disconnect(),this.effectInstance.dispose(),this.modulators.forEach((e=>{e.dispose()}))}};const qo={lpf:Fo,bpf:class{constructor(e){this.name="bpf",this.uuid=Ro(),this.params=new Map;const{frequency:t}=e;this.frequency=t||17e3,this.Q=e&&e.Q||1,this.modulators=[];const n=new Jr(this.frequency,"bandpass");this.Q&&(n.Q.value=this.Q),this.effectInstance=n,Object.entries(e).forEach((([e,t])=>{if("object"==typeof t){const n=t,{type:s}=n,i=n.settings,a=new(Lo(s))(i);a.connect(this.effectInstance[e]),this.modulators.push(a)}})),this.initParams()}initParams(){this.params=new Map([new So({name:"frequency",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.frequency.cancelScheduledValues(0),this.effectInstance.frequency.setTargetAtTime(e,0,t)},controlSpec:new xo({min:.1,max:2e4,warp:"exp",default:this.effectInstance.frequency.value})}),new So({name:"Q",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.Q.cancelScheduledValues(0),this.effectInstance.Q.setTargetAtTime(e,0,t)},controlSpec:new xo({min:0,max:30,default:this.effectInstance.Q.value})})].map((e=>[e.name,e])))}setParam(e,t,n){this.params.get(e).set(t,n)}setRawParam(e,t,n){this.params.get(e).setRaw(t,n)}disconnect(){this.effectInstance.disconnect(),this.modulators.forEach((e=>{e.disconnect()}))}dispose(){this.disconnect(),this.effectInstance.dispose(),this.modulators.forEach((e=>{e.dispose()}))}},hpf:class{constructor(e){this.name="hpf",this.uuid=Ro(),this.params=new Map;const{frequency:t=200,Q:n=1}=e;this.modulators=[];const s=new Jr(t,"highpass");n&&(s.Q.value=n),this.effectInstance=s,Object.entries(e).forEach((([e,t])=>{if("object"==typeof t){const n=t,{type:s}=n,i=n.settings,a=new(Lo(s))(i);a.connect(this.effectInstance[e]),this.modulators.push(a)}})),this.initParams()}initParams(){this.params=new Map([new So({name:"frequency",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.frequency.cancelScheduledValues(0),this.effectInstance.frequency.setTargetAtTime(e,0,t)},controlSpec:new xo({min:.1,max:2e4,warp:"exp",default:this.effectInstance.frequency.value})}),new So({name:"Q",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.Q.cancelScheduledValues(0),this.effectInstance.Q.setTargetAtTime(e,0,t)},controlSpec:new xo({min:0,max:30,default:this.effectInstance.Q.value})})].map((e=>[e.name,e])))}setParam(e,t,n){this.params.get(e).set(t,n)}setRawParam(e,t,n){this.params.get(e).setRaw(t,n)}disconnect(){this.effectInstance.disconnect(),this.modulators.forEach((e=>{e.disconnect()}))}dispose(){this.disconnect(),this.effectInstance.dispose(),this.modulators.forEach((e=>{e.dispose()}))}},reverb:class{constructor(e,t){this.uuid=Ro(),this.modulators=[],this.name="reverb",this.params=new Map;const n=new no;e&&e.sound&&t&&t().then((e=>{e.length&&(n.buffer=e[0])})),this.effectInstance=n,this.initParams()}initParams(){this.params=new Map}setParam(e,t,n){this.params.get(e).set(t,n)}disconnect(){this.effectInstance.disconnect()}dispose(){this.disconnect(),this.effectInstance.dispose()}},pingpong:class{constructor(e){this.uuid=Ro(),this.name="pingpong",this.params=new Map;const t=e&&e.delayTime||"8n",n=e&&void 0!==e.feedback?e.feedback:.5,s=new Ur({delayTime:t,feedback:n,maxDelay:3});this.effectInstance=s,this.modulators=[],this.initParams(),Object.entries(e).forEach((([e,t])=>{if("object"==typeof t){const n=t,s=new(Lo(n.type))(n);s.connect(this.effectInstance[e]),this.modulators.push(s)}}))}setParam(e,t,n){this.params.get(e).set(t,n)}initParams(){this.params=new Map([new So({name:"delayTime",set:e=>this.effectInstance.delayTime.setValueAtTime(e),controlSpec:new xo({min:.001,max:20,default:this.effectInstance.delayTime.value})}),new So({name:"feedback",set:e=>this.effectInstance.feedback.setValueAtTime(e),controlSpec:new xo({min:0,max:1,default:this.effectInstance.feedback.value})})].map((e=>[e.name,e])))}disconnect(){this.effectInstance.disconnect(),this.modulators.forEach((e=>{e.disconnect()}))}dispose(){this.disconnect(),this.effectInstance.dispose(),this.modulators.forEach((e=>{e.dispose()}))}},eq:class{constructor(e){this.name="eq",this.uuid=Ro(),this.params=new Map;const{high:t=0,highFrequency:n=5e3,low:s=0,lowFrequency:i=100,mid:a=0}=e;this.modulators=[];const r=new to({high:t,highFrequency:n,low:s,lowFrequency:i,mid:a});this.effectInstance=r,Object.entries(e).forEach((([e,t])=>{if("object"==typeof t){const n=t,{type:s}=n,i=n.settings,a=new(Lo(s))(i,e);a.connect(this.effectInstance[e]),this.modulators.push(a)}})),this.initParams(),this.setModulatorParams()}setModulatorParams(){this.modulators.forEach((e=>{const{params:t}=e;t.forEach((e=>{this.params.set(`${this.name}:${e.name}`,e)}))}))}initParams(){this.params=new Map([new So({name:"high",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.high.cancelScheduledValues(0),this.effectInstance.high.setTargetAtTime(e,0,t)},controlSpec:new xo({min:-99,max:20,warp:"exp",default:this.effectInstance.high.value})}),new So({name:"highFrequency",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.highFrequency.cancelScheduledValues(0),this.effectInstance.highFrequency.setTargetAtTime(e,0,t)},controlSpec:new xo({min:1,max:2e4,warp:"exp",default:this.effectInstance.highFrequency.value})}),new So({name:"low",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.low.cancelScheduledValues(0),this.effectInstance.low.setTargetAtTime(e,0,t)},controlSpec:new xo({min:-99,max:20,warp:"exp",default:this.effectInstance.low.value})}),new So({name:"lowFrequency",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.lowFrequency.cancelScheduledValues(0),this.effectInstance.lowFrequency.setTargetAtTime(e,0,t)},controlSpec:new xo({min:1,max:2e4,warp:"exp",default:this.effectInstance.lowFrequency.value})}),new So({name:"mid",set:(e,{fadeTime:t=.01}={})=>{this.effectInstance.mid.cancelScheduledValues(0),this.effectInstance.mid.setTargetAtTime(e,0,t)},controlSpec:new xo({min:-99,max:20,warp:"exp",default:this.effectInstance.mid.value})})].map((e=>[e.name,e])))}setParam(e,t,n){this.params.get(e).set(t,n)}setRawParam(e,t,n){this.params.get(e).setRaw(t,n)}disconnect(){this.effectInstance.disconnect(),this.modulators.forEach((e=>{e.disconnect()}))}dispose(){this.disconnect(),this.effectInstance.dispose(),this.modulators.forEach((e=>{e.dispose()}))}}},Go="stereo",Uo="mono",jo="3d",Ho={gain:1,spatial:{isPositional:Go,refDistance:9,rolloffFactor:5}};class zo{constructor(e,t,n){this.params=new Map,this.isStatic=!1,this.pannerPosition=null,this.sends={},this.maxAudibleDistance=40,this.isPositional=Go,(t=__spreadValues(__spreadValues({},Ho),t)).spatial=__spreadValues(__spreadValues({},Ho.spatial),t.spatial),this.resolveSources=n;const{spatial:s,gain:i}=t;this.initialGain=void 0!==i&&"number"==typeof i?i:1,this.effects=[],this.modulators=[],this.isStatic=(null==s?void 0:s.static)||(null==s?void 0:s.doesNotMove),this.isPositional=null==s?void 0:s.mode,this.maxAudibleDistance=(null==s?void 0:s.maxAudibleDistance)||40,this.initParams();const a=this.setupAudioGraph(this.isPositional,t);this.setupEffects(t.effects||[],a),this.gainSignal=new tr({value:this.initialGain}).connect(this.gain.gain),e&&this.add(e)}initParams(){this.params=new Map([new So({name:"gain",set:(e,t)=>this.setGain(e,null==t?void 0:t.fadeTime,null==t?void 0:t.when),controlSpec:new xo({min:0,max:3,default:this.initialGain})}),new So({name:"pan",set:e=>this.setPosition(e),controlSpec:new xo({min:-1,max:1,default:0})})].map((e=>[e.name,e])))}setupAudioGraph(e=Go,t){const{spatial:{refDistance:n,rolloffFactor:s}}=t;let i;return this.muteGain=new Ka(1),this.gain=new Ka(0),"object"==typeof t.gain&&(this.modulatorGain=new Ka(1),this.createModulator(t.gain,this.modulatorGain.gain),this.modulatorGain.connect(this.gain)),e===jo?(i=new $r({panningModel:"equalpower",refDistance:n,rolloffFactor:s}),this.panner=i):e===Uo?(i=new Hr,this.panner=i):this.panner=new Ka(1),this.panner}createModulator(e,t){const{type:n,settings:s}=e,i=new(Lo(n))(s);i.connect(t),this.modulators.push(i)}setupEffects(e,t){for(let n=0;n<e.length;n++){const s=e[n],i=this.createEffect(s);i&&(t.connect(i.effectInstance),t=i.effectInstance,this.effects.push(i),this.addEffectParams(i))}t.connect(this.muteGain),this.modulatorGain?this.muteGain.connect(this.modulatorGain):this.muteGain.connect(this.gain)}addEffectParams(e){const{params:t,name:n}=e;t.forEach((e=>{this.params.set(`${n}:${e.name}`,e)}))}createEffect(e){const{effectType:t,settings:n={}}=e,s=(i=t)?qo[i.toLowerCase()]:Fo;var i;if(void 0===s)return window.AE_DEBUG&&console.warn("can't find effectType:",t),null;return new s(n,this.resolveSources)}add(e){e.connect(this.panner),this.node=e}addSend(e,t){const{gain:n=0}=t,s=new Ka;s.gain.value="number"==typeof n?n:0,t.pre?this.node.connect(s):this.gain.connect(s),s.connect(e.input),this.sends[e.settings.name]=s;const i=`sendTo:${e.settings.name}`;this.params.set(i,new So({name:i,set:(t,n)=>this.setSendGain(e.settings.name,t,null==n?void 0:n.fadeTime,null==n?void 0:n.when),controlSpec:new xo({min:0,max:1,default:s.gain.value})})),"object"==typeof n&&this.createModulator(n,s.gain)}connect(e,t=0,n=0){this.gain.connect(e,t,n)}disconnect(){this.gain.disconnect()}updateDestination(e){this.disconnect(),this.connect(e)}setMuteState(e,t){let n=.2;return t&&t.fadeTime&&({fadeTime:n}=t),e?(this.muteGain.gain.rampTo(0,n),new Promise((e=>{setTimeout((()=>e(!0)),n)}))):(this.muteGain.gain.rampTo(1,n),new Promise((e=>{setTimeout((()=>e(!1)),n)})))}setPosition(e,t,n){"3d"===this.isPositional&&this.isStatic&&!this.pannerPosition?(this.panner.setPosition(e,t,n),this.pannerPosition=[e,t,n]):"3d"!==this.isPositional||this.isStatic?"mono"===this.isPositional&&(this.panner.set({pan:e}),this.pannerPosition=[e,0,0]):(this.panner.setPosition(e,t,n),this.pannerPosition=[e,t,n])}getPosition(){if(this.isPositional){const e=this.panner;return{x:e.positionX.value,y:e.positionY.value,z:e.positionZ.value}}return{x:this.panner.pan.value,y:0,z:0}}resetPosition(){this.pannerPosition=null}setGain(e,t,n){t=t||0,n=n||0,this.gainSignal.cancelAndHoldAtTime(so()+n),this.gainSignal.rampTo(e*this.initialGain,t,so()+n)}setInitialGain(e){this.initialGain=e}getGain(){return this.gainSignal.value}setSendGain(e,t,n,s){n=n||0,s=s||0;const i=this.sends[e];i&&(i.gain.cancelAndHoldAtTime(so()),i.gain.rampTo(t,n,so()+s))}resetGain(e){e=e||0,this.gainSignal.cancelAndHoldAtTime(so()),this.gainSignal.rampTo(this.initialGain,e,so())}fadeIn(e,t=0,n,s){const i=null==n?1:n,a=s&&s.fadeFromZero||!1;t=s&&s.exactTime||!1?t:so()+t,this.gainSignal.cancelAndHoldAtTime(t),a&&this.gainSignal.setValueAtTime(0,t),this.gainSignal.rampTo(i*this.initialGain,e,t)}fadeOut(e,t=0,n,s=!1){t=s?t:so()+t,this.gainSignal.cancelAndHoldAtTime(t),this.gainSignal.rampTo(0,e,t),ao.schedule((()=>n&&n()),t+e)}triggerModulators(e){const t=so()+(e&&e.when||0),n=e&&void 0!==e.duration?e.duration:.5;this.effects.forEach((e=>{e.modulators&&e.modulators.forEach((e=>{e.play(t,n)}))})),this.modulators.forEach((e=>{e.play(t,n)}))}setParam(e,t,n){this.params.get(e).set(t,n)}setRawParam(e,t,n){this.params.get(e).setRaw(t,n)}dispose(){var e,t;null==(e=this.panner)||e.disconnect(),null==(t=this.panner)||t.dispose(),this.gain.disconnect(),this.gain.dispose(),this.muteGain.disconnect(),this.muteGain.dispose(),this.effects.forEach((e=>{e.disconnect();try{e.dispose()}catch(t){}}))}}class Wo{constructor(e){const{name:t}=e;this.params=new Map,this.name=t,this.settings=e,this.uuid=Ro()}connect(e){this.channel.connect(e)}pause(e={}){console.log("🎵 Instrument pause - Timestamp:",(new Date).toISOString()),this.player&&"function"==typeof this.player.pause&&this.player.pause(e)}resume(e={}){this.player&&"function"==typeof this.player.resume&&this.player.resume(e)}stop(e={}){const{retries:t=0,exactTime:n=!1}=e;let{when:s=0}=e;s=n?s:so()+s,this.channel.getGain()>.1?(this.fadeOut(1,0,(()=>{})),t<5?setTimeout((()=>this.stop({retries:t+1})),1500):this.player.stop(s)):this.player.stop(s)}setGain(e,t=0,n=0){var s;null==(s=this.channel)||s.setGain(e,t,n)}fadeOut(e,t,n,s=!1){0!==this.channel.getGain()&&this.channel.fadeOut(e,t,(()=>{n&&n(this)}),s)}setParam(e,t,n){this.params.get(e).set(t,n)}setRawParam(e,t,n){this.params.get(e).setRaw(t,n)}update(e){Object.keys(e).forEach((t=>{const n=this.params.get(t);n&&n.setRaw(e[t]),this.settings[t]=e[t],"mode"===t&&this.settings.type&&"roundRobin"===this.settings.type&&this.setMode(e.mode)}))}dispose(){this.player.dispose(),this.player.disconnect(),this.channel.dispose()}}class $o extends Wo{constructor(e,t){var n;super(t),this.retrigger=!1,this.isPaused=!1,this.totalPlayed=0,this.playStartTime=0;const{loop:s=!1,loopStart:i,loopEnd:a,metadata:r={}}=t,o=new Or(e);this.retrigger=!s,o.loop=s;const l=new zo(o,t);this.player=o,this.channel=l,this.metadata=r,this.duration=t.duration||(null==(n=this.player.buffer)?void 0:n.duration),i&&(o.loopStart=i),a?this.setLoopEnd(a):t.duration&&t.duration<=o.buffer.duration&&(o.loopEnd=t.duration),this.initParams()}initParams(){const e=this.player;var t;this.params=new Map([Eo(this),(t=this,new So({name:"rate",set:e=>t.player.playbackRate=e,controlSpec:new xo({default:1,min:0,max:3})})),Mo(this),new So({name:"loopStart",set:this.setLoopStart.bind(this)}),new So({name:"loopEnd",set:this.setLoopEnd.bind(this)}),new So({name:"loop",set:this.setLoop.bind(this),controlSpec:xo.BOOLEAN}),new So({name:"reverse",set:t=>e.reverse=t,controlSpec:xo.BOOLEAN}),new So({name:"seek",set:t=>e.seek=t}),new So({name:"sync",set:t=>e.sync=t})].map((e=>[e.name,e])))}play(e={}){const{noReset:t=!0,fadeTime:n=0,gain:s=1,exactTime:i=!1,offset:a=0}=e,{when:r=0}=e,o=i?r:so()+r;try{if(this.isPaused)return void this.resume(e);if("started"!==this.player.state)"stopped"!==this.player.state&&this.player.stop(),!t&&this.channel.resetGain(),this.channel.fadeIn(n,r,s,{fadeFromZero:!0,exactTime:i}),this.player.start(o,a),this.playStartTime=o,this.totalPlayed=0;else if(this.retrigger){const e=.01,t=.001;this.fadeOut(e,r,null,i),this.channel.fadeIn(t,r+e,s,{exactTime:i}),this.player.restart(o+e,a),this.playStartTime=o+e,this.totalPlayed=0}else this.channel.fadeIn(n,r,s,{exactTime:i})}catch(l){window.AE_DEBUG&&console.warn(l)}}pause(e={}){const{fadeTime:t=.1,exactTime:n=!1}=e;let{when:s=0}=e;if("started"===this.player.state&&!this.isPaused){const e=n?s:so()+s;this.totalPlayed+=e-this.playStartTime,this.isPaused=!0,this.player.stop(e+t),this.fadeOut(t,s,(()=>{}),n)}}resume(e={}){const{noReset:t=!0,fadeTime:n=.1,gain:s=1,exactTime:i=!1}=e;let{when:a=0}=e;if(this.isPaused){const e=i?a:so()+a;this.isPaused=!1,!t&&this.channel.resetGain(),this.channel.fadeIn(n,a,s,{fadeFromZero:!0,exactTime:i}),this.player.start(e,this.totalPlayed),this.playStartTime=e}}stop(e={}){this.isPaused=!1,this.playStartTime=0,this.totalPlayed=0,super.stop(e)}setLoopStart(e){e<=this.player.buffer.duration&&(this.settings.loopStart=e,this.player.loopStart=e)}setLoopEnd(e){e<=this.player.buffer.duration&&(this.settings.loopEnd=e,this.player.loopEnd=e)}setLoop(e){this.settings.loop=e,this.player.loop=e}getState(){return this.isPaused?"paused":this.player.state}getDuration(){return this.duration}getPausePosition(){return this.totalPlayed}isPausedState(){return this.isPaused}}class Yo{constructor(e=!1){this.eventMap={},this.eventsSuspended=1==e}addListener(e,t,n={}){if("string"==typeof e&&e.length<1||e instanceof String&&e.length<1||"string"!=typeof e&&!(e instanceof String)&&e!==Yo.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if("function"!=typeof t)throw new TypeError("The callback must be a function.");const s=new Qo(e,this,t,n);return this.eventMap[e]||(this.eventMap[e]=[]),n.prepend?this.eventMap[e].unshift(s):this.eventMap[e].push(s),s}addOneTimeListener(e,t,n={}){n.remaining=1,this.addListener(e,t,n)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,t){if(void 0===e)return!!(this.eventMap[Yo.ANY_EVENT]&&this.eventMap[Yo.ANY_EVENT].length>0)||Object.entries(this.eventMap).some((([,e])=>e.length>0));if(this.eventMap[e]&&this.eventMap[e].length>0){if(t instanceof Qo){return this.eventMap[e].filter((e=>e===t)).length>0}if("function"==typeof t){return this.eventMap[e].filter((e=>e.callback===t)).length>0}return null==t}return!1}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach((e=>{e.suspended=!0}))}unsuspendEvent(e){this.getListeners(e).forEach((e=>{e.suspended=!1}))}getListenerCount(e){return this.getListeners(e).length}emit(e,...t){if("string"!=typeof e&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let n=[],s=this.eventMap[Yo.ANY_EVENT]||[];return this.eventMap[e]&&(s=s.concat(this.eventMap[e])),s.forEach((e=>{if(e.suspended)return;let s=[...t];Array.isArray(e.arguments)&&(s=s.concat(e.arguments)),e.remaining>0&&(n.push(e.callback.apply(e.context,s)),e.count++),--e.remaining<1&&e.remove()})),n}removeListener(e,t,n={}){if(void 0===e)return void(this.eventMap={});if(!this.eventMap[e])return;let s=this.eventMap[e].filter((e=>t&&e.callback!==t||n.remaining&&n.remaining!==e.remaining||n.context&&n.context!==e.context));s.length?this.eventMap[e]=s:delete this.eventMap[e]}waitFor(e){return __async(this,arguments,(function*(e,t={}){return t.duration=parseInt(t.duration),(isNaN(t.duration)||t.duration<=0)&&(t.duration=1/0),new Promise(((n,s)=>{let i,a=this.addListener(e,(()=>{clearTimeout(i),n()}),{remaining:1});t.duration!==1/0&&(i=setTimeout((()=>{a.remove(),s("The duration expired before the event was emitted.")}),t.duration))}))}))}get eventCount(){return Object.keys(this.eventMap).length}}class Qo{constructor(e,t,n,s={}){if("string"!=typeof e&&!(e instanceof String)&&e!==Yo.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!t)throw new ReferenceError("The 'target' parameter is mandatory.");if("function"!=typeof n)throw new TypeError("The 'callback' must be a function.");void 0===s.arguments||Array.isArray(s.arguments)||(s.arguments=[s.arguments]),(s=Object.assign({context:t,remaining:1/0,arguments:void 0,duration:1/0},s)).duration!==1/0&&setTimeout((()=>this.remove()),s.duration),this.arguments=s.arguments,this.callback=n,this.context=s.context,this.count=0,this.event=e,this.remaining=parseInt(s.remaining)>=1?parseInt(s.remaining):1/0,this.suspended=!1,this.target=t}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}
/**
   * The `Enumerations` class contains enumerations and arrays of elements used throughout the
   * library. All its properties are static and should be referenced using the class name. For
   * example: `Enumerations.CHANNEL_MESSAGES`.
   *
   * @license Apache-2.0
   * @since 3.0.0
   */class Xo{static get MIDI_CHANNEL_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MESSAGES enum instead."),Xo.CHANNEL_MESSAGES}static get CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_NUMBERS(){return this.validation&&console.warn("The MIDI_CHANNEL_NUMBERS array has been deprecated. Use the Enumerations.CHANNEL_NUMBERS array instead."),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MODE_MESSAGES enum instead."),Xo.CHANNEL_MODE_MESSAGES}static get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been deprecated. Use the Enumerations.CONTROL_CHANGE_MESSAGES array instead."),{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get CONTROL_CHANGE_MESSAGES(){return[{number:0,name:"bankselectcoarse",description:"Bank Select (Coarse)",position:"msb"},{number:1,name:"modulationwheelcoarse",description:"Modulation Wheel (Coarse)",position:"msb"},{number:2,name:"breathcontrollercoarse",description:"Breath Controller (Coarse)",position:"msb"},{number:3,name:"controller3",description:"Undefined",position:"msb"},{number:4,name:"footcontrollercoarse",description:"Foot Controller (Coarse)",position:"msb"},{number:5,name:"portamentotimecoarse",description:"Portamento Time (Coarse)",position:"msb"},{number:6,name:"dataentrycoarse",description:"Data Entry (Coarse)",position:"msb"},{number:7,name:"volumecoarse",description:"Channel Volume (Coarse)",position:"msb"},{number:8,name:"balancecoarse",description:"Balance (Coarse)",position:"msb"},{number:9,name:"controller9",description:"Controller 9 (Coarse)",position:"msb"},{number:10,name:"pancoarse",description:"Pan (Coarse)",position:"msb"},{number:11,name:"expressioncoarse",description:"Expression Controller (Coarse)",position:"msb"},{number:12,name:"effectcontrol1coarse",description:"Effect Control 1 (Coarse)",position:"msb"},{number:13,name:"effectcontrol2coarse",description:"Effect Control 2 (Coarse)",position:"msb"},{number:14,name:"controller14",description:"Undefined",position:"msb"},{number:15,name:"controller15",description:"Undefined",position:"msb"},{number:16,name:"generalpurposecontroller1",description:"General Purpose Controller 1 (Coarse)",position:"msb"},{number:17,name:"generalpurposecontroller2",description:"General Purpose Controller 2 (Coarse)",position:"msb"},{number:18,name:"generalpurposecontroller3",description:"General Purpose Controller 3 (Coarse)",position:"msb"},{number:19,name:"generalpurposecontroller4",description:"General Purpose Controller 4 (Coarse)",position:"msb"},{number:20,name:"controller20",description:"Undefined",position:"msb"},{number:21,name:"controller21",description:"Undefined",position:"msb"},{number:22,name:"controller22",description:"Undefined",position:"msb"},{number:23,name:"controller23",description:"Undefined",position:"msb"},{number:24,name:"controller24",description:"Undefined",position:"msb"},{number:25,name:"controller25",description:"Undefined",position:"msb"},{number:26,name:"controller26",description:"Undefined",position:"msb"},{number:27,name:"controller27",description:"Undefined",position:"msb"},{number:28,name:"controller28",description:"Undefined",position:"msb"},{number:29,name:"controller29",description:"Undefined",position:"msb"},{number:30,name:"controller30",description:"Undefined",position:"msb"},{number:31,name:"controller31",description:"Undefined",position:"msb"},{number:32,name:"bankselectfine",description:"Bank Select (Fine)",position:"lsb"},{number:33,name:"modulationwheelfine",description:"Modulation Wheel (Fine)",position:"lsb"},{number:34,name:"breathcontrollerfine",description:"Breath Controller (Fine)",position:"lsb"},{number:35,name:"controller35",description:"Undefined",position:"lsb"},{number:36,name:"footcontrollerfine",description:"Foot Controller (Fine)",position:"lsb"},{number:37,name:"portamentotimefine",description:"Portamento Time (Fine)",position:"lsb"},{number:38,name:"dataentryfine",description:"Data Entry (Fine)",position:"lsb"},{number:39,name:"channelvolumefine",description:"Channel Volume (Fine)",position:"lsb"},{number:40,name:"balancefine",description:"Balance (Fine)",position:"lsb"},{number:41,name:"controller41",description:"Undefined",position:"lsb"},{number:42,name:"panfine",description:"Pan (Fine)",position:"lsb"},{number:43,name:"expressionfine",description:"Expression Controller (Fine)",position:"lsb"},{number:44,name:"effectcontrol1fine",description:"Effect control 1 (Fine)",position:"lsb"},{number:45,name:"effectcontrol2fine",description:"Effect control 2 (Fine)",position:"lsb"},{number:46,name:"controller46",description:"Undefined",position:"lsb"},{number:47,name:"controller47",description:"Undefined",position:"lsb"},{number:48,name:"controller48",description:"General Purpose Controller 1 (Fine)",position:"lsb"},{number:49,name:"controller49",description:"General Purpose Controller 2 (Fine)",position:"lsb"},{number:50,name:"controller50",description:"General Purpose Controller 3 (Fine)",position:"lsb"},{number:51,name:"controller51",description:"General Purpose Controller 4 (Fine)",position:"lsb"},{number:52,name:"controller52",description:"Undefined",position:"lsb"},{number:53,name:"controller53",description:"Undefined",position:"lsb"},{number:54,name:"controller54",description:"Undefined",position:"lsb"},{number:55,name:"controller55",description:"Undefined",position:"lsb"},{number:56,name:"controller56",description:"Undefined",position:"lsb"},{number:57,name:"controller57",description:"Undefined",position:"lsb"},{number:58,name:"controller58",description:"Undefined",position:"lsb"},{number:59,name:"controller59",description:"Undefined",position:"lsb"},{number:60,name:"controller60",description:"Undefined",position:"lsb"},{number:61,name:"controller61",description:"Undefined",position:"lsb"},{number:62,name:"controller62",description:"Undefined",position:"lsb"},{number:63,name:"controller63",description:"Undefined",position:"lsb"},{number:64,name:"damperpedal",description:"Damper Pedal On/Off"},{number:65,name:"portamento",description:"Portamento On/Off"},{number:66,name:"sostenuto",description:"Sostenuto On/Off"},{number:67,name:"softpedal",description:"Soft Pedal On/Off"},{number:68,name:"legatopedal",description:"Legato Pedal On/Off"},{number:69,name:"hold2",description:"Hold 2 On/Off"},{number:70,name:"soundvariation",description:"Sound Variation",position:"lsb"},{number:71,name:"resonance",description:"Resonance",position:"lsb"},{number:72,name:"releasetime",description:"Release Time",position:"lsb"},{number:73,name:"attacktime",description:"Attack Time",position:"lsb"},{number:74,name:"brightness",description:"Brightness",position:"lsb"},{number:75,name:"decaytime",description:"Decay Time",position:"lsb"},{number:76,name:"vibratorate",description:"Vibrato Rate",position:"lsb"},{number:77,name:"vibratodepth",description:"Vibrato Depth",position:"lsb"},{number:78,name:"vibratodelay",description:"Vibrato Delay",position:"lsb"},{number:79,name:"controller79",description:"Undefined",position:"lsb"},{number:80,name:"generalpurposecontroller5",description:"General Purpose Controller 5",position:"lsb"},{number:81,name:"generalpurposecontroller6",description:"General Purpose Controller 6",position:"lsb"},{number:82,name:"generalpurposecontroller7",description:"General Purpose Controller 7",position:"lsb"},{number:83,name:"generalpurposecontroller8",description:"General Purpose Controller 8",position:"lsb"},{number:84,name:"portamentocontrol",description:"Portamento Control",position:"lsb"},{number:85,name:"controller85",description:"Undefined"},{number:86,name:"controller86",description:"Undefined"},{number:87,name:"controller87",description:"Undefined"},{number:88,name:"highresolutionvelocityprefix",description:"High Resolution Velocity Prefix",position:"lsb"},{number:89,name:"controller89",description:"Undefined"},{number:90,name:"controller90",description:"Undefined"},{number:91,name:"effect1depth",description:"Effects 1 Depth (Reverb Send Level)"},{number:92,name:"effect2depth",description:"Effects 2 Depth"},{number:93,name:"effect3depth",description:"Effects 3 Depth (Chorus Send Level)"},{number:94,name:"effect4depth",description:"Effects 4 Depth"},{number:95,name:"effect5depth",description:"Effects 5 Depth"},{number:96,name:"dataincrement",description:"Data Increment"},{number:97,name:"datadecrement",description:"Data Decrement"},{number:98,name:"nonregisteredparameterfine",description:"Non-Registered Parameter Number (Fine)",position:"lsb"},{number:99,name:"nonregisteredparametercoarse",description:"Non-Registered Parameter Number (Coarse)",position:"msb"},{number:100,name:"registeredparameterfine",description:"Registered Parameter Number (Fine)",position:"lsb"},{number:101,name:"registeredparametercoarse",description:"Registered Parameter Number (Coarse)",position:"msb"},{number:102,name:"controller102",description:"Undefined"},{number:103,name:"controller103",description:"Undefined"},{number:104,name:"controller104",description:"Undefined"},{number:105,name:"controller105",description:"Undefined"},{number:106,name:"controller106",description:"Undefined"},{number:107,name:"controller107",description:"Undefined"},{number:108,name:"controller108",description:"Undefined"},{number:109,name:"controller109",description:"Undefined"},{number:110,name:"controller110",description:"Undefined"},{number:111,name:"controller111",description:"Undefined"},{number:112,name:"controller112",description:"Undefined"},{number:113,name:"controller113",description:"Undefined"},{number:114,name:"controller114",description:"Undefined"},{number:115,name:"controller115",description:"Undefined"},{number:116,name:"controller116",description:"Undefined"},{number:117,name:"controller117",description:"Undefined"},{number:118,name:"controller118",description:"Undefined"},{number:119,name:"controller119",description:"Undefined"},{number:120,name:"allsoundoff",description:"All Sound Off"},{number:121,name:"resetallcontrollers",description:"Reset All Controllers"},{number:122,name:"localcontrol",description:"Local Control On/Off"},{number:123,name:"allnotesoff",description:"All Notes Off"},{number:124,name:"omnimodeoff",description:"Omni Mode Off"},{number:125,name:"omnimodeon",description:"Omni Mode On"},{number:126,name:"monomodeon",description:"Mono Mode On"},{number:127,name:"polymodeon",description:"Poly Mode On"}]}static get REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_REGISTERED_PARAMETERS(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETERS enum has been deprecated. Use the Enumerations.REGISTERED_PARAMETERS enum instead."),Xo.MIDI_REGISTERED_PARAMETERS}static get SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been deprecated. Use the Enumerations.SYSTEM_MESSAGES enum instead."),Xo.SYSTEM_MESSAGES}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-dataincrement","nrpn-datadecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-dataincrement","rpn-datadecrement","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn-databuttonincrement","rpn-databuttondecrement"]}}
/**
   * The `Note` class represents a single musical note such as `"D3"`, `"G#4"`, `"F-1"`, `"Gb7"`, etc.
   *
   * `Note` objects can be played back on a single channel by calling
   * [`OutputChannel.playNote()`]{@link OutputChannel#playNote} or, on multiple channels of the same
   * output, by calling [`Output.playNote()`]{@link Output#playNote}.
   *
   * The note has [`attack`](#attack) and [`release`](#release) velocities set at `0.5` by default.
   * These can be changed by passing in the appropriate option. It is also possible to set a
   * system-wide default for attack and release velocities by using the
   * [`WebMidi.defaults`](WebMidi#defaults) property.
   *
   * If you prefer to work with raw MIDI values (`0` to `127`), you can use [`rawAttack`](#rawAttack) and
   * [`rawRelease`](#rawRelease) to both get and set the values.
   *
   * The note may have a [`duration`](#duration). If it does, playback will be automatically stopped
   * when the duration has elapsed by sending a `"noteoff"` event. By default, the duration is set to
   * `Infinity`. In this case, it will never stop playing unless explicitly stopped by calling a
   * method such as [`OutputChannel.stopNote()`]{@link OutputChannel#stopNote},
   * [`Output.stopNote()`]{@link Output#stopNote} or similar.
   *
   * @license Apache-2.0
   * @since 3.0.0
   */class Zo{constructor(e,t={}){this.duration=al.defaults.note.duration,this.attack=al.defaults.note.attack,this.release=al.defaults.note.release,null!=t.duration&&(this.duration=t.duration),null!=t.attack&&(this.attack=t.attack),null!=t.rawAttack&&(this.attack=Ko.from7bitToFloat(t.rawAttack)),null!=t.release&&(this.release=t.release),null!=t.rawRelease&&(this.release=Ko.from7bitToFloat(t.rawRelease)),Number.isInteger(e)?this.identifier=Ko.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const t=Ko.getNoteDetails(e);if(al.validation&&!e)throw new Error("Invalid note identifier");this._name=t.name,this._accidental=t.accidental,this._octave=t.octave}get name(){return this._name}set name(e){if(al.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(al.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(al.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(al.validation&&(e=parseFloat(e),isNaN(e)||null===e||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(al.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(al.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return Ko.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=Ko.from7bitToFloat(e)}get rawRelease(){return Ko.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=Ko.from7bitToFloat(e)}get number(){return Ko.toNoteNumber(this.identifier)}getOffsetNumber(e=0,t=0){return al.validation&&(e=parseInt(e)||0,t=parseInt(t)||0),Math.min(Math.max(this.number+12*e+t,0),127)}}
/**
   * The `Utilities` class contains general-purpose utility methods. All methods are static and
   * should be called using the class name. For example: `Utilities.getNoteDetails("C4")`.
   *
   * @license Apache-2.0
   * @since 3.0.0
   */class Ko{static toNoteNumber(e,t=0){if(t=null==t?0:parseInt(t),isNaN(t))throw new RangeError("Invalid 'octaveOffset' value");"string"!=typeof e&&(e="");const n=this.getNoteDetails(e);if(!n)throw new TypeError("Invalid note identifier");let s=12*(n.octave+1+t);if(s+={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[n.name],n.accidental&&(n.accidental.startsWith("b")?s-=n.accidental.length:s+=n.accidental.length),s<0||s>127)throw new RangeError("Invalid octaveOffset value");return s}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const t=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!t)throw new TypeError("Invalid note identifier");const n=t[1].toUpperCase(),s=parseInt(t[3]);let i=t[2].toLowerCase();i=""===i?void 0:i;return{accidental:i,identifier:n+(i||"")+s,name:n,octave:s}}static sanitizeChannels(e){let t;if(al.validation)if("all"===e)t=["all"];else if("none"===e)return[];return t=Array.isArray(e)?e:[e],t.indexOf("all")>-1&&(t=Xo.MIDI_CHANNEL_NUMBERS),t.map((function(e){return parseInt(e)})).filter((function(e){return e>=1&&e<=16}))}static toTimestamp(e){let t=!1;const n=parseFloat(e);return!isNaN(n)&&("string"==typeof e&&"+"===e.substring(0,1)?n>=0&&(t=al.time+n):n>=0&&(t=n),t)}static guessNoteNumber(e,t){t=parseInt(t)||0;let n=!1;if(Number.isInteger(e)&&e>=0&&e<=127)n=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)n=parseInt(e);else if("string"==typeof e||e instanceof String)try{n=this.toNoteNumber(e.trim(),t)}catch(s){return!1}return n}static toNoteIdentifier(e,t){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(t=null==t?0:parseInt(t),isNaN(t))throw new RangeError("Invalid octaveOffset value");const n=Math.floor(e/12-1)+t;return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]+n.toString()}static buildNote(e,t={}){if(t.octaveOffset=parseInt(t.octaveOffset)||0,e instanceof Zo)return e;let n=this.guessNoteNumber(e,t.octaveOffset);if(!1===n)throw new TypeError(`The input could not be parsed as a note (${e})`);return t.octaveOffset=void 0,new Zo(n,t)}static buildNoteArray(e,t={}){let n=[];return Array.isArray(e)||(e=[e]),e.forEach((e=>{n.push(this.buildNote(e,t))})),n}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(127*e),0),127)}static fromMsbLsbToFloat(e,t=0){al.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),t=Math.min(Math.max(parseInt(t)||0,0),127));const n=((e<<7)+t)/16383;return Math.min(Math.max(n,0),1)}static fromFloatToMsbLsb(e){al.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const t=Math.round(16383*e);return{msb:t>>7,lsb:127&t}}static offsetNumber(e,t=0,n=0){if(al.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");t=parseInt(t)||0,n=parseInt(n)||0}return Math.min(Math.max(e+12*t+n,0),127)}static getPropertyByValue(e,t){return Object.keys(e).find((n=>e[n]===t))}static getCcNameByNumber(e){if(!al.validation||(e=parseInt(e))>=0&&e<=127)return Xo.CONTROL_CHANGE_MESSAGES[e].name}static getCcNumberByName(e){let t=Xo.CONTROL_CHANGE_MESSAGES.find((t=>t.name===e));return t?t.number:Xo.MIDI_CONTROL_CHANGE_MESSAGES[e]}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let t in Xo.CHANNEL_MODE_MESSAGES)if(Xo.CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===Xo.CHANNEL_MODE_MESSAGES[t])return t;return!1}static get isNode(){return"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}static get isBrowser(){return"undefined"!=typeof window&&void 0!==window.document}}
/**
   * The `OutputChannel` class represents a single output MIDI channel. `OutputChannel` objects are
   * provided by an [`Output`](Output) port which, itself, is made available by a device. The
   * `OutputChannel` object is derived from the host's MIDI subsystem and should not be instantiated
   * directly.
   *
   * All 16 `OutputChannel` objects can be found inside the parent output's
   * [`channels`]{@link Output#channels} property.
   *
   * @param {Output} output The [`Output`](Output) this channel belongs to.
   * @param {number} number The MIDI channel number (`1` - `16`).
   *
   * @extends EventEmitter
   * @license Apache-2.0
   * @since 3.0.0
   */class Jo extends Yo{constructor(e,t){super(),this._output=e,this._number=t,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,t={time:0}){return this.output.send(e,t),this}sendKeyAftertouch(e,t,n={}){if(al.validation){if(n.useRawValue&&(n.rawValue=n.useRawValue),isNaN(parseFloat(t)))throw new RangeError("Invalid key aftertouch value.");if(n.rawValue){if(!(t>=0&&t<=127&&Number.isInteger(t)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(t>=0&&t<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}n.rawValue||(t=Ko.fromFloatTo7Bit(t));const s=al.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),Ko.buildNoteArray(e).forEach((e=>{this.send([(Xo.CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),e.getOffsetNumber(s),t],{time:Ko.toTimestamp(n.time)})})),this}sendControlChange(e,t,n={}){if("string"==typeof e&&(e=Ko.getCcNumberByName(e)),Array.isArray(t)||(t=[t]),al.validation){if(void 0===e)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(2===(t=t.map((e=>{const t=Math.min(Math.max(parseInt(e),0),127);if(isNaN(t))throw new TypeError("Values must be integers between 0 and 127");return t}))).length&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return t.forEach(((s,i)=>{this.send([(Xo.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+32*i,t[i]],{time:Ko.toTimestamp(n.time)})})),this}_selectNonRegisteredParameter(e,t={}){return this.sendControlChange(99,e[0],t),this.sendControlChange(98,e[1],t),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,t={}){return this.sendControlChange(101,e[0],t),this.sendControlChange(100,e[1],t),this}_setCurrentParameter(e,t={}){return e=[].concat(e),this.sendControlChange(6,e[0],t),e.length<2||this.sendControlChange(38,e[1],t),this}sendRpnDecrement(e,t={}){if(Array.isArray(e)||(e=Xo.REGISTERED_PARAMETERS[e]),al.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(Xo.REGISTERED_PARAMETERS).forEach((n=>{Xo.REGISTERED_PARAMETERS[n][0]===e[0]&&Xo.REGISTERED_PARAMETERS[n][1]===e[1]&&(t=!0)})),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(97,0,t),this._deselectRegisteredParameter(t),this}sendRpnIncrement(e,t={}){if(Array.isArray(e)||(e=Xo.REGISTERED_PARAMETERS[e]),al.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(Xo.REGISTERED_PARAMETERS).forEach((n=>{Xo.REGISTERED_PARAMETERS[n][0]===e[0]&&Xo.REGISTERED_PARAMETERS[n][1]===e[1]&&(t=!0)})),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(96,0,t),this._deselectRegisteredParameter(t),this}playNote(e,t={}){this.sendNoteOn(e,t);const n=Array.isArray(e)?e:[e];for(let s of n)if(parseInt(s.duration)>0){const e={time:(Ko.toTimestamp(t.time)||al.time)+parseInt(s.duration),release:s.release,rawRelease:s.rawRelease};this.sendNoteOff(s,e)}else if(parseInt(t.duration)>0){const e={time:(Ko.toTimestamp(t.time)||al.time)+parseInt(t.duration),release:t.release,rawRelease:t.rawRelease};this.sendNoteOff(s,e)}return this}sendNoteOff(e,t={}){if(al.validation){if(null!=t.rawRelease&&!(t.rawRelease>=0&&t.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(null!=t.release&&!(t.release>=0&&t.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");t.rawVelocity&&(t.rawRelease=t.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),t.velocity&&(t.release=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let n=64;null!=t.rawRelease?n=t.rawRelease:isNaN(t.release)||(n=Math.round(127*t.release));const s=al.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Ko.buildNoteArray(e,{rawRelease:parseInt(n)}).forEach((e=>{this.send([(Xo.CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),e.getOffsetNumber(s),e.rawRelease],{time:Ko.toTimestamp(t.time)})})),this}stopNote(e,t={}){return this.sendNoteOff(e,t)}sendNoteOn(e,t={}){if(al.validation){if(null!=t.rawAttack&&!(t.rawAttack>=0&&t.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(null!=t.attack&&!(t.attack>=0&&t.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");t.rawVelocity&&(t.rawAttack=t.velocity,t.rawRelease=t.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),t.velocity&&(t.attack=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let n=64;null!=t.rawAttack?n=t.rawAttack:isNaN(t.attack)||(n=Math.round(127*t.attack));const s=al.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Ko.buildNoteArray(e,{rawAttack:n}).forEach((e=>{this.send([(Xo.CHANNEL_MESSAGES.noteon<<4)+(this.number-1),e.getOffsetNumber(s),e.rawAttack],{time:Ko.toTimestamp(t.time)})})),this}sendChannelMode(e,t=0,n={}){if("string"==typeof e&&(e=Xo.CHANNEL_MODE_MESSAGES[e]),al.validation){if(void 0===e)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(t))||t<0||t>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(Xo.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,t],{time:Ko.toTimestamp(n.time)}),this}sendOmniMode(e,t={}){return void 0===e||e?this.sendChannelMode("omnimodeon",0,t):this.sendChannelMode("omnimodeoff",0,t),this}sendChannelAftertouch(e,t={}){if(al.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(t.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return t.rawValue||(e=Ko.fromFloatTo7Bit(e)),this.send([(Xo.CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(e)],{time:Ko.toTimestamp(t.time)}),this}sendMasterTuning(e,t={}){if(e=parseFloat(e)||0,al.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let n=Math.floor(e)+64,s=e-Math.floor(e);s=Math.round((s+1)/2*16383);let i=s>>7&127,a=127&s;return this.sendRpnValue("channelcoarsetuning",n,t),this.sendRpnValue("channelfinetuning",[i,a],t),this}sendModulationRange(e,t,n={}){if(al.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!(null==t||Number.isInteger(t)&&t>=0&&t<=127))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return t>=0&&t<=127||(t=0),this.sendRpnValue("modulationrange",[e,t],n),this}sendNrpnValue(e,t,n={}){if(t=[].concat(t),al.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");t.forEach((e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")}))}return this._selectNonRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectNonRegisteredParameter(n),this}sendPitchBend(e,t={}){if(al.validation)if(t.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(t.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||null===e)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend value must be a float between -1 and 1.")}let n=0,s=0;if(t.rawValue&&Array.isArray(e))n=e[0],s=e[1];else if(t.rawValue&&!Array.isArray(e))n=e;else{const t=Ko.fromFloatToMsbLsb((e+1)/2);n=t.msb,s=t.lsb}return this.send([(Xo.CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),s,n],{time:Ko.toTimestamp(t.time)}),this}sendPitchBendRange(e,t,n={}){if(al.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(t)||!(t>=0&&t<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,t],n),this}sendProgramChange(e,t={}){if(e=parseInt(e)||0,al.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(Xo.CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:Ko.toTimestamp(t.time)}),this}sendRpnValue(e,t,n={}){if(Array.isArray(e)||(e=Xo.REGISTERED_PARAMETERS[e]),al.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(t).forEach((e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")}))}return this._selectRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectRegisteredParameter(n),this}sendTuningBank(e,t={}){if(al.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,t),this}sendTuningProgram(e,t={}){if(al.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,t),this}sendLocalControl(e,t={}){return e?this.sendChannelMode("localcontrol",127,t):this.sendChannelMode("localcontrol",0,t)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,t={}){return"mono"===e?this.sendChannelMode("monomodeon",0,t):this.sendChannelMode("polymodeon",0,t)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}
/**
   * The `Output` class represents a single MIDI output port (not to be confused with a MIDI channel).
   * A port is made available by a MIDI device. A MIDI device can advertise several input and output
   * ports. Each port has 16 MIDI channels which can be accessed via the [`channels`](#channels)
   * property.
   *
   * The `Output` object is automatically instantiated by the library according to the host's MIDI
   * subsystem and should not be directly instantiated.
   *
   * You can access all available `Output` objects by referring to the
   * [`WebMidi.outputs`](WebMidi#outputs) array or by using methods such as
   * [`WebMidi.getOutputByName()`](WebMidi#getOutputByName) or
   * [`WebMidi.getOutputById()`](WebMidi#getOutputById).
   *
   * @fires Output#opened
   * @fires Output#disconnected
   * @fires Output#closed
   *
   * @extends EventEmitter
   * @license Apache-2.0
   */class el extends Yo{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let t=1;t<=16;t++)this.channels[t]=new Jo(this,t);this._midiOutput.onstatechange=this._onStateChange.bind(this)}destroy(){return __async(this,null,(function*(){this.removeListener(),this.channels.forEach((e=>e.destroy())),this.channels=[],this._midiOutput&&(this._midiOutput.onstatechange=null),yield this.close(),this._midiOutput=null}))}_onStateChange(e){let t={timestamp:al.time};"open"===e.port.connection?(t.type="opened",t.target=this,t.port=t.target,this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",t.target=this,t.port=t.target,this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}open(){return __async(this,null,(function*(){try{return yield this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}))}close(){return __async(this,null,(function*(){this._midiOutput?yield this._midiOutput.close():yield Promise.resolve()}))}send(e,t={time:0},n=0){if(e instanceof sl&&(e=Ko.isNode?e.data:e.rawData),e instanceof Uint8Array&&Ko.isNode&&(e=Array.from(e)),al.validation){if(Array.isArray(e)||e instanceof Uint8Array||(e=[e],Array.isArray(t)&&(e=e.concat(t)),t=isNaN(n)?{time:0}:{time:n}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach((e=>{if(!((e=parseInt(e))>=0&&e<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")})),t||(t={time:0})}return this._midiOutput.send(e,Ko.toTimestamp(t.time)),this}sendSysex(e,t=[],n={}){if(e=[].concat(e),t instanceof Uint8Array){const s=new Uint8Array(1+e.length+t.length+1);s[0]=Xo.SYSTEM_MESSAGES.sysex,s.set(Uint8Array.from(e),1),s.set(t,1+e.length),s[s.length-1]=Xo.SYSTEM_MESSAGES.sysexend,this.send(s,{time:n.time})}else{const s=e.concat(t,Xo.SYSTEM_MESSAGES.sysexend);this.send([Xo.SYSTEM_MESSAGES.sysex].concat(s),{time:n.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():al.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,t={}){if(al.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([Xo.SYSTEM_MESSAGES.timecode,e],{time:t.time}),this}sendSongPosition(e=0,t={}){var n=(e=Math.floor(e)||0)>>7&127,s=127&e;return this.send([Xo.SYSTEM_MESSAGES.songposition,n,s],{time:t.time}),this}sendSongSelect(e=0,t={}){if(al.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([Xo.SYSTEM_MESSAGES.songselect,e],{time:t.time}),this}sendTuneRequest(e={}){return this.send([Xo.SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([Xo.SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([Xo.SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([Xo.SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([Xo.SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([Xo.SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([Xo.SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return al.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,t,n={}){return null==n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(n.channels).forEach((s=>{this.channels[s].sendKeyAftertouch(e,t,n)})),this}sendControlChange(e,t,n={},s={}){if(al.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){const e=n;(n=s).channels=e,"all"===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(n.channels).forEach((s=>{this.channels[s].sendControlChange(e,t,n)})),this}sendPitchBendRange(e=0,t=0,n={}){return null==n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(n.channels).forEach((s=>{this.channels[s].sendPitchBendRange(e,t,n)})),this}setPitchBendRange(e=0,t=0,n="all",s={}){return al.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),s.channels=n,"all"===s.channels&&(s.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,t,s)}sendRpnValue(e,t,n={}){return null==n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(n.channels).forEach((s=>{this.channels[s].sendRpnValue(e,t,n)})),this}setRegisteredParameter(e,t=[],n="all",s={}){return al.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),s.channels=n,"all"===s.channels&&(s.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,t,s)}sendChannelAftertouch(e,t={},n={}){if(al.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendChannelAftertouch(e,t)})),this}sendPitchBend(e,t={},n={}){if(al.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendPitchBend(e,t)})),this}sendProgramChange(e=0,t={},n={}){if(al.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendProgramChange(e,t)})),this}sendModulationRange(e,t,n={}){return null==n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(n.channels).forEach((s=>{this.channels[s].sendModulationRange(e,t,n)})),this}setModulationRange(e=0,t=0,n="all",s={}){return al.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),s.channels=n,"all"===s.channels&&(s.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,t,s)}sendMasterTuning(e,t={}){return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendMasterTuning(e,t)})),this}setMasterTuning(e,t={},n={}){return al.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),n.channels=t,"all"===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,n)}sendTuningProgram(e,t={}){return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendTuningProgram(e,t)})),this}setTuningProgram(e,t="all",n={}){return al.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),n.channels=t,"all"===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,n)}sendTuningBank(e=0,t={}){return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendTuningBank(e,t)})),this}setTuningBank(e,t="all",n={}){return al.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),n.channels=t,"all"===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,n)}sendChannelMode(e,t=0,n={},s={}){if(al.validation&&(Array.isArray(n)||Number.isInteger(n)||"all"===n)){const e=n;(n=s).channels=e,"all"===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(n.channels).forEach((s=>{this.channels[s].sendChannelMode(e,t,n)})),this}sendAllSoundOff(e={}){return null==e.channels&&(e.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendAllSoundOff(e)})),this}sendAllNotesOff(e={}){return null==e.channels&&(e.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendAllNotesOff(e)})),this}sendResetAllControllers(e={},t={}){if(al.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){const n=e;(e=t).channels=n,"all"===e.channels&&(e.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==e.channels&&(e.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendResetAllControllers(e)})),this}sendPolyphonicMode(e,t={},n={}){if(al.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendPolyphonicMode(e,t)})),this}sendLocalControl(e,t={},n={}){if(al.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendLocalControl(e,t)})),this}sendOmniMode(e,t={},n={}){if(al.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendOmniMode(e,t)})),this}sendNrpnValue(e,t,n={}){return null==n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(n.channels).forEach((s=>{this.channels[s].sendNrpnValue(e,t,n)})),this}setNonRegisteredParameter(e,t=[],n="all",s={}){return al.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),s.channels=n,"all"===s.channels&&(s.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,t,s)}sendRpnIncrement(e,t={}){return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendRpnIncrement(e,t)})),this}incrementRegisteredParameter(e,t="all",n={}){return al.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),n.channels=t,"all"===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,n)}sendRpnDecrement(e,t={}){return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendRpnDecrement(e,t)})),this}decrementRegisteredParameter(e,t="all",n={}){return al.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),n.channels=t,"all"===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,n)}sendNoteOff(e,t={},n={}){if(al.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendNoteOff(e,t)})),this}stopNote(e,t){return this.sendNoteOff(e,t)}playNote(e,t={},n={}){if(al.validation&&(t.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),t.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].playNote(e,t)})),this}sendNoteOn(e,t={},n={}){if(al.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=n).channels=e,"all"===t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendNoteOn(e,t)})),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}
/**
   * The `Forwarder` class allows the forwarding of MIDI messages to predetermined outputs. When you
   * call its [`forward()`](#forward) method, it will send the specified [`Message`](Message) object
   * to all the outputs listed in its [`destinations`](#destinations) property.
   *
   * If specific channels or message types have been defined in the [`channels`](#channels) or
   * [`types`](#types) properties, only messages matching the channels/types will be forwarded.
   *
   * While it can be manually instantiated, you are more likely to come across a `Forwarder` object as
   * the return value of the [`Input.addForwarder()`](Input#addForwarder) method.
   *
   * @license Apache-2.0
   * @since 3.0.0
   */class tl{constructor(e=[],t={}){this.destinations=[],this.types=[...Object.keys(Xo.SYSTEM_MESSAGES),...Object.keys(Xo.CHANNEL_MESSAGES)],this.channels=Xo.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),t.types&&!Array.isArray(t.types)&&(t.types=[t.types]),t.channels&&!Array.isArray(t.channels)&&(t.channels=[t.channels]),al.validation&&(e.forEach((e=>{if(!(e instanceof el))throw new TypeError("Destinations must be of type 'Output'.")})),void 0!==t.types&&t.types.forEach((e=>{if(!Xo.SYSTEM_MESSAGES.hasOwnProperty(e)&&!Xo.CHANNEL_MESSAGES.hasOwnProperty(e))throw new TypeError("Type must be a valid message type.")})),void 0!==t.channels&&t.channels.forEach((e=>{if(!Xo.MIDI_CHANNEL_NUMBERS.includes(e))throw new TypeError("MIDI channel must be between 1 and 16.")}))),this.destinations=e,t.types&&(this.types=t.types),t.channels&&(this.channels=t.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach((t=>{(!al.validation||t instanceof el)&&t.send(e)})))}}
/**
   * The `InputChannel` class represents a single MIDI input channel (1-16) from a single input
   * device. This object is derived from the host's MIDI subsystem and should not be instantiated
   * directly.
   *
   * All 16 `InputChannel` objects can be found inside the input's [`channels`](Input#channels)
   * property.
   *
   * @fires InputChannel#midimessage
   * @fires InputChannel#unknownmessage
   *
   * @fires InputChannel#noteoff
   * @fires InputChannel#noteon
   * @fires InputChannel#keyaftertouch
   * @fires InputChannel#programchange
   * @fires InputChannel#channelaftertouch
   * @fires InputChannel#pitchbend
   *
   * @fires InputChannel#allnotesoff
   * @fires InputChannel#allsoundoff
   * @fires InputChannel#localcontrol
   * @fires InputChannel#monomode
   * @fires InputChannel#omnimode
   * @fires InputChannel#resetallcontrollers
   *
   * @fires InputChannel#event:nrpn
   * @fires InputChannel#event:nrpn-dataentrycoarse
   * @fires InputChannel#event:nrpn-dataentryfine
   * @fires InputChannel#event:nrpn-dataincrement
   * @fires InputChannel#event:nrpn-datadecrement
   * @fires InputChannel#event:rpn
   * @fires InputChannel#event:rpn-dataentrycoarse
   * @fires InputChannel#event:rpn-dataentryfine
   * @fires InputChannel#event:rpn-dataincrement
   * @fires InputChannel#event:rpn-datadecrement
   *
   * @fires InputChannel#controlchange
   * @fires InputChannel#event:controlchange-controllerxxx
   * @fires InputChannel#event:controlchange-bankselectcoarse
   * @fires InputChannel#event:controlchange-modulationwheelcoarse
   * @fires InputChannel#event:controlchange-breathcontrollercoarse
   * @fires InputChannel#event:controlchange-footcontrollercoarse
   * @fires InputChannel#event:controlchange-portamentotimecoarse
   * @fires InputChannel#event:controlchange-dataentrycoarse
   * @fires InputChannel#event:controlchange-volumecoarse
   * @fires InputChannel#event:controlchange-balancecoarse
   * @fires InputChannel#event:controlchange-pancoarse
   * @fires InputChannel#event:controlchange-expressioncoarse
   * @fires InputChannel#event:controlchange-effectcontrol1coarse
   * @fires InputChannel#event:controlchange-effectcontrol2coarse
   * @fires InputChannel#event:controlchange-generalpurposecontroller1
   * @fires InputChannel#event:controlchange-generalpurposecontroller2
   * @fires InputChannel#event:controlchange-generalpurposecontroller3
   * @fires InputChannel#event:controlchange-generalpurposecontroller4
   * @fires InputChannel#event:controlchange-bankselectfine
   * @fires InputChannel#event:controlchange-modulationwheelfine
   * @fires InputChannel#event:controlchange-breathcontrollerfine
   * @fires InputChannel#event:controlchange-footcontrollerfine
   * @fires InputChannel#event:controlchange-portamentotimefine
   * @fires InputChannel#event:controlchange-dataentryfine
   * @fires InputChannel#event:controlchange-channelvolumefine
   * @fires InputChannel#event:controlchange-balancefine
   * @fires InputChannel#event:controlchange-panfine
   * @fires InputChannel#event:controlchange-expressionfine
   * @fires InputChannel#event:controlchange-effectcontrol1fine
   * @fires InputChannel#event:controlchange-effectcontrol2fine
   * @fires InputChannel#event:controlchange-damperpedal
   * @fires InputChannel#event:controlchange-portamento
   * @fires InputChannel#event:controlchange-sostenuto
   * @fires InputChannel#event:controlchange-softpedal
   * @fires InputChannel#event:controlchange-legatopedal
   * @fires InputChannel#event:controlchange-hold2
   * @fires InputChannel#event:controlchange-soundvariation
   * @fires InputChannel#event:controlchange-resonance
   * @fires InputChannel#event:controlchange-releasetime
   * @fires InputChannel#event:controlchange-attacktime
   * @fires InputChannel#event:controlchange-brightness
   * @fires InputChannel#event:controlchange-decaytime
   * @fires InputChannel#event:controlchange-vibratorate
   * @fires InputChannel#event:controlchange-vibratodepth
   * @fires InputChannel#event:controlchange-vibratodelay
   * @fires InputChannel#event:controlchange-generalpurposecontroller5
   * @fires InputChannel#event:controlchange-generalpurposecontroller6
   * @fires InputChannel#event:controlchange-generalpurposecontroller7
   * @fires InputChannel#event:controlchange-generalpurposecontroller8
   * @fires InputChannel#event:controlchange-portamentocontrol
   * @fires InputChannel#event:controlchange-highresolutionvelocityprefix
   * @fires InputChannel#event:controlchange-effect1depth
   * @fires InputChannel#event:controlchange-effect2depth
   * @fires InputChannel#event:controlchange-effect3depth
   * @fires InputChannel#event:controlchange-effect4depth
   * @fires InputChannel#event:controlchange-effect5depth
   * @fires InputChannel#event:controlchange-dataincrement
   * @fires InputChannel#event:controlchange-datadecrement
   * @fires InputChannel#event:controlchange-nonregisteredparameterfine
   * @fires InputChannel#event:controlchange-nonregisteredparametercoarse
   * @fires InputChannel#event:controlchange-registeredparameterfine
   * @fires InputChannel#event:controlchange-registeredparametercoarse
   * @fires InputChannel#event:controlchange-allsoundoff
   * @fires InputChannel#event:controlchange-resetallcontrollers
   * @fires InputChannel#event:controlchange-localcontrol
   * @fires InputChannel#event:controlchange-allnotesoff
   * @fires InputChannel#event:controlchange-omnimodeoff
   * @fires InputChannel#event:controlchange-omnimodeon
   * @fires InputChannel#event:controlchange-monomodeon
   * @fires InputChannel#event:controlchange-polymodeon
   * @fires InputChannel#event:
   *
   * @extends EventEmitter
   * @license Apache-2.0
   * @since 3.0.0
   */class nl extends Yo{constructor(e,t){super(),this._input=e,this._number=t,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const t=Object.assign({},e);t.port=this.input,t.target=this,t.type="midimessage",this.emit(t.type,t),this._parseEventForStandardMessages(t)}_parseEventForStandardMessages(e){const t=Object.assign({},e);t.type=t.message.type||"unknownmessage";const n=e.message.dataBytes[0],s=e.message.dataBytes[1];if("noteoff"===t.type||"noteon"===t.type&&0===s)this.notesState[n]=!1,t.type="noteoff",t.note=new Zo(Ko.offsetNumber(n,this.octaveOffset+this.input.octaveOffset+al.octaveOffset),{rawAttack:0,rawRelease:s}),t.value=Ko.from7bitToFloat(s),t.rawValue=s,t.velocity=t.note.release,t.rawVelocity=t.note.rawRelease;else if("noteon"===t.type)this.notesState[n]=!0,t.note=new Zo(Ko.offsetNumber(n,this.octaveOffset+this.input.octaveOffset+al.octaveOffset),{rawAttack:s}),t.value=Ko.from7bitToFloat(s),t.rawValue=s,t.velocity=t.note.attack,t.rawVelocity=t.note.rawAttack;else if("keyaftertouch"===t.type)t.note=new Zo(Ko.offsetNumber(n,this.octaveOffset+this.input.octaveOffset+al.octaveOffset)),t.value=Ko.from7bitToFloat(s),t.rawValue=s,t.identifier=t.note.identifier,t.key=t.note.number,t.rawKey=n;else if("controlchange"===t.type){t.controller={number:n,name:Xo.CONTROL_CHANGE_MESSAGES[n].name,description:Xo.CONTROL_CHANGE_MESSAGES[n].description,position:Xo.CONTROL_CHANGE_MESSAGES[n].position},t.subtype=t.controller.name||"controller"+n,t.value=Ko.from7bitToFloat(s),t.rawValue=s;const e=Object.assign({},t);e.type=`${t.type}-controller${n}`,delete e.subtype,this.emit(e.type,e);const i=Object.assign({},t);i.type=`${t.type}-`+Xo.CONTROL_CHANGE_MESSAGES[n].name,delete i.subtype,0!==i.type.indexOf("controller")&&this.emit(i.type,i),t.message.dataBytes[0]>=120&&this._parseChannelModeMessage(t),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(t.message.dataBytes[0])&&this._parseEventForParameterNumber(t)}else"programchange"===t.type?(t.value=n,t.rawValue=t.value):"channelaftertouch"===t.type?(t.value=Ko.from7bitToFloat(n),t.rawValue=n):"pitchbend"===t.type?(t.value=((s<<7)+n-8192)/8192,t.rawValue=(s<<7)+n):t.type="unknownmessage";this.emit(t.type,t)}_parseChannelModeMessage(e){const t=Object.assign({},e);t.type=t.controller.name,"localcontrol"===t.type&&(t.value=127===t.message.data[2],t.rawValue=t.message.data[2]),"omnimodeon"===t.type?(t.type="omnimode",t.value=!0,t.rawValue=t.message.data[2]):"omnimodeoff"===t.type&&(t.type="omnimode",t.value=!1,t.rawValue=t.message.data[2]),"monomodeon"===t.type?(t.type="monomode",t.value=!0,t.rawValue=t.message.data[2]):"polymodeon"===t.type&&(t.type="monomode",t.value=!1,t.rawValue=t.message.data[2]),this.emit(t.type,t)}_parseEventForParameterNumber(e){const t=e.message.dataBytes[0],n=e.message.dataBytes[1];99===t||101===t?(this._nrpnBuffer=[],this._rpnBuffer=[],99===t?this._nrpnBuffer=[e.message]:127!==n&&(this._rpnBuffer=[e.message])):98===t||100===t?98===t?(this._rpnBuffer=[],1===this._nrpnBuffer.length?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],1===this._rpnBuffer.length&&127!==n?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):6!==t&&38!==t&&96!==t&&97!==t||(2===this._rpnBuffer.length?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):2===this._nrpnBuffer.length?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return 6===e||38===e||96===e||97===e||98===e||99===e||100===e||101===e}_dispatchParameterNumberEvent(e,t,n,s){e="nrpn"===e?"nrpn":"rpn";const i={target:s.target,timestamp:s.timestamp,message:s.message,parameterMsb:t,parameterLsb:n,value:Ko.from7bitToFloat(s.message.dataBytes[1]),rawValue:s.message.dataBytes[1]};i.parameter="rpn"===e?Object.keys(Xo.REGISTERED_PARAMETERS).find((e=>Xo.REGISTERED_PARAMETERS[e][0]===t&&Xo.REGISTERED_PARAMETERS[e][1]===n)):(t<<7)+n;const a=Xo.CONTROL_CHANGE_MESSAGES[s.message.dataBytes[0]].name;i.type=`${e}-${a}`,this.emit(i.type,i);const r=Object.assign({},i);"nrpn-dataincrement"===r.type?r.type="nrpn-databuttonincrement":"nrpn-datadecrement"===r.type?r.type="nrpn-databuttondecrement":"rpn-dataincrement"===r.type?r.type="rpn-databuttonincrement":"rpn-datadecrement"===r.type&&(r.type="rpn-databuttondecrement"),this.emit(r.type,r),i.type=e,i.subtype=a,this.emit(i.type,i)}getChannelModeByNumber(e){return al.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),Ko.getChannelModeByNumber(e)}getCcNameByNumber(e){if(al.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),!((e=parseInt(e))>=0&&e<=127)))throw new RangeError("Invalid control change number.");return Ko.getCcNameByNumber(e)}getNoteState(e){e instanceof Zo&&(e=e.identifier);const t=Ko.guessNoteNumber(e,al.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[t]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}
/**
   * The `Message` class represents a single MIDI message. It has several properties that make it
   * easy to make sense of the binary data it contains.
   *
   * @license Apache-2.0
   * @since 3.0.0
   */class sl{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=1+(15&this.statusByte)):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=Ko.getPropertyByValue(Xo.CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=Ko.getPropertyByValue(Xo.SYSTEM_MESSAGES,this.command)),this.statusByte===Xo.SYSTEM_MESSAGES.sysex&&(0===this.dataBytes[0]?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}
/**
   * The `Input` class represents a single MIDI input port. This object is automatically instantiated
   * by the library according to the host's MIDI subsystem and does not need to be directly
   * instantiated. Instead, you can access all `Input` objects by referring to the
   * [`WebMidi.inputs`](WebMidi#inputs) array. You can also retrieve inputs by using methods such as
   * [`WebMidi.getInputByName()`](WebMidi#getInputByName) and
   * [`WebMidi.getInputById()`](WebMidi#getInputById).
   *
   * Note that a single MIDI device may expose several inputs and/or outputs.
   *
   * **Important**: the `Input` class does not directly fire channel-specific MIDI messages
   * (such as [`noteon`](InputChannel#event:noteon) or
   * [`controlchange`](InputChannel#event:controlchange), etc.). The [`InputChannel`](InputChannel)
   * object does that. However, you can still use the
   * [`Input.addListener()`](#addListener) method to listen to channel-specific events on multiple
   * [`InputChannel`](InputChannel) objects at once.
   *
   * @fires Input#opened
   * @fires Input#disconnected
   * @fires Input#closed
   * @fires Input#midimessage
   *
   * @fires Input#sysex
   * @fires Input#timecode
   * @fires Input#songposition
   * @fires Input#songselect
   * @fires Input#tunerequest
   * @fires Input#clock
   * @fires Input#start
   * @fires Input#continue
   * @fires Input#stop
   * @fires Input#activesensing
   * @fires Input#reset
   *
   * @fires Input#unknownmidimessage
   *
   * @extends EventEmitter
   * @license Apache-2.0
   */class il extends Yo{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let t=1;t<=16;t++)this.channels[t]=new nl(this,t);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}destroy(){return __async(this,null,(function*(){this.removeListener(),this.channels.forEach((e=>e.destroy())),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),yield this.close(),this._midiInput=null}))}_onStateChange(e){let t={timestamp:al.time,target:this,port:this};"open"===e.port.connection?(t.type="opened",this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const t=new sl(e.data),n={port:this,target:this,message:t,timestamp:e.timeStamp,type:"midimessage",data:t.data,rawData:t.data,statusByte:t.data[0],dataBytes:t.dataBytes};this.emit("midimessage",n),t.isSystemMessage?this._parseEvent(n):t.isChannelMessage&&this.channels[t.channel]._processMidiMessageEvent(n),this._forwarders.forEach((e=>e.forward(t)))}_parseEvent(e){const t=Object.assign({},e);t.type=t.message.type||"unknownmidimessage","songselect"===t.type&&(t.song=e.data[1]+1,t.value=e.data[1],t.rawValue=t.value),this.emit(t.type,t)}open(){return __async(this,null,(function*(){try{yield this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}))}close(){return __async(this,null,(function*(){if(!this._midiInput)return Promise.resolve(this);try{yield this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}))}getChannelModeByNumber(){al.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,t,n={}){if(al.validation&&"function"==typeof n){let e=null!=t?[].concat(t):void 0;t=n,n={channels:e}}if(Xo.CHANNEL_EVENTS.includes(e)){void 0===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS);let s=[];return Ko.sanitizeChannels(n.channels).forEach((i=>{s.push(this.channels[i].addListener(e,t,n))})),s}return super.addListener(e,t,n)}addOneTimeListener(e,t,n={}){return n.remaining=1,this.addListener(e,t,n)}on(e,t,n,s){return this.addListener(e,t,n,s)}hasListener(e,t,n={}){if(al.validation&&"function"==typeof n){let e=[].concat(t);t=n,n={channels:e}}return Xo.CHANNEL_EVENTS.includes(e)?(void 0===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),Ko.sanitizeChannels(n.channels).every((n=>this.channels[n].hasListener(e,t)))):super.hasListener(e,t)}removeListener(e,t,n={}){if(al.validation&&"function"==typeof n){let e=[].concat(t);t=n,n={channels:e}}if(void 0===n.channels&&(n.channels=Xo.MIDI_CHANNEL_NUMBERS),null==e)return Ko.sanitizeChannels(n.channels).forEach((e=>{this.channels[e]&&this.channels[e].removeListener()})),super.removeListener();Xo.CHANNEL_EVENTS.includes(e)?Ko.sanitizeChannels(n.channels).forEach((s=>{this.channels[s].removeListener(e,t,n)})):super.removeListener(e,t,n)}addForwarder(e,t={}){let n;return n=e instanceof tl?e:new tl(e,t),this._forwarders.push(n),n}removeForwarder(e){this._forwarders=this._forwarders.filter((t=>t!==e))}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return al.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}
/**
   * The `WebMidi` object makes it easier to work with the low-level Web MIDI API. Basically, it
   * simplifies sending outgoing MIDI messages and reacting to incoming MIDI messages.
   *
   * When using the WebMidi.js library, you should know that the `WebMidi` class has already been
   * instantiated. You cannot instantiate it yourself. If you use the **IIFE** version, you should
   * simply use the global object called `WebMidi`. If you use the **CJS** (CommonJS) or **ESM** (ES6
   * module) version, you get an already-instantiated object when you import the module.
   *
   * @fires WebMidi#connected
   * @fires WebMidi#disabled
   * @fires WebMidi#disconnected
   * @fires WebMidi#enabled
   * @fires WebMidi#error
   * @fires WebMidi#midiaccessgranted
   * @fires WebMidi#portschanged
   *
   * @extends EventEmitter
   * @license Apache-2.0
   */const al=new class extends Yo{constructor(){super(),this.defaults={note:{attack:Ko.from7bitToFloat(64),release:Ko.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}enable(){return __async(this,arguments,(function*(e={},t=!1){if(Ko.isNode){try{window.navigator}catch(a){let e=yield Object.getPrototypeOf((function(){return __async(this,null,(function*(){}))})).constructor('\n        let jzz = await import("jzz");\n        return jzz.default;\n        ')();global.navigator||(global.navigator={}),Object.assign(global.navigator,e)}try{performance}catch(a){global.performance=yield Object.getPrototypeOf((function(){return __async(this,null,(function*(){}))})).constructor('\n        let perf_hooks = await import("perf_hooks");\n        return perf_hooks.performance;\n        ')()}}if(this.validation=!1!==e.validation,this.validation&&("function"==typeof e&&(e={callback:e,sysex:t}),t&&(e.sysex=!0)),this.enabled)return"function"==typeof e.callback&&e.callback(),Promise.resolve();const n={timestamp:this.time,target:this,type:"error",error:void 0},s={timestamp:this.time,target:this,type:"midiaccessgranted"},i={timestamp:this.time,target:this,type:"enabled"};try{"function"==typeof e.requestMIDIAccessFunction?this.interface=yield e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=yield navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(a){return n.error=a,this.emit("error",n),"function"==typeof e.callback&&e.callback(a),Promise.reject(a)}this.emit("midiaccessgranted",s),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{yield this._updateInputsAndOutputs()}catch(a){return n.error=a,this.emit("error",n),"function"==typeof e.callback&&e.callback(a),Promise.reject(a)}return this.emit("enabled",i),"function"==typeof e.callback&&e.callback(),Promise.resolve(this)}))}disable(){return __async(this,null,(function*(){return this.interface&&(this.interface.onstatechange=void 0),this._destroyInputsAndOutputs().then((()=>{navigator&&"function"==typeof navigator.close&&navigator.close(),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()}))}))}getInputById(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(t.disconnected){for(let n=0;n<this._disconnectedInputs.length;n++)if(this._disconnectedInputs[n].id===e.toString())return this._disconnectedInputs[n]}else for(let n=0;n<this.inputs.length;n++)if(this.inputs[n].id===e.toString())return this.inputs[n]}getInputByName(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(t.disconnected){for(let n=0;n<this._disconnectedInputs.length;n++)if(~this._disconnectedInputs[n].name.indexOf(e))return this._disconnectedInputs[n]}else for(let n=0;n<this.inputs.length;n++)if(~this.inputs[n].name.indexOf(e))return this.inputs[n]}getOutputByName(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(t.disconnected){for(let n=0;n<this._disconnectedOutputs.length;n++)if(~this._disconnectedOutputs[n].name.indexOf(e))return this._disconnectedOutputs[n]}else for(let n=0;n<this.outputs.length;n++)if(~this.outputs[n].name.indexOf(e))return this.outputs[n]}getOutputById(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(t.disconnected){for(let n=0;n<this._disconnectedOutputs.length;n++)if(this._disconnectedOutputs[n].id===e.toString())return this._disconnectedOutputs[n]}else for(let n=0;n<this.outputs.length;n++)if(this.outputs[n].id===e.toString())return this.outputs[n]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),Ko.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127&&Ko.getNoteDetails(Ko.offsetNumber(e,this.octaveOffset)).octave}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),Ko.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),Ko.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),Ko.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,t={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),Ko.buildNoteArray(e,t)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),Ko.toTimestamp(e)}_destroyInputsAndOutputs(){return __async(this,null,(function*(){let e=[];return this.inputs.forEach((t=>e.push(t.destroy()))),this.outputs.forEach((t=>e.push(t.destroy()))),Promise.all(e).then((()=>{this._inputs=[],this._outputs=[]}))}))}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let t={timestamp:e.timeStamp,type:e.port.state,target:this};if("connected"===e.port.state&&"open"===e.port.connection){"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)),this.emit(e.port.state,t);const n=Object.assign({},t);n.type="portschanged",this.emit(n.type,n)}else if("disconnected"===e.port.state&&"pending"===e.port.connection){"input"===e.port.type?t.port=this.getInputById(e.port.id,{disconnected:!0}):"output"===e.port.type&&(t.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,t);const n=Object.assign({},t);n.type="portschanged",this.emit(n.type,n)}}_updateInputsAndOutputs(){return __async(this,null,(function*(){return Promise.all([this._updateInputs(),this._updateOutputs()])}))}_updateInputs(){return __async(this,null,(function*(){if(!this.interface)return;for(let t=this._inputs.length-1;t>=0;t--){const e=this._inputs[t];Array.from(this.interface.inputs.values()).find((t=>t===e._midiInput))||(this._disconnectedInputs.push(e),this._inputs.splice(t,1))}let e=[];return this.interface.inputs.forEach((t=>{if(!this._inputs.find((e=>e._midiInput===t))){let n=this._disconnectedInputs.find((e=>e._midiInput===t));n||(n=new il(t)),this._inputs.push(n),e.push(n.open())}})),Promise.all(e)}))}_updateOutputs(){return __async(this,null,(function*(){if(!this.interface)return;for(let t=this._outputs.length-1;t>=0;t--){const e=this._outputs[t];Array.from(this.interface.outputs.values()).find((t=>t===e._midiOutput))||(this._disconnectedOutputs.push(e),this._outputs.splice(t,1))}let e=[];return this.interface.outputs.forEach((t=>{if(!this._outputs.find((e=>e._midiOutput===t))){let n=this._disconnectedOutputs.find((e=>e._midiOutput===t));n||(n=new el(t)),this._outputs.push(n),e.push(n.open())}})),Promise.all(e)}))}get enabled(){return null!==this.interface}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),Ko.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),Ko.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return"undefined"!=typeof navigator&&!!navigator.requestMIDIAccess}get sysexEnabled(){return!(!this.interface||!this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.1.12"}get flavour(){return"esm"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),Xo.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.SYSTEM_MESSAGES."),Xo.SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.CHANNEL_MODE_MESSAGES."),Xo.CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been replaced by the Enumerations.CONTROL_CHANGE_MESSAGES array."),Xo.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.REGISTERED_PARAMETERS."),Xo.REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}};al.constructor=null;const rl={sampler:class extends Wo{constructor(e,t){super(t);const n=e;this.loop=t.loop||!1;const{loopStart:s,loopEnd:i}=t,a=new Nr(n,{loop:this.loop,loopStart:s,loopEnd:i}),r=new zo(a,t);this.player=a,this.channel=r,this.metadata=t.metadata||{},this.initParams(),this.settings.envelope&&Object.entries(this.settings.envelope).forEach((([e,t])=>{this.setParam(e,t)}))}initParams(){const e=this.player;this.params=new Map([Eo(this),Mo(this),new So({name:"attack",set:t=>e.attack=t}),new So({name:"release",set:t=>e.release=t,controlSpec:new xo({default:2,min:0,max:5})}),new So({name:"curve",set:t=>e.curve=t}),new So({name:"rate",set:this.setPlaybackRate.bind(this),controlSpec:new xo({default:1,min:0,max:3})})].map((e=>[e.name,e])))}getState(){return"started"}setPlaybackRate(e,t){const n=this.getActiveSources();n&&n.forEach((n=>{const s=n[0];if(s){const i=(n.originalRate||s.playbackRate.value)+(e-1);if(t&&t.fadeTime){const e=t.startTime?t.startTime:0;n.originalRate=s.playbackRate.value,s.playbackRate.cancelAndHoldAtTime(so()+e),s.playbackRate.rampTo(i,t.fadeTime,so()+e)}else s.playbackRate.value=e}}))}getActiveSources(){return this.player._activeSources}getNumberOfActiveSources(){let e=0;const t=this.getActiveSources();return t&&t.forEach((t=>{e+=t.length})),e}stopOldestNote(){const e=[],t=this.getActiveSources();if(t){t.forEach(((t,n)=>{t.forEach((t=>{e.push({key:n,note:t})}))}));const n=e.reduce(((e,t)=>e.note._stopTime<t.note._stopTime?e:t));this.player.triggerRelease(Ba(n.key))}}play(e={}){const{noReset:t=!1,options:n={}}=e;if("suspended"===Na().state)return!1;let{when:s=0}=e;const{note:i=60,velocity:a=1,exactTime:r=!1,duration:o=0}=n;!t&&this.channel.resetGain(),s=r?s:io()+s,o&&!this.loop?this.player.triggerAttackRelease(Ba(i),o,s,a):this.player.triggerAttack(Ba(i),s,a)}stop(e={}){let{when:t=0}=e;const{options:n={}}=e,{note:s,exactTime:i=!1}=n;t=i?t:io()+t,s?this.player.triggerRelease(Ba(s),t):this.player.releaseAll(t)}triggerModulators(e){this.channel.triggerModulators(e)}releaseAll(e=0){this.player.releaseAll(e)}},player:$o,midi:class extends Wo{constructor(e,t){super(t),this.onConnected=null,this.onDisconnected=null;const{outputDevices:n="all"}=t;this.outputDevices=n,this.outputs=[],this.initialize()}initParams(){}setGain(e,t=0,n=0){}connect(e){}getState(){return"started"}getWebMidiEnabled(){return al.enabled}getAvailableOutputs(){return this.availableOutputs}getOutputs(){return this.outputs}setConnectedCallback(e){this.onConnected=e}setDisconnectedCallback(e){this.onDisconnected=e}setOutputs(e){if(this.outputDevices=e,al.enabled)if(this.outputs=[],"all"===e)this.outputs=al.outputs;else{const t=al.outputs.find((t=>t.name===e.trim()));t&&this.outputs.push(t)}}play({noReset:e=!0,when:t=0,options:n}){const{note:s,velocity:i}=n;this.outputs.forEach((e=>{const n=performance.now()+1e3*t;e.playNote(s,{attack:i,time:n})}))}stop({when:e=0,options:t={note:null}}){t&&t.note&&this.outputs.forEach((n=>{const s=performance.now()+1e3*e;n.stopNote(t.note,{time:s})}))}allNotesOff(){this.outputs.forEach((e=>{e.sendAllNotesOff()}))}sendReset(){this.outputs.forEach((e=>{e.sendReset()}))}fadeOut(e,t,n){}setRawParam(e,t,n){this.params.get(e).setRaw(t,n)}dispose(){}isEnabled(){return al.enabled}initialize(){return __async(this,null,(function*(){try{yield al.enable(),this.availableOutputs=al.outputs,this.setOutputs(this.outputDevices),al.addListener("connected",(e=>{this.onConnected&&this.onConnected(e),this.setOutputs(this.outputDevices)})),al.addListener("disconnected",(e=>{this.onDisconnected&&this.onDisconnected(e),this.setOutputs(this.outputDevices)}))}catch(e){console.error("WebMidi could not be enabled.",e)}}))}},roundRobin:class extends Wo{constructor(e,t){super(t),this.playIndex=0;const{mode:n="random"}=t;this.players=[];const s=new Ka(1);this.gain=s,Object.values(e).forEach((e=>{this.addPlayer(e)}));const i=new zo(s,t);this.channel=i,this.setMode(n),this.initParams()}initParams(){this.params=new Map([Eo(this),Mo(this)].map((e=>[e.name,e])))}advancePlayIndex(){switch(this.mode){case"random":if(this.players.length>1){let e=0;e=this.getRandomIndex(),this.playIndex=e}break;case"step":this.playIndex=++this.playIndex%this.players.length;break;case"backwards":this.playIndex=--this.playIndex%this.players.length,this.playIndex<0&&(this.playIndex=this.players.length-1);break;case"shuffle":this.playIndex===this.players.length-1&&go(this.players),this.playIndex=++this.playIndex%this.players.length}}getRandomIndex(){const e=new Array(this.players.length).fill(0).map(((e,t)=>t)).filter((e=>e!==this.playIndex));return e[Math.floor(Math.random()*e.length)]}addPlayer(e){const t=new Or(e);t.connect(this.gain),this.players.push(t)}setMode(e){this.mode=e,"random"===this.mode&&this.advancePlayIndex(),"backwards"===this.mode&&(this.playIndex=this.players.length-1),"shuffle"===this.mode&&go(this.players)}getState(){let e=!1;return this.players.forEach((t=>{"started"===t.state&&(e=!0)})),e?"started":"stopped"}play(e={}){var t;const{exactTime:n=!1,offset:s=0}=e;if("suspended"===Na().state)return!1;const{when:i=0}=e,a=n?i:io()+i;null==(t=this.players[this.playIndex])||t.start(a,s),this.advancePlayIndex()}stop(e={}){const{exactTime:t=!1}=e;let{when:n=0}=e;n=t?n:io()+n,this.players.forEach((e=>{e.stop(n)}))}dispose(){this.players.forEach((e=>{e.dispose(),e.disconnect()})),this.channel.dispose()}}};class ol{constructor(e={}){const{destination:t,bufferManager:n,busses:s}=e;this.bufferManager=n,this.busses=s,this.instruments=new Map,this.masterGain=t||Na().destination}trigger(e,t){t=t||{};const n=this.getInstrument(e);n&&n.play(t)}setConfigManager(e){this.config=e,this.config.setOnUpdate(this.onConfigUpdate.bind(this))}createInstrument(e,t){return __async(this,null,(function*(){const n=t.spatial,{buffer:s,soundSource:i}=yield this.getBufferForInstrument(t.sound,e);i&&((t=__spreadValues(__spreadValues({},i),t)).spatial=__spreadValues(__spreadValues({},i.spatial),n)),t.type||(t.type="player");var a;const r=new((a=t.type)?rl[a]:$o)(s,t);if(t.bus){const e=this.busses.get(t.bus);e?r.connect(e.input):(console.warn("Could not find bus:",t.bus),r.connect(this.masterGain))}else t.bus="",r.connect(this.masterGain);t.sends&&this.busses&&t.sends.forEach((e=>{const t=this.busses.get(e.bus);t&&r.channel.addSend(t,{gain:e.gain,pre:e.pre})})),this.addInstrumentWithScene({sceneName:e.name,soundName:t.name,instrument:r})}))}addInstrumentWithScene({sceneName:e,soundName:t,instrument:n}){e?this.instruments.set(`${e}:${t}`,n):this.instruments.set(`${t}`,n)}getInstrument(e){return this.instruments.get(e)}getInstrumentKeysForScene(e){const t=[];return this.instruments.forEach(((n,s)=>{s.match(`${e}:`)&&t.push(s)})),t}stop(e,t){t=t||{};const{fadeTime:n=0,when:s=0,exactTime:i=!1}=t,a=this.instruments.get(e);ol.stopInstrument(a,{fadeTime:n,when:s,onComplete:null==t?void 0:t.onComplete,exactTime:i})}pause(e,t){const n=this.instruments.get(e);n&&n.pause(t)}resume(e,t){const n=this.instruments.get(e);n&&n.resume(t)}static stopInstrument(e,t={}){const{onComplete:n}=t;t.onComplete=()=>{e.stop(),n&&n()},ol.fadeOutInstrument(e,t)}fadeOut(e,t){const n=this.instruments.get(e);ol.fadeOutInstrument(n,t)}static fadeOutInstrument(e,t={}){const{when:n,fadeTime:s,onComplete:i,exactTime:a}=t;null==e||e.fadeOut(s,n,i,a)}addSound({sound:e,sceneName:t,buffer:n}){return n&&(n=Array.isArray(n)?n:[n]).forEach((e=>{this.bufferManager.setSoundBuffer(e.name,e.buffer);const t={name:e.name,file:e.fileName||e.name};this.bufferManager.addSource(t)})),this.getInstrument(`${t}:${e.name}`)&&this.deleteInstrument(`${t}:${e.name}`),e}addInstrument(e){return __async(this,arguments,(function*({sound:e,sceneName:t,buffer:n}){const s=this.addSound({sound:e,sceneName:t,buffer:n});return this.createInstrument({name:t},s)}))}deleteInstrument(e){const t=e.split(":")[1];this.bufferManager.removeSource(t),this.disposeInstrument(this.instruments.get(e))}updateInstrument(e,t){return __async(this,null,(function*(){const n=this.instruments.get(e),s=e.split(":")[0];if(n){let i;for(let a in t)switch(a){case"name":n.name=t.name,this.instruments.set(`${s}:${t.name}`,n),this.instruments.delete(e);break;case"bus":n.channel.disconnect(),"$OUT"===t.bus?n.connect(this.masterGain):n.connect(this.busses.get(t.bus).input);break;case"type":i=n.settings,i.type=t.type,i.sound=t.sound,this.instruments.delete(e),n.dispose(),yield this.createInstrument({name:s},i);break;case"sound":i=n.settings,yield this.updateInstrumentBuffers({scene:{name:s},key:e,sound:t.sound,type:i.type});break;case"gain":n.channel.setGain(t.gain),n.channel.setInitialGain(t.gain)}n.update(t)}}))}getBufferForInstrument(e,t){return __async(this,null,(function*(){let n,s;if("object"==typeof e){const i=[];n={},Object.keys(e).forEach((a=>{s=this.bufferManager.getSource(e[a]);const r=this.bufferManager.getSoundBuffer(e[a],t.localized).then((e=>{n[a]=e})).catch((t=>{console.error(t,e[a])}));i.push(r)})),yield Promise.all(i)}else e&&(s=this.bufferManager.getSource(e),n=yield this.bufferManager.getSoundBuffer(e,t.localized).catch((t=>{console.error(t,e)})));return{buffer:n,soundSource:s}}))}updateInstrumentBuffers(e){return __async(this,null,(function*(){const{scene:t,key:n,type:s,sound:i}=e,a=this.getInstrument(n);let{buffer:r}=yield this.getBufferForInstrument(i,t);switch(s){case"player":a.player.buffer=r;break;case"sampler":a.player._buffers.dispose();for(const[e,t]of Object.entries(r))a.player.add(e,t);break;case"roundRobin":a.players.forEach((e=>{e.dispose(),e.disconnect()})),a.players=[];for(const e in r)a.addPlayer(r[e])}}))}moveInstrument(e,t){const n=this.instruments.get(e);this.instruments.delete(e);const s=e.split(":")[1];this.instruments.set(`${t.scene}:${s}`,n)}disposeAll(){this.instruments.forEach((e=>{this.disposeInstrument(e)}))}disposeInstrument(e){e.dispose(),this.instruments.forEach(((t,n)=>{t===e&&this.instruments.delete(n)}))}static unloadInstruments(e){e.forEach((e=>e.dispose()))}onConfigUpdate(e){const{location:t,toUpdate:n,action:s}=e;if(t.match(/^scenes\./)){const e=t.split("."),i=e[1];if(e.length>3&&"sounds"===e[2]){const t=`${i}:${e[3]}`;switch(s){case yo.CREATE:this.createInstrument({name:i},n);break;case yo.DELETE:this.deleteInstrument(t);break;case yo.MOVE:this.moveInstrument(t,n);break;default:this.updateInstrument(t,n)}}}else if(t.match(/^sources\./)){const e=t.split(".")[1];this.instruments.forEach(((t,i)=>{if(this.instrumentHasSource(t,e))switch(s){case yo.DELETE:this.updateInstrument(i,{sound:""});break;case yo.UPDATE:n.name?this.updateInstrument(i,{sound:n.name}):n.file||this.updateInstrument(i,n)}}))}else if(t.match(/^busses\./)){const e=t.split(".")[1];this.instruments.forEach(((t,i)=>{var a,r;if(t.settings.bus===e)switch(s){case yo.DELETE:const e=i.split(":")[0],t=null==(r=null==(a=this.config.config)?void 0:a.scenes[e])?void 0:r.bus;this.updateInstrument(i,{bus:t||"$OUT"});break;case yo.UPDATE:n.name&&this.updateInstrument(i,{bus:n.name})}}))}}instrumentHasSource(e,t){return Array.isArray(e.settings.sound)?e.settings.sound.includes(t):"string"==typeof e.settings.sound?e.settings.sound===t:void("sampler"===e.settings.type&&Object.values(e.settings.sound).forEach((e=>{if(e===t)return!0})))}checkIfBufferInUseByMultipleInstruments(e){if(e){if(Array.from(this.instruments).map((e=>e[1])).reduce(((t,n)=>{var s,i;return t+((null==(i=null==(s=n.player)?void 0:s._buffer)?void 0:i._buffer)===e?1:0)}),0)>0)return!0}return!1}}class ll{constructor(e,t){this.type="Bus",this.settings=__spreadValues({},e),this.uuid=Ro(),this.name=e.name;const n=void 0!==this.settings.gain?this.settings.gain:1;this.settings.gain=n,this.channel=new zo(null,e,t),this.setupAudioGraph()}setupAudioGraph(){this.input=new Ka,this.channel.add(this.input)}connect(e,t=0,n=0){this.channel.connect(e,t,n)}setGain(e,t=1,n){this.channel.setGain(e,t,n)}setMuteState(e,t){this.channel.setMuteState(e,t)}triggerModulators(e){this.channel.triggerModulators(e)}get params(){return this.channel.params}setParam(e,t,n){this.channel.setParam(e,t,n)}setRawParam(e,t,n){this.channel.setRawParam(e,t,n)}update(e){e.name&&(this.name=e.name),Object.keys(e).forEach((t=>{const n=this.params.get(t);n&&n.setRaw(e[t]),this.settings[t]=e[t]}))}dispose(){this.input.dispose(),this.channel.dispose()}}class cl{constructor(e=[{name:"master",parent:"$OUT"}],t,n){this.bufferManager=t,this.busses=new Map,this.setupAudioGraph(e,n)}setupAudioGraph(e,t){this.busses&&this.busses.forEach(((e,t)=>{e.dispose(),this.busses.delete(t)})),this.masterGain=new Ka(1).toDestination(),t&&t>2&&(this.merge=new Lr(t),this.merge.connect(this.masterGain)),e.forEach((e=>{this.createBus(e)})),this.busses.forEach((e=>{this.connectBus(e)}))}connectBus(e){var t;if("$OUT"===e.settings.parent)if(this.merge&&(null==(t=e.settings.channels)?void 0:t.length)){const t=new Vr(2);e.connect(t);for(let s=0;s<e.settings.channels.length;s++)try{t.connect(this.merge,s%2,e.settings.channels[s]-1)}catch(n){console.warn(`Could not connect bus ${e.name} to channel`,e.settings.channels[s],n)}}else e.connect(this.masterGain.input);else{const t=this.busses.get(e.settings.parent).input;e.connect(t)}e.settings.sends&&e.settings.sends.forEach((t=>{const n=this.busses.get(t.bus);n?e.channel.addSend(n,{gain:t.gain,pre:t.pre}):console.warn(`Can't find ${t.bus}.`)}))}createBus(e){const t=[];e.effects&&e.effects.forEach((e=>{var n;(null==(n=e.settings)?void 0:n.sound)&&t.push(e.settings.sound)}));const n=new ll(e,(()=>new Promise(((e,n)=>{t.length>0?Promise.all(t.map((e=>this.bufferManager.getSoundBuffer(e)))).then((t=>{e(t)})):e(!0)}))));return this.busses.set(e.name,n),n}setConfigManager(e){this.config=e,this.config.setOnUpdate(this.onConfigUpdate.bind(this))}addBus(e){return e}getBus(e){return this.busses.get(e)}getAll(){return this.busses}onConfigUpdate(e){const{location:t,toUpdate:n,action:s}=e;if(t.match(/^busses\./)){const e=t.split(".")[1],i=this.busses.get(e);switch(s){case yo.CREATE:const t=this.createBus(n);this.connectBus(t);break;case yo.DELETE:i.dispose(),this.busses.delete(e);break;case yo.UPDATE:if(n.parent){i.channel.disconnect();const e="$OUT"===n.parent?this.masterGain:this.busses.get(n.parent).input;i.connect(e)}if(n.name){const t=this.busses.get(e);this.busses.set(n.name,t),this.busses.delete(e)}i.update(n)}}}setBusVolume(e,t,n=1,s=0){const i=this.busses.get(e);"$OUT"===e?this.masterGain.gain.rampTo(t,n,s):null==i||i.setGain(t,n,s)}setBusMute(e,t){var n;return"$OUT"===e?(this.masterGain.gain.value=t?0:1,Promise.resolve(!0)):null==(n=this.busses.get(e))?void 0:n.setMuteState(t)}connectMediaToBus(e,t){const n=Na().createMediaElementSource(t),s=this.getBus(e);return s&&Xa(n,s.input.output),t.muted=!1,n}getDestination(){return this.masterGain.input}empty(){this.busses.forEach((e=>e.dispose()))}}class ul{constructor(e){this.audioIsInitialized=!1,this.utils=_o,this.loadingState="initializing",this.disableBlur=!1,this.iosHack=!1,window.KLANG_DEBUG&&console.log("Klang Loaded");const{scenes:t,sources:n,busses:s=[{name:"master",parent:"$OUT"}],basePath:i=""}=e;this.config=new vo(e),this.config.setOnUpdate(this.onConfigUpdate.bind(this));const a=(e=>`${e||""}/`.split(/\/\//).join("/"))(i);this.scenes=new Map,this.loadSceneConfigs(t),this.bufferManager=new bo(n,a),this.bufferManager.setConfigManager(this.config),this.disposeInstruments(),this.busManager=new cl(s,this.bufferManager,this.config.config.channels),this.busManager.setConfigManager(this.config),this.instrumentManager=new ol({destination:this.busManager.getDestination(),bufferManager:this.bufferManager,busses:this.busManager.getAll()}),this.instrumentManager.setConfigManager(this.config),this.listener=Na().listener,window&&(window.KLANG_SCENEMANAGER=this),this.iosHack&&(console.log("Utils.unmuteIOS(false, true)"),_o.unmuteIOS(!1,!0))}loadConfig(e,t){this.config.load(e),this.bufferManager.empty(),t.forEach((({name:e,buffer:t})=>this.bufferManager.setSoundBuffer(e,t)));const{scenes:n,sources:s,busses:i}=this.config.config;this.scenes=new Map,this.loadSceneConfigs(n),this.bufferManager.addSources(s),this.disposeInstruments(),this.busManager.empty(),this.busManager=new cl(i,this.bufferManager,this.config.config.channels)}loadSceneConfigs(e){Object.entries(e).forEach((([e,t])=>{t.name=e,t.bus&&(t.sounds=t.sounds.map((e=>(e.bus||(e.bus=t.bus),e)))),this.scenes.set(t.name,t)}))}disposeInstruments(){this.instrumentManager&&this.instrumentManager.disposeAll()}onConfigUpdate(e){const{location:t,toUpdate:n,action:s}=e;if(t.match(/^scenes\./)){const e=t.split("."),i=e[1];if(2===e.length)switch(s){case yo.CREATE:this.addScene(i);break;case yo.DELETE:this.deleteScene(i);break;case yo.UPDATE:Object.keys(n).forEach((e=>{if("name"===e)if(!this.scenes.has(n.name)){const e=this.scenes.get(i);e.name=n.name,this.scenes.set(n.name,e),this.deleteScene(i)}}))}}}addSource({source:e,buffer:t}){this.config.addSource(e),this.bufferManager.addSource(e),this.bufferManager.setSoundBuffer(e.name,t)}initializeAudioContext(){const e=Na(),t=e.state;return this.config.config.channels&&this.config.config.channels>2&&(e.destination.channelCountMode="explicit",e.destination.channelCount=e.destination.maxChannelCount),this.busManager.getBus("fade")&&"suspended"===t&&this.setBusVolume("fade",0,0),Pa.resume().then((()=>{this.busManager.getBus("fade")&&"suspended"===t&&this.setBusVolume("fade",1,1),this.audioIsInitialized=!0,ao.expiration=2}))}destroy(){this.instrumentManager.disposeAll(),this.busManager.empty(),this.bufferManager.empty()}loadScene(e,t=!1,n,s){return __async(this,null,(function*(){let i=this.scenes.get(e);i||(i=this.scenes.get("main"));const a=i.sounds.length;let r=0;t&&(this.currentScene=i,this.loadingState="loading");const o=i.sounds.map((e=>this.instrumentManager.createInstrument(i,e).then((()=>{r++,s&&s(r,a)}))));return Promise.all(o).then((()=>{i.sounds.forEach((e=>{var t,n,s;!("3d"===(null==(t=e.spatial)?void 0:t.mode)||"mono"===(null==(n=e.spatial)?void 0:n.mode))&&(null==(s=e.spatial)?void 0:s.doesNotMove)&&this.triggerForScene(e.name,{noReset:!0})})),window.AE_DEBUG&&console.log("Audio: loaded scene"),this.loadingState="loaded",n&&n()}))}))}changeScene(e,t){var n,s;if(e===(null==(n=this.currentScene)?void 0:n.name))return!1;const{onLoaded:i}=t,a=null!==t.fadeOutTime?t.fadeOutTime:0,r=this.instrumentManager.getInstrumentKeysForScene(null==(s=this.currentScene)?void 0:s.name).map((e=>this.instrumentManager.getInstrument(e)));return Promise.all(r.map((e=>new Promise((t=>this.instrumentManager.stop(e.name,{fadeTime:a,when:0,onComplete:()=>t(!0)})))))).then((()=>{r.forEach((e=>this.instrumentManager.disposeInstrument(e)))})),this.loadScene(e,!0,i)}unloadScene(e){this.instrumentManager.instruments.forEach(((t,n)=>{n.match(`${e}:`)&&this.instrumentManager.disposeInstrument(t)}))}addScene(e){if(this.scenes.get(e))return void console.warn("scene already exists");const t={name:e,sounds:[]};this.scenes.set(e,t)}deleteScene(e){this.scenes.delete(e)}getBusses(){return this.busManager.getAll()}getBus(e){return this.busManager.getBus(e)}getInstrument(e){return this.instrumentManager.getInstrument(e)}getInstruments(){return this.instrumentManager.instruments}getInstrumentById(e){const t=this.getInstruments(),[n,s]=Array.from(t).find((([t,n])=>n.uuid===e));return s}getBusById(e){const t=this.getBusses(),[n,s]=Array.from(t).find((([t,n])=>n.uuid===e));return s}getCurrentScene(){return this.currentScene}getScenes(){return this.scenes}getInstrumentForScene(e){var t;return this.instrumentManager.getInstrument(`${null==(t=this.currentScene)?void 0:t.name}:${e}`)}trigger(e,t){this.instrumentManager.trigger(e,t)}triggerForScene(e,t){var n;return this.currentScene?(this.trigger(`${null==(n=this.currentScene)?void 0:n.name}:${e}`,t),!0):(window.AE_DEBUG&&console.warn("Klang: No current scene"),!1)}triggerAllForScene(e,t){this.instrumentManager.getInstrumentKeysForScene(e).forEach((e=>{this.trigger(e,t)}))}stopForScene(e,t){var n;this.stop(`${null==(n=this.currentScene)?void 0:n.name}:${e}`,t)}stop(e,t){this.instrumentManager.stop(e,t)}pause(e,t){const n=this.instrumentManager.getInstrument(e);n&&n.pause(t)}pauseForScene(e,t){var n;return this.currentScene?(this.pause(`${null==(n=this.currentScene)?void 0:n.name}:${e}`,t),!0):(window.AE_DEBUG&&console.warn("Klang: No current scene"),!1)}resume(e,t){const n=this.instrumentManager.getInstrument(e);n&&n.resume(t)}resumeForScene(e,t){var n;return this.currentScene?(this.resume(`${null==(n=this.currentScene)?void 0:n.name}:${e}`,t),!0):(window.AE_DEBUG&&console.warn("Klang: No current scene"),!1)}fadeOutForScene(e,t){var n;const s=`${null==(n=this.currentScene)?void 0:n.name}:${e}`;this.instrumentManager.fadeOut(s,t)}fadeOut(e,t){this.instrumentManager.fadeOut(e,t)}setPositionForScene(e,t){if(!t||!this.currentScene)return!0;this.setPosition(`${this.currentScene.name}:${e}`,t)}setPosition(e,t){const n=this.instrumentManager.getInstrument(e);if("number"==typeof t&&(t={x:t,y:void 0,z:void 0}),null==n)return!1;const{channel:s}=n;s.setPosition(t.x,t.y,t.z);const i=uo({x:t.x,y:t.z},{x:this.listener.positionX.value,y:this.listener.positionZ.value}),a=s.maxAudibleDistance;s.isPositional&&("stopped"===n.getState()&&i<a?this.trigger(e):"stopped"!==n.getState()&&i>a&&this.instrumentManager.stop(n.name,{fadeTime:0,when:0}))}setListenerPosition(e,t){return!e||(this.listener.set({positionX:e.x,positionY:e.y,positionZ:e.z,forwardX:Math.sin(-t.y),forwardY:0,forwardZ:-Math.cos(-t.y)}),this.listener)}setBusVolume(e,t,n=1,s=0){this.busManager.setBusVolume(e,t,n,s)}setBusMute(e,t){return this.busManager.setBusMute(e,t)}getMasterGain(){return this.busManager.masterGain}addInstrument(e){return __async(this,arguments,(function*({sound:e,sceneName:t,buffer:n}){const s=e;s.sound||(s.sound=e.name),yield this.instrumentManager.addInstrument({sound:s,sceneName:t,buffer:n}),this.config.addInstrument(t,s)}))}deleteInstrument(e){this.instrumentManager.deleteInstrument(e),this.config.deleteInstrument(e)}getCurrentConfig(){return this.config.getCurrentConfig(this.busManager.getAll(),this.instrumentManager)}connectMediaToBus(e,t){this.busManager.connectMediaToBus(e,t)}setSupportedLanguages(e){this.bufferManager.setSupportedLanguages(e)}setDefaultLanguage(e){this.bufferManager.setDefaultLanguage(e)}setLanguage(e){this.bufferManager.setLanguage(e)}static now(){return so()}pauseAllCurrentlyPlaying(e){var t;for(const n of this.getInstruments().values())"player"===(null==(t=n.settings)?void 0:t.type)&&n.getState&&"started"===n.getState()&&n.pause(e)}resumeAllPlaying(e){var t;for(const n of this.getInstruments().values())"player"===(null==(t=n.settings)?void 0:t.type)&&n.getState&&"paused"===n.getState()&&n.resume(e)}}var hl="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},dl={},pl={},ml={},fl=hl&&hl.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var s,i=0,a=t.length;i<a;i++)!s&&i in t||(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(ml,"__esModule",{value:!0}),ml.resettableGenerator=ml.unwrapValue=void 0;ml.unwrapValue=function(e){return e.hasOwnProperty("next")?e.next().value:"function"==typeof e?e():e};ml.resettableGenerator=function(e){return new Proxy(e,{apply:function(e,t,n){var s=e.call.apply(e,fl([t],n,!1)),i=s.next,a=s;return s.next=function(){return a===s?i.call(s):a.next()},Object.defineProperty(a,"reset",{enumerable:!1,value:function(){return a=e.call.apply(e,fl([t],n,!1))}}),a}})};var gl=hl&&hl.__generator||function(e,t){var n,s,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=2&a[0]?s.return:a[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,a[1])).done)return i;switch(s=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(o){a=[6,o],s=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(pl,"__esModule",{value:!0}),pl.Pseq=void 0;var _l=ml;function yl(e,t){var n,s,i,a;return gl(this,(function(r){switch(r.label){case 0:if(n=0,s=function(){var t,s=e[n++%e.length];return null==(t=(0,_l.unwrapValue)(s))&&s.next().done?(s.reset(),s=e[n++%e.length],t=(0,_l.unwrapValue)(s)):null==t&&(s=e[n++%e.length],t=(0,_l.unwrapValue)(s)),t},null!=t)return[3,4];r.label=1;case 1:return[4,s()];case 2:return r.sent(),[3,1];case 3:return[3,10];case 4:i=0,r.label=5;case 5:if(!(i<t))return[3,10];a=0,r.label=6;case 6:return a<e.length?[4,s()]:[3,9];case 7:r.sent(),r.label=8;case 8:return a++,[3,6];case 9:return i++,[3,5];case 10:return[2]}}))}pl.Pseq=yl,pl.default=function(e,t){return(0,_l.resettableGenerator)(yl)(e,t)};var vl={},bl=hl&&hl.__generator||function(e,t){var n,s,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=2&a[0]?s.return:a[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,a[1])).done)return i;switch(s=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(o){a=[6,o],s=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(vl,"__esModule",{value:!0});var wl=ml;vl.default=function(e,t){var n,s;return bl(this,(function(i){switch(i.label){case 0:if(n=function(){var t=e[Math.floor(Math.random()*e.length)];return(0,wl.unwrapValue)(t)},null!=t)return[3,4];i.label=1;case 1:return[4,n()];case 2:return i.sent(),[3,1];case 3:return[3,8];case 4:s=0,i.label=5;case 5:return s<t?[4,n()]:[3,8];case 6:i.sent(),i.label=7;case 7:return s++,[3,5];case 8:return[2]}}))};var Tl={},xl={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.getSequentialRandomIndex=e.mod=e.isEquivalent=e.normalize=e.windex=e.makeFunction=e.flipCoin=e.mapToDomain=e.findInCollection=e.getClosestMember=e.getRateFromFrequencies=e.choose=e.ftom=e.mtof=void 0;e.mtof=function(e){return 440*Math.pow(2,e/12)};e.ftom=function(e){return Math.sqrt(e/440)/12};e.choose=function(e){return e[Math.floor(Math.random()*e.length)]};e.getRateFromFrequencies=function(e,t){return e/t};e.getClosestMember=function(e,t){return t.reduce((function(t,n){var s=t-e,i=n-e;return Math.abs(i)<Math.abs(s)?n:t}),t[0])};e.findInCollection=function(e,t){return e.reduce((function(e,n){return t(n)?n:e}))};e.mapToDomain=function(t,n){var s=Math.min.apply(Math,n)-Math.min.apply(Math,t),i=Math.max.apply(Math,n)-Math.min.apply(Math,n),a=Math.max.apply(Math,t)-Math.min.apply(Math,t);return t.map((function(r){return(0,e.getClosestMember)((r-Math.min.apply(Math,t))/a*i+s,n)}))};e.flipCoin=function(e){return void 0===e&&(e=.5),Math.random()<e};e.makeFunction=function(e){return"function"==typeof e?e:function(){return e}};e.windex=function(e){for(var t=e.reduce((function(e,t){return e+t})),n=Math.random()*t,s=0,i=0;i<e.length;i++)if(n<=(s=+(s+=e[i]).toFixed(2)))return i;return 0};e.normalize=function(e){var t=e.reduce((function(e,t){return e+t}));return t>0?e.map((function(e){return e/t})):e.map((function(){return 0}))};e.isEquivalent=function(e,t){var n=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(n.length!=s.length)return!1;for(var i=0;i<n.length;i++){var a=n[i];if(e[a]!==t[a])return!1}return!0};e.mod=function(e,t){return(e%t+t)%t};e.getSequentialRandomIndex=function(t,n){var s=Array(n).fill(0).map((function(e,t){return t})).filter((function(e){return e!==t}));return(0,e.choose)(s)},e.default={mtof:e.mtof,ftom:e.ftom,choose:e.choose,getRateFromFrequencies:e.getRateFromFrequencies,getClosestMember:e.getClosestMember,findInCollection:e.findInCollection,mapToDomain:e.mapToDomain,flipCoin:e.flipCoin,makeFunction:e.makeFunction,windex:e.windex,normalize:e.normalize,isEquivalent:e.isEquivalent,mod:e.mod,getSequentialRandomIndex:e.getSequentialRandomIndex}}(xl);var Sl=hl&&hl.__generator||function(e,t){var n,s,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=2&a[0]?s.return:a[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,a[1])).done)return i;switch(s=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(o){a=[6,o],s=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(Tl,"__esModule",{value:!0});var El=ml,Ml=xl;Tl.default=function(e,t){var n,s,i;return Sl(this,(function(a){switch(a.label){case 0:if(n=0,s=function(){var t=(0,Ml.getSequentialRandomIndex)(n,e.length),s=e[t];return n=t,(0,El.unwrapValue)(s)},null!=t)return[3,4];a.label=1;case 1:return[4,s()];case 2:return a.sent(),[3,1];case 3:return[3,8];case 4:i=0,a.label=5;case 5:return i<t?[4,s()]:[3,8];case 6:a.sent(),a.label=7;case 7:return i++,[3,5];case 8:return[2]}}))};var Al={},Cl={exports:{}};"undefined"!=typeof self&&self,Cl.exports=(()=>{var e={d:(t,n)=>{for(var s in n)e.o(n,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:n[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{MarkovN:()=>c,utils:()=>s});const n={mtof:e=>440*Math.pow(2,e/12),ftom:e=>Math.sqrt(e/440)/12,choose:e=>e[Math.floor(Math.random()*e.length)],getRateFromFrequencies:(e,t)=>e/t,getClosestMember:(e,t)=>t.reduce(((t,n)=>{const s=t-e,i=n-e;return Math.abs(i)<Math.abs(s)?n:t}),t[0]),findInCollection:(e,t)=>e.reduce(((e,n)=>t(n)?n:e)),mapToDomain:(e,t)=>{const s=Math.min(...t)-Math.min(...e),i=Math.max(...t)-Math.min(...t),a=Math.max(...e)-Math.min(...e);return e.map((r=>n.getClosestMember((r-Math.min(...e))/a*i+s,t)))},flipCoin:(e=.5)=>!(Math.random()<e),makeFunction:e=>"function"==typeof e?e:()=>e},s=n,i=e=>{let t=e.reduce(((e,t)=>e+t));return t>0?e.map((e=>e/t)):e.map((()=>0))},a=(e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){let n=0;return e.forEach(((e,s)=>{r(e,t[s])&&(n+=1)})),n===e.length}return!(Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))&&r(e,t)},r=(e,t)=>{if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||null==e||null==t)return!1;let n=Object.keys(e),s=Object.keys(t);if(n.length!=s.length)return!1;for(let i of n){if(!s.includes(i))return!1;if("function"==typeof e[i]||"function"==typeof t[i]){if(e[i].toString()!=t[i].toString())return!1}else if(!r(e[i],t[i]))return!1}return!0},o=(e,t)=>(e%t+t)%t,l=(e,t)=>{const n=[...e];return n.shift(),n.push(t),n},c=class{constructor(e,t){this.dictionary=[],this.combinations=[],this.lastState=[];for(let n=0;n<t;n++)this.lastState.push(e[n]);this.transitionMatrix=this.createTransitionMatrix(e,t)}createTransitionMatrix(e,t){var n,s;this.dictionary=e.reduce(((e,t)=>{let n=!1;return e.forEach((e=>{a(e,t)&&(n=!0)})),n||e.push(t),e}),[]),this.combinations=(s=t,(n=e).reduce(((e,t,i)=>{const a=[];for(let r=s;r>=0;r--)a.push(n[o(i-r,n.length)]);return e.push(a),e}),[]));let r=[];for(let i=0;i<this.combinations.length;i++){let e=[];for(let t=0;t<this.dictionary.length;t++)e.push(0);r.push(e)}for(let i=0;i<e.length;i++){let n=[];for(let a=t;a>=0;a--)n.push(e[o(i-a,e.length)]);let s=this.combinations.findIndex((e=>a(n,e))),l=e[(i+1)%e.length],c=this.dictionary.findIndex((e=>a(l,e)));r[s][c]++}return r=r.map(i),r}getNextState(e){const t=(e=>{let t=e.reduce(((e,t)=>e+t)),n=Math.random()*t,s=0;for(let i=0;i<e.length;i++)if(s+=e[i],s=+s.toFixed(2),n<=s)return i})(this.transitionMatrix[this.combinations.findIndex((t=>a(e,t)))]);return this.dictionary[t]}*asPattern(e){for(this.lastState=e;;){let e=this.getNextState(this.lastState);this.lastState=l(this.lastState,e),yield e}}};return t})();var Il=Cl.exports;Object.defineProperty(Al,"__esModule",{value:!0});var kl=Il;Al.default=function(e,t,n){return new kl.MarkovN(e,t).asPattern(n)};var Ol={},Pl={},Nl=hl&&hl.__generator||function(e,t){var n,s,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=2&a[0]?s.return:a[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,a[1])).done)return i;switch(s=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(o){a=[6,o],s=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},Rl=hl&&hl.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var s,i=0,a=t.length;i<a;i++)!s&&i in t||(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return e.concat(s||Array.prototype.slice.call(t))};Object.defineProperty(Pl,"__esModule",{value:!0}),Pl.Genetic=void 0;var Dl=xl,Vl=function(){function e(e,t){this.population=e,this.scores=Array(e.length).fill(0),this.goal=t,this.lastState=e[Math.floor(Math.random()*(e.length-1))]}return e.prototype.getTotalFitnessRating=function(e,t){for(var n=0,s=e.map((function(t){return t-Math.min.apply(null,e)})),i=s.length-1;i>=0;i--)n+=this.getDistance(s[i],t[i]);return n},e.prototype.getTopTwoGenerations=function(e,t){for(var n=0,s=e.length-1;s>=0;s--){if(e[n]<e[s]&&(n=s),e[n]===e[s])n=(0,Dl.flipCoin)(.5)?n:s}var i=0,a=e[n];if((0,Dl.flipCoin)(.75))i=Math.floor(Math.random()*e.length);else for(s=e.length-1;s>=0;s--){if(e[s]!==a)if(e[i]<e[s]&&(i=s),e[i]===e[s])i=Math.random()>.5?i:s}return[t[n],t[i]]},e.prototype.mateGenerations=function(e){return[this.getSplicedOffspring(e[0],e[1]),this.getInterlacedOffspring(e[0],e[1])]},e.prototype.getInterlacedOffspring=function(e,t){for(var n=Array(e.length),s=n.length-1;s>=0;s--)n[s]=s%2==0?e[s]:t[s];return n},e.prototype.getSplicedOffspring=function(e,t){var n=0==(Math.random()>.5?1:0)?[e,t]:[t,e],s=Math.floor(e.length/2);return Rl(Rl([],n[0].slice(0,s),!0),n[1].slice(s-1,n[1].length-1),!0)},e.prototype.getDistance=function(e,t){return t-e},e.prototype.getPopulationScores=function(e,t){for(var n=Array(e.length).fill(0),s=e.length-1;s>=0;s--)n[s]=this.getTotalFitnessRating(e[s],t);return n},e.prototype.getNextGeneration=function(e,t){for(var n=this.getPopulationScores(e,t),s=this.getTopTwoGenerations(n,e),i=this.mateGenerations(s),a=0;a<i.length-1;a++)this.population.splice(Math.floor(Math.random()*(this.population.length-1)),1);return this.population=Rl(Rl([],this.population,!0),i,!0),i[Math.floor(Math.random()*(.999*i.length))]},e.prototype.getNextState=function(e){return this.getNextGeneration(this.population,this.goal)},e.prototype.asPattern=function(){var e=this;return function(t){var n;return Nl(this,(function(s){switch(s.label){case 0:e.lastState=t,s.label=1;case 1:return n=e.getNextState(e.lastState),e.lastState=n,[4,n];case 2:return s.sent(),[3,1];case 3:return[2]}}))}},e}();Pl.Genetic=Vl;var Ll=hl&&hl.__generator||function(e,t){var n,s,i,a,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,s&&(i=2&a[0]?s.return:a[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,a[1])).done)return i;switch(s=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(o){a=[6,o],s=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(Ol,"__esModule",{value:!0});var Bl=Pl;Ol.default=function(e,t){var n,s,i;return Ll(this,(function(a){switch(a.label){case 0:n=new Bl.Genetic(e,t),s=t,a.label=1;case 1:return i=n.getNextState(s),s=[s[s.length-1],i],[4,i];case 2:return a.sent(),[3,1];case 3:return[2]}}))},function(e){var t=hl&&hl.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.utils=e.Pgenetic=e.Pmarkov=e.Pchoose=e.Prand=e.Pseq=e.Pattern=void 0;e.Pattern=function(e){return[function(){return e.next().value}]};var n=pl;Object.defineProperty(e,"Pseq",{enumerable:!0,get:function(){return t(n).default}});var s=vl;Object.defineProperty(e,"Prand",{enumerable:!0,get:function(){return t(s).default}});var i=Tl;Object.defineProperty(e,"Pchoose",{enumerable:!0,get:function(){return t(i).default}});var a=Al;Object.defineProperty(e,"Pmarkov",{enumerable:!0,get:function(){return t(a).default}});var r=Ol;Object.defineProperty(e,"Pgenetic",{enumerable:!0,get:function(){return t(r).default}});var o=xl;Object.defineProperty(e,"utils",{enumerable:!0,get:function(){return t(o).default}})}(dl),window.TONE_SILENCE_LOGGING=!0;class Fl{constructor(e,t,n){__publicField(this,"config"),__publicField(this,"timeoutId",0),__publicField(this,"endTimeoutId",0),__publicField(this,"sceneManager"),__publicField(this,"currentIndex",0),__publicField(this,"callback"),__publicField(this,"currentKey"),__publicField(this,"timerPausedAt",null),__publicField(this,"timerRemaining",null),__publicField(this,"timeoutTargetTime",null),this.config=e,this.sceneManager=t,this.callback=n}start(){this.triggerKey(this.currentIndex)}getCurrentIndex(){return this.currentIndex}stop(e={setCompleted:!1,stopImmediately:!0}){clearTimeout(this.timeoutId),clearTimeout(this.endTimeoutId),e.stopImmediately&&this.config.events.forEach((e=>{const t=this.sceneManager.getInstrument(`vo:${e.key}`);t&&"stopped"!==t.player.state&&this.sceneManager.stop(`vo:${e.key}`)})),this.currentKey&&this.callback&&this.callback({key:this.currentKey,action:"stop"}),e.setCompleted&&(this.currentIndex=this.config.events.length)}reset(){this.currentIndex=0}pauseCurrent(){var e;const t=this.config.events[this.currentIndex-1];t&&t.key,this.timeoutId&&(this.timerPausedAt=Date.now(),this.timerRemaining=(null!=(e=this.timeoutTargetTime)?e:0)-this.timerPausedAt,clearTimeout(this.timeoutId),this.timeoutId=0)}resumeCurrent(){this.config.events[this.currentIndex-1],this.timerRemaining&&this.timerRemaining>0&&(this.timeoutId=setTimeout((()=>{this.triggerKey(this.currentIndex,0)}),this.timerRemaining),this.timeoutTargetTime=Date.now()+this.timerRemaining,this.timerRemaining=null)}triggerKey(e,t=0){if(e<this.config.events.length){const n=this.config.events[e],s=this.sceneManager.getInstrument(`vo:${n.key}`),i=(null==s?void 0:s.getDuration())||0;this.timeoutId=setTimeout((()=>{this.sceneManager.trigger(`vo:${n.key}`),this.currentKey=n.key,this.callback&&this.callback({key:n.key,action:"start"}),this.endTimeoutId=setTimeout((()=>{this.currentKey="",this.callback&&this.callback({key:n.key,action:"stop"})}),1e3*i-50),this.currentIndex=this.currentIndex+1,this.triggerKey(this.currentIndex,i)}),1e3*(n.timeout+t)),this.timeoutTargetTime=Date.now()+1e3*(n.timeout+t)}}}window.TONE_SILENCE_LOGGING=!0;const ql=new ul({scenes:{generic:{name:"generic",sounds:[{name:"typing",sound:["typing","typing","typing"],bus:"ui",type:"roundRobin"},{name:"typingDelete",sound:"typingDelete",bus:"ui"},{name:"hoverGeneric",sound:"hoverGeneric",bus:"ui"},{name:"hoverExpand",sound:"hoverExpand",bus:"ui"},{name:"clickGeneric",sound:"clickGeneric",bus:"ui",gain:.7},{name:"clickEnter",sound:"clickEnter",bus:"ui"},{name:"textAppear1",sound:"textAppear",bus:"textBus"},{name:"textAppear2",sound:"textAppear",bus:"textBus"},{name:"textAppear3",sound:"textAppear",bus:"textBus"},{name:"textAppear4",sound:"textAppear",bus:"textBus"},{name:"textRolling",sound:"textRolling",bus:"launchScene",loop:!0},{name:"musicMenu",sound:"musicMenu",bus:"master",loop:!0,loopEnd:35.624},{name:"ambMenu",sound:"ambMenu",bus:"master",loop:!0},{name:"rocketOneshot",sound:"rocketOneshot",gain:.3,bus:"master"},{name:"satelliteOneshot",sound:"satelliteOneshot",bus:"master"},{name:"spacejunkOneshot",sound:"spacejunkOneshot",bus:"master"},{name:"transmissionOneshot",sound:"transmissionOneshot",bus:"master"},{name:"hotspotHover",sound:["hotspotHover","hotspotHover","hotspotHover"],type:"roundRobin",gain:1.4,bus:"ui"}]},main:{name:"main",sounds:[{name:"clickMap",sound:"clickMap",bus:"ui"},{name:"ambLaunchPad1",sound:"ambLaunchPad1",bus:"mainBus",loop:!0,loopEnd:4.714},{name:"rocketDeploy",sound:"rocketDeploy",bus:"mainBus",gain:.4221},{name:"rocketFlight",sound:"rocketFlight",gain:.35,bus:"mainBus",loop:!0},{name:"ambSpace",sound:"ambSpace",bus:"mainBus",loop:!0},{name:"rocketLaunch",sound:"rocketLaunch",bus:"mainBus",gain:.4221},{name:"ambLaunchPad2",sound:"ambLaunchPad2",bus:"mainBus",loop:!0},{name:"ambMap",sound:"ambMap",bus:"map",loop:!0},{name:"terminalOut",sound:"terminalOut",bus:"ui"},{name:"terminalIn",sound:"terminalIn",bus:"ui"},{name:"guardianNotification",sound:"guardianNotification",bus:"ui"},{name:"zoomIn",sound:"zoomIn",bus:"ui",gain:1.3},{name:"zoomOut",sound:"zoomOut",bus:"ui",gain:1.3},{name:"ctaClick",sound:"ctaClick",bus:"ui"}],bus:"master"},vo:{name:"vo",sounds:[{name:"launchPadIdle2",sound:"launchPadIdle2"},{name:"launchPadIdle8",sound:"launchPadIdle8"},{name:"launchPadIdle10",sound:"launchPadIdle10"},{name:"launchPadIdle9",sound:"launchPadIdle9"},{name:"launchPadIdle6",sound:"launchPadIdle6"},{name:"launchPadIdle7",sound:"launchPadIdle7"},{name:"launchPad4",sound:"launchPad4"},{name:"launchPad5",sound:"launchPad5"},{name:"launchPadIdleExtra5",sound:"launchPadIdleExtra5"},{name:"launchPadIdleExtra4",sound:"launchPadIdleExtra4"},{name:"launchPadIdleExtra3",sound:"launchPadIdleExtra3"},{name:"launchPadIdleExtra6",sound:"launchPadIdleExtra6"},{name:"launchPad2",sound:"launchPad2"},{name:"launchPadIdleExtra10",sound:"launchPadIdleExtra10"},{name:"launchPadIdleExtra8",sound:"launchPadIdleExtra8"},{name:"launchPadIdleExtra2",sound:"launchPadIdleExtra2"},{name:"launchPad1",sound:"launchPad1"},{name:"launchPadIdle3",sound:"launchPadIdle3"},{name:"launchPadIdle4",sound:"launchPadIdle4"},{name:"launchPadIdleExtra7",sound:"launchPadIdleExtra7"},{name:"launchSequence7",sound:"launchSequence7"},{name:"launchPad3",sound:"launchPad3"},{name:"satelliteDeployed4",sound:"satelliteDeployed4"},{name:"launchSequence4",sound:"launchSequence4"},{name:"launchPadIdle1",sound:"launchPadIdle1"},{name:"satelliteDeployed2",sound:"satelliteDeployed2"},{name:"launchSequence6",sound:"launchSequence6"},{name:"satelliteDeployed1",sound:"satelliteDeployed1"},{name:"launchSequence5",sound:"launchSequence5"},{name:"launchPadIdleExtra1",sound:"launchPadIdleExtra1"},{name:"satelliteDeployed5",sound:"satelliteDeployed5"},{name:"satelliteDeployed3",sound:"satelliteDeployed3"},{name:"satelliteDeployed6",sound:"satelliteDeployed6"},{name:"launchSequence2",sound:"launchSequence2"},{name:"launchSequence3",sound:"launchSequence3"},{name:"launchPadIdle5",sound:"launchPadIdle5"},{name:"launchPadIdleExtra9",sound:"launchPadIdleExtra9"},{name:"launchSequence1",sound:"launchSequence1"},{name:"clearToLaunchPoll6",sound:"clearToLaunchPoll6"},{name:"clearToLaunchPoll4",sound:"clearToLaunchPoll4"},{name:"clearToLaunchPoll5",sound:"clearToLaunchPoll5"},{name:"clearToLaunchPoll13",sound:"clearToLaunchPoll13"},{name:"clearToLaunchPoll7",sound:"clearToLaunchPoll7"},{name:"clearToLaunchPoll19",sound:"clearToLaunchPoll19"},{name:"clearToLaunchPoll15",sound:"clearToLaunchPoll15"},{name:"clearToLaunchPoll9",sound:"clearToLaunchPoll9"},{name:"clearToLaunchPoll23",sound:"clearToLaunchPoll23"},{name:"clearToLaunchPoll17",sound:"clearToLaunchPoll17"},{name:"clearToLaunchPoll21",sound:"clearToLaunchPoll21"},{name:"clearToLaunchPoll33",sound:"clearToLaunchPoll33"},{name:"clearToLaunchPoll27",sound:"clearToLaunchPoll27"},{name:"clearToLaunchPoll31",sound:"clearToLaunchPoll31"},{name:"clearToLaunchPoll25",sound:"clearToLaunchPoll25"},{name:"clearToLaunchPoll11",sound:"clearToLaunchPoll11"},{name:"clearToLaunchPoll2",sound:"clearToLaunchPoll2"},{name:"clearToLaunchPoll29",sound:"clearToLaunchPoll29"},{name:"clearToLaunchPoll3",sound:"clearToLaunchPoll3"},{name:"clearToLaunchPoll1",sound:"clearToLaunchPoll1"}],bus:"vo"}},sources:[{name:"typingDelete"},{name:"typing"},{name:"hoverGeneric"},{name:"hoverExpand"},{name:"clickGeneric"},{name:"clickEnter"},{name:"clickCard"},{name:"clickMap"},{name:"textAppear"},{name:"textRolling"},{name:"ambLaunchPad1"},{name:"ambMenu"},{name:"rocketDeploy"},{name:"rocketFlight"},{name:"ambSpace"},{name:"musicMenu"},{name:"rocketLaunch"},{name:"ambLaunchPad2"},{name:"ambMap"},{name:"terminalOut"},{name:"terminalIn"},{name:"hotspotHover"},{name:"guardianNotification"},{name:"zoomIn"},{name:"zoomOut"},{name:"ctaClick"},{name:"launchPadIdle2"},{name:"launchPadIdle8"},{name:"launchPadIdle10"},{name:"launchPadIdle9"},{name:"launchPadIdle6"},{name:"launchPadIdle7"},{name:"launchPad4"},{name:"launchPad5"},{name:"launchPadIdleExtra5"},{name:"launchPadIdleExtra4"},{name:"launchPadIdleExtra3"},{name:"launchPadIdleExtra6"},{name:"launchPad2"},{name:"launchPadIdleExtra10"},{name:"launchPadIdleExtra8"},{name:"launchPadIdleExtra2"},{name:"launchPad1"},{name:"launchPadIdle3"},{name:"launchPadIdle4"},{name:"launchPadIdleExtra7"},{name:"launchSequence7"},{name:"launchPad3"},{name:"satelliteDeployed4"},{name:"launchSequence4"},{name:"launchPadIdle1"},{name:"satelliteDeployed2"},{name:"launchSequence6"},{name:"satelliteDeployed1"},{name:"launchSequence5"},{name:"launchPadIdleExtra1"},{name:"satelliteDeployed5"},{name:"satelliteDeployed3"},{name:"satelliteDeployed6"},{name:"launchSequence2"},{name:"launchSequence3"},{name:"launchPadIdle5"},{name:"launchPadIdleExtra9"},{name:"launchSequence1"},{name:"mapInRed"},{name:"mapInSattelite"},{name:"clearToLaunchPoll6"},{name:"clearToLaunchPoll4"},{name:"clearToLaunchPoll5"},{name:"clearToLaunchPoll13"},{name:"clearToLaunchPoll7"},{name:"clearToLaunchPoll19"},{name:"clearToLaunchPoll15"},{name:"clearToLaunchPoll9"},{name:"clearToLaunchPoll23"},{name:"clearToLaunchPoll17"},{name:"clearToLaunchPoll21"},{name:"clearToLaunchPoll33"},{name:"clearToLaunchPoll27"},{name:"clearToLaunchPoll31"},{name:"clearToLaunchPoll25"},{name:"clearToLaunchPoll11"},{name:"clearToLaunchPoll2"},{name:"clearToLaunchPoll29"},{name:"clearToLaunchPoll3"},{name:"clearToLaunchPoll1"},{name:"mapInSatellite"},{name:"rocketOneshot"},{name:"satelliteOneshot"},{name:"spacejunkOneshot"},{name:"transmissionOneshot"}],busses:[{name:"out",parent:"$OUT",gain:1},{name:"video",parent:"out",gain:1},{name:"master",parent:"video",gain:1},{name:"ui",parent:"master",gain:.7879},{name:"launchScene",parent:"master",gain:1},{name:"map",parent:"launchScene",gain:1},{name:"vo",parent:"launchScene",gain:1},{name:"mainBus",parent:"launchScene",gain:1},{name:"textBus",parent:"ui",gain:.5}],basePath:"/audio/"}),Gl=[],Ul=["Incoming signal...","close"],jl=.5,Hl=[],zl=["loader","launchComplex","launchSequence","deploySatellite","deploySatelliteSequence","exploreSatellite"];let Wl,$l=!0,Yl=0;const Ql={"generic:rocketOneshot":!1,"generic:satelliteOneshot":!1,"generic:spacejunkOneshot":!1,"generic:transmissionOneshot":!1},Xl=e=>{Wl&&Wl(e)};[{name:"launchPad",events:[{key:"launchPad1",timeout:3},{key:"launchPad2",timeout:0},{key:"launchPad3",timeout:0},{key:"launchPad4",timeout:0},{key:"launchPad5",timeout:0},{key:"launchPadIdle1",timeout:10},{key:"launchPadIdle2",timeout:0},{key:"launchPadIdle3",timeout:0},{key:"launchPadIdle4",timeout:0},{key:"launchPadIdle5",timeout:0},{key:"launchPadIdle6",timeout:0},{key:"launchPadIdle7",timeout:0},{key:"launchPadIdle8",timeout:0},{key:"launchPadIdle9",timeout:0},{key:"launchPadIdle10",timeout:0},{key:"launchPadIdleExtra1",timeout:10},{key:"launchPadIdleExtra2",timeout:0},{key:"launchPadIdleExtra3",timeout:0},{key:"launchPadIdleExtra4",timeout:0},{key:"launchPadIdleExtra5",timeout:0},{key:"launchPadIdleExtra6",timeout:0},{key:"launchPadIdleExtra7",timeout:0},{key:"launchPadIdleExtra8",timeout:0},{key:"launchPadIdleExtra9",timeout:0},{key:"launchPadIdleExtra10",timeout:0},{key:"clearToLaunchPoll1",timeout:10},{key:"clearToLaunchPoll2",timeout:0},{key:"clearToLaunchPoll3",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll5",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll7",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll9",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll11",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll13",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll15",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll17",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll19",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll21",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll23",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll25",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll27",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll29",timeout:0},{key:"clearToLaunchPoll6",timeout:0},{key:"clearToLaunchPoll31",timeout:0},{key:"clearToLaunchPoll4",timeout:0},{key:"clearToLaunchPoll33",timeout:0},{key:"clearToLaunchPoll6",timeout:0}]},{name:"launchSequence",events:[{key:"launchSequence1",timeout:0},{key:"launchSequence2",timeout:0},{key:"launchSequence3",timeout:0},{key:"launchSequence4",timeout:0},{key:"launchSequence5",timeout:0},{key:"launchSequence6",timeout:0},{key:"launchSequence7",timeout:0}]},{name:"satelliteDeployed",events:[{key:"satelliteDeployed1",timeout:0},{key:"satelliteDeployed2",timeout:0},{key:"satelliteDeployed3",timeout:0},{key:"satelliteDeployed4",timeout:0},{key:"satelliteDeployed5",timeout:0},{key:"satelliteDeployed6",timeout:0}]},{name:"launchPadIdle",events:[{key:"launchPadIdle1",timeout:0},{key:"launchPadIdle2",timeout:0},{key:"launchPadIdle3",timeout:0},{key:"launchPadIdle4",timeout:0},{key:"launchPadIdle5",timeout:0},{key:"launchPadIdle6",timeout:0},{key:"launchPadIdle7",timeout:0},{key:"launchPadIdle8",timeout:0},{key:"launchPadIdle9",timeout:0},{key:"launchPadIdle10",timeout:0}]},{name:"launchPadIdleExtra",events:[{key:"launchPadIdleExtra1",timeout:0},{key:"launchPadIdleExtra2",timeout:0},{key:"launchPadIdleExtra3",timeout:0},{key:"launchPadIdleExtra4",timeout:0},{key:"launchPadIdleExtra5",timeout:0},{key:"launchPadIdleExtra6",timeout:0},{key:"launchPadIdleExtra7",timeout:0},{key:"launchPadIdleExtra8",timeout:0},{key:"launchPadIdleExtra9",timeout:0},{key:"launchPadIdleExtra10",timeout:0}]}].forEach((e=>{const t=new Fl(e,ql,Xl);Hl[e.name]=t}));const Zl=(e=>{const t={value:e.initialState,stash:{},transition(n,s=!1){var i,a;if(!s&&t.value===n)return t.value;const r=t.value,o=e.states[r],l=e.states[n];if(l){const e=(null==o?void 0:o.transitions)&&(null==o?void 0:o.transitions[n]);(null==e?void 0:e.action)&&e.action(t.value),(null==(i=null==o?void 0:o.actions)?void 0:i.onExit)&&o.actions.onExit(n,t.stash),t.stash=(null==(a=null==l?void 0:l.actions)?void 0:a.onEnter)&&l.actions.onEnter(t.value),t.value=n}else console.warn("no destination state found");return t.value},exit(){const n=t.value,s=e.states[n];s&&s.actions&&s.actions.onExit(null,t.stash)}};return t})({initialState:"loading",states:{loader:{actions:{onEnter:()=>{},onExit:()=>{}}},launchComplex:{actions:{onEnter:()=>{ql.trigger("main:ambMap",{fadeIn:jl}),ql.trigger("main:ambLaunchPad1",{fadeIn:jl}),ql.trigger("main:ambLaunchPad2",{fadeIn:jl}),Hl.launchPadIdle.stop(),Hl.launchPadIdleExtra.stop(),Hl.launchPad.start()},onExit:()=>{ql.fadeOut("main:ambLaunchPad1",{fadeTime:jl}),ql.fadeOut("main:ambLaunchPad2",{fadeTime:jl}),Hl.launchPad.stop(),ql.stop("generic:textRolling")}}},launchSequence:{actions:{onEnter:()=>{ql.trigger("main:rocketLaunch"),Hl.launchPadIdle.stop(),Hl.launchPadIdleExtra.stop(),Hl.launchSequence.reset(),Hl.launchSequence.start(),Hl.satelliteDeployed.reset(),ql.setBusVolume("vo",1.5,.5)},onExit:e=>{ql.fadeOut("main:rocketLaunch",{fadeTime:jl});const t="deploySatellite"!==e;Hl.launchSequence.stop({stopImmediately:t}),ql.setBusVolume("vo",1,.1),ql.stop("generic:textRolling")}}},deploySatellite:{actions:{onEnter:e=>{let t=!1;"launchSequence"===e&&Hl.launchSequence.getCurrentIndex()<5&&(t=!0),Hl.launchSequence.stop({stopImmediately:t}),Hl.launchSequence.reset(),ql.trigger("main:rocketFlight",{fadeIn:jl})},onExit:()=>{ql.fadeOut("main:rocketFlight",{fadeTime:jl})}}},deploySatelliteSequence:{actions:{onEnter:()=>{ql.trigger("main:rocketDeploy"),ql.trigger("main:ambSpace",{fadeIn:jl}),Hl.launchSequence.stop(),Hl.satelliteDeployed.start()},onExit:e=>{ql.fadeOut("main:rocketDeploy",{fadeTime:jl}),ql.fadeOut("main:ambSpace",{fadeTime:jl});const t="exploreSatellite"!==e;Hl.satelliteDeployed.stop({stopImmediately:t})}}},exploreSatellite:{actions:{onEnter:()=>{ql.trigger("main:ambSpace",{fadeIn:jl})},onExit:()=>{ql.fadeOut("main:ambSpace",{fadeTime:jl})}}},becomeAGuardian:{actions:{onEnter:e=>{ql.trigger("generic:musicMenu",{fadeIn:jl}),ql.trigger("generic:ambMenu",{fadeIn:jl}),"launchComplex"!==e&&"launchSequence"!==e||(ql.fadeOut("main:ambLaunchPad1",{fadeTime:jl}),ql.fadeOut("main:ambLaunchPad2",{fadeTime:jl})),"deploySatelliteSequence"!==e&&"exploreSatellite"!==e||(ql.fadeOut("main:ambSpace",{fadeTime:jl}),ql.fadeOut("main:rocketFlight",{fadeTime:jl}))},onExit:()=>{ql.fadeOut("generic:musicMenu",{fadeTime:jl}),ql.fadeOut("generic:ambMenu",{fadeTime:jl})}}},menu:{actions:{onEnter:e=>{ql.trigger("generic:musicMenu",{fadeIn:jl}),ql.trigger("generic:ambMenu",{fadeIn:jl}),"launchComplex"!==e&&"launchSequence"!==e||(ql.fadeOut("main:ambLaunchPad1",{fadeTime:jl}),ql.fadeOut("main:ambLaunchPad2",{fadeTime:jl})),"deploySatelliteSequence"!==e&&"exploreSatellite"!==e||(ql.fadeOut("main:ambSpace",{fadeTime:jl}),ql.fadeOut("main:rocketFlight",{fadeTime:jl}))},onExit:()=>{ql.fadeOut("generic:musicMenu",{fadeTime:jl}),ql.fadeOut("generic:ambMenu",{fadeTime:jl})}}},silent:{actions:{onEnter:()=>{},onExit:()=>{}}}}});return class extends oo{constructor(){super({initializingElement:window,onInit:()=>{this.disableBlurMute(!1);const e=[ql.loadScene("generic")];return Promise.all(e).then((()=>{this.setupTextScramble()}))},appFSM:Zl,sceneManager:ql})}initHomePage(){const e=[ql.loadScene("main",!0),ql.loadScene("vo")];return ql.getBus("map").setGain(0,1),Promise.all(e)}setupTextScramble(){return __async(this,null,(function*(){Gl.push({text:"",time:0,instrument:ql.getInstrument("generic:textAppear1")},{text:"",time:0,instrument:ql.getInstrument("generic:textAppear2")})}))}getVoice(e,t=!1){let n=Gl.find((t=>t.text===e));if(!n){let e=Gl[0];Gl.reduce((function(e,n){let s=e.time<n.time?e:n;return t&&(s=e.time>n.time?e:n),s}),e),n=e}return n}changeScene(e){var t;return null==(t=this.appFSM)||t.transition(e),this.appFSM.stash||Promise.resolve()}setIsMapOpen(e){ql.getBus("map").setGain(e?1:0,1),ql.getBus("mainBus").setGain(e?0:1,1),this.trigger(e?"mapIn":"mapOut")}textScramble(e,t){if(e=e||"",!Ul.includes(e)&&this.sceneManager.audioIsInitialized){const n=this.getVoice(e);n&&(n.text=e,n.time=ul.now()+(t||0),this.stopText(n),$l&&n.instrument.play({options:{when:t||0}}))}}pauseAllCurrentlyPlaying(){ql.pauseAllCurrentlyPlaying({fadeTime:.5}),Hl.launchSequence.pauseCurrent()}resumeAllCurrentlyPlaying(){ql.resumeAllPlaying({fadeTime:.5}),Hl.launchSequence.resumeCurrent()}stopText(e){e&&e.instrument.fadeOut(0,0,(()=>{e.instrument.stop({})}))}stopTextScramble(e){if(e=e||"",!Ul.includes(e)&&this.sceneManager.audioIsInitialized){let t;t=e?Gl.find((t=>t.text===e)):this.getVoice("",!0),this.stopText(t)}}handleVoice(e,t){const n=`vo:${e.name}_${t}`.replace(/\s+/g,"_").replace(/\.+/g,"").toLowerCase();this.trigger(n)}setVOCallback(e){Wl=e}setVideoPlaying(e){this.sceneManager.setBusMute("video",e)}startTextRolling(){var e;zl.includes(null==(e=this.appFSM)?void 0:e.value)&&this.trigger("generic:textRolling")}stop(e,t){this.sceneManager.audioIsInitialized&&this.sceneManager.stop(e,t)}stopTextRolling(){this.stop("generic:textRolling")}setCapabilitiesScrollValue(e){var t,n,s,i;switch(Yl){case 0:if(e>800&&e<1700){const e="generic:spacejunkOneshot",n=this.sceneManager.getInstrument(e);"stopped"!==(null==(t=null==n?void 0:n.player)?void 0:t.state)||Ql[e]||(this.trigger(e),Ql[e]=!0)}else if(e>1700){const e="generic:satelliteOneshot",t=this.sceneManager.getInstrument(e);"stopped"!==(null==(n=null==t?void 0:t.player)?void 0:n.state)||Ql[e]||(this.trigger(e),Ql[e]=!0)}break;case 1:if(e>500){const e="generic:transmissionOneshot",t=this.sceneManager.getInstrument(e);"stopped"!==(null==(s=null==t?void 0:t.player)?void 0:s.state)||Ql[e]||(this.trigger(e),Ql[e]=!0)}break;case 2:if(e>500){const e="generic:rocketOneshot",t=this.sceneManager.getInstrument(e);"stopped"!==(null==(i=null==t?void 0:t.player)?void 0:i.state)||Ql[e]||(this.trigger(e),Ql[e]=!0)}}}setCapabilitiesStage(e){Yl=e}onPreloaderChange(e){if($l=e,e)for(const[t,n]of Object.entries(Ql))Ql[t]=!1}showGuardians(){ql.setBusVolume("launchScene",.1,.5)}hideGuardians(){ql.setBusVolume("launchScene",1,.5)}}}));
